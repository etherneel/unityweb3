import{c4 as vc,c5 as kc,c6 as Sc,c7 as _c,c8 as Ec,aV as fn,c9 as _s,aW as gt,ca as Ic,aH as $,cb as ki,cc as Si,bw as Ac,bn as Ln,bq as xc,bt as Rc,bs as _i,bo as Ei,br as Pc,bx as Bc,by as Tc,bC as Nn,bA as Cc}from"./index-ce020a9a.js";import{u as J,v as Oc,a as Lc,e as Ct,b as Un,n as Ii,c as Nc,w as Uc,d as Ai,m as _t,F as Fc,f as Kc,i as zc,p as ut,s as Es,k as xi}from"./secp256k1-5185377d.js";import{s as So}from"./index-51c25b9c.js";const[Dc,Mc]=(()=>J.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(n=>BigInt(n))))(),Ot=new Uint32Array(80),Lt=new Uint32Array(80);class Wc extends kc{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:r,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:g,Gh:d,Gl:p,Hh:y,Hl:f}=this;return[e,t,r,s,i,o,a,c,l,u,h,g,d,p,y,f]}set(e,t,r,s,i,o,a,c,l,u,h,g,d,p,y,f){this.Ah=e|0,this.Al=t|0,this.Bh=r|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=g|0,this.Gh=d|0,this.Gl=p|0,this.Hh=y|0,this.Hl=f|0}process(e,t){for(let b=0;b<16;b++,t+=4)Ot[b]=e.getUint32(t),Lt[b]=e.getUint32(t+=4);for(let b=16;b<80;b++){const _=Ot[b-15]|0,x=Lt[b-15]|0,E=J.rotrSH(_,x,1)^J.rotrSH(_,x,8)^J.shrSH(_,x,7),B=J.rotrSL(_,x,1)^J.rotrSL(_,x,8)^J.shrSL(_,x,7),T=Ot[b-2]|0,j=Lt[b-2]|0,ue=J.rotrSH(T,j,19)^J.rotrBH(T,j,61)^J.shrSH(T,j,6),we=J.rotrSL(T,j,19)^J.rotrBL(T,j,61)^J.shrSL(T,j,6),ze=J.add4L(B,we,Lt[b-7],Lt[b-16]),De=J.add4H(ze,E,ue,Ot[b-7],Ot[b-16]);Ot[b]=De|0,Lt[b]=ze|0}let{Ah:r,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:g,Fh:d,Fl:p,Gh:y,Gl:f,Hh:k,Hl:I}=this;for(let b=0;b<80;b++){const _=J.rotrSH(h,g,14)^J.rotrSH(h,g,18)^J.rotrBH(h,g,41),x=J.rotrSL(h,g,14)^J.rotrSL(h,g,18)^J.rotrBL(h,g,41),E=h&d^~h&y,B=g&p^~g&f,T=J.add5L(I,x,B,Mc[b],Lt[b]),j=J.add5H(T,k,_,E,Dc[b],Ot[b]),ue=T|0,we=J.rotrSH(r,s,28)^J.rotrBH(r,s,34)^J.rotrBH(r,s,39),ze=J.rotrSL(r,s,28)^J.rotrBL(r,s,34)^J.rotrBL(r,s,39),De=r&i^r&a^i&a,Bt=s&o^s&c^o&c;k=y|0,I=f|0,y=d|0,f=p|0,d=h|0,p=g|0,{h,l:g}=J.add(l|0,u|0,j|0,ue|0),l=a|0,u=c|0,a=i|0,c=o|0,i=r|0,o=s|0;const kt=J.add3L(ue,ze,Bt);r=J.add3H(kt,j,we,De),s=kt|0}({h:r,l:s}=J.add(this.Ah|0,this.Al|0,r|0,s|0)),{h:i,l:o}=J.add(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=J.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=J.add(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:g}=J.add(this.Eh|0,this.El|0,h|0,g|0),{h:d,l:p}=J.add(this.Fh|0,this.Fl|0,d|0,p|0),{h:y,l:f}=J.add(this.Gh|0,this.Gl|0,y|0,f|0),{h:k,l:I}=J.add(this.Hh|0,this.Hl|0,k|0,I|0),this.set(r,s,i,o,a,c,l,u,h,g,d,p,y,f,k,I)}roundClean(){Ot.fill(0),Lt.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const _o=vc(()=>new Wc);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const it=BigInt(0),Ye=BigInt(1),Gr=BigInt(2),qc=BigInt(8),jc={zip215:!0};function $c(n){const e=Oc(n);return Lc(n,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Is(n){const e=$c(n),{Fp:t,n:r,prehash:s,hash:i,randomBytes:o,nByteLength:a,h:c}=e,l=Gr<<BigInt(a*8)-Ye,u=t.create,h=e.uvRatio||((q,v)=>{try{return{isValid:!0,value:t.sqrt(q*t.inv(v))}}catch{return{isValid:!1,value:it}}}),g=e.adjustScalarBytes||(q=>q),d=e.domain||((q,v,S)=>{if(v.length||S)throw new Error("Contexts/pre-hash are not supported");return q}),p=q=>typeof q=="bigint"&&it<q,y=(q,v)=>p(q)&&p(v)&&q<v,f=q=>q===it||y(q,l);function k(q,v){if(y(q,v))return q;throw new Error(`Expected valid scalar < ${v}, got ${typeof q} ${q}`)}function I(q){return q===it?q:k(q,r)}const b=new Map;function _(q){if(!(q instanceof x))throw new Error("ExtendedPoint expected")}class x{constructor(v,S,A,N){if(this.ex=v,this.ey=S,this.ez=A,this.et=N,!f(v))throw new Error("x required");if(!f(S))throw new Error("y required");if(!f(A))throw new Error("z required");if(!f(N))throw new Error("t required")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(v){if(v instanceof x)throw new Error("extended point not allowed");const{x:S,y:A}=v||{};if(!f(S)||!f(A))throw new Error("invalid affine point");return new x(S,A,Ye,u(S*A))}static normalizeZ(v){const S=t.invertBatch(v.map(A=>A.ez));return v.map((A,N)=>A.toAffine(S[N])).map(x.fromAffine)}_setWindowSize(v){this._WINDOW_SIZE=v,b.delete(this)}assertValidity(){const{a:v,d:S}=e;if(this.is0())throw new Error("bad point: ZERO");const{ex:A,ey:N,ez:K,et:U}=this,H=u(A*A),G=u(N*N),Q=u(K*K),fe=u(Q*Q),ge=u(H*v),Se=u(Q*u(ge+G)),qe=u(fe+u(S*u(H*G)));if(Se!==qe)throw new Error("bad point: equation left != right (1)");const Tt=u(A*N),St=u(K*U);if(Tt!==St)throw new Error("bad point: equation left != right (2)")}equals(v){_(v);const{ex:S,ey:A,ez:N}=this,{ex:K,ey:U,ez:H}=v,G=u(S*H),Q=u(K*N),fe=u(A*H),ge=u(U*N);return G===Q&&fe===ge}is0(){return this.equals(x.ZERO)}negate(){return new x(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:v}=e,{ex:S,ey:A,ez:N}=this,K=u(S*S),U=u(A*A),H=u(Gr*u(N*N)),G=u(v*K),Q=S+A,fe=u(u(Q*Q)-K-U),ge=G+U,Se=ge-H,qe=G-U,Tt=u(fe*Se),St=u(ge*qe),Vr=u(fe*qe),Hr=u(Se*ge);return new x(Tt,St,Hr,Vr)}add(v){_(v);const{a:S,d:A}=e,{ex:N,ey:K,ez:U,et:H}=this,{ex:G,ey:Q,ez:fe,et:ge}=v;if(S===BigInt(-1)){const pi=u((K-N)*(Q+G)),gi=u((K+N)*(Q-G)),On=u(gi-pi);if(On===it)return this.double();const yi=u(U*Gr*ge),mi=u(H*Gr*fe),bi=mi+yi,wi=gi+pi,vi=mi-yi,yc=u(bi*On),mc=u(wi*vi),bc=u(bi*vi),wc=u(On*wi);return new x(yc,mc,wc,bc)}const Se=u(N*G),qe=u(K*Q),Tt=u(H*A*ge),St=u(U*fe),Vr=u((N+K)*(G+Q)-Se-qe),Hr=St-Tt,hi=St+Tt,fi=u(qe-S*Se),hc=u(Vr*Hr),fc=u(hi*fi),pc=u(Vr*fi),gc=u(Hr*hi);return new x(hc,fc,gc,pc)}subtract(v){return this.add(v.negate())}wNAF(v){return T.wNAFCached(this,b,v,x.normalizeZ)}multiply(v){const{p:S,f:A}=this.wNAF(k(v,r));return x.normalizeZ([S,A])[0]}multiplyUnsafe(v){let S=I(v);return S===it?B:this.equals(B)||S===Ye?this:this.equals(E)?this.wNAF(S).p:T.unsafeLadder(this,S)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return T.unsafeLadder(this,r).is0()}toAffine(v){const{ex:S,ey:A,ez:N}=this,K=this.is0();v==null&&(v=K?qc:t.inv(N));const U=u(S*v),H=u(A*v),G=u(N*v);if(K)return{x:it,y:Ye};if(G!==Ye)throw new Error("invZ was invalid");return{x:U,y:H}}clearCofactor(){const{h:v}=e;return v===Ye?this:this.multiplyUnsafe(v)}static fromHex(v,S=!1){const{d:A,a:N}=e,K=t.BYTES;v=Ct("pointHex",v,K);const U=v.slice(),H=v[K-1];U[K-1]=H&-129;const G=Un(U);G===it||(S?k(G,l):k(G,t.ORDER));const Q=u(G*G),fe=u(Q-Ye),ge=u(A*Q-N);let{isValid:Se,value:qe}=h(fe,ge);if(!Se)throw new Error("Point.fromHex: invalid y coordinate");const Tt=(qe&Ye)===Ye,St=(H&128)!==0;if(!S&&qe===it&&St)throw new Error("Point.fromHex: x=0 and x_0=1");return St!==Tt&&(qe=u(-qe)),x.fromAffine({x:qe,y:G})}static fromPrivateKey(v){return we(v).point}toRawBytes(){const{x:v,y:S}=this.toAffine(),A=Ii(S,t.BYTES);return A[A.length-1]|=v&Ye?128:0,A}toHex(){return Nc(this.toRawBytes())}}x.BASE=new x(e.Gx,e.Gy,Ye,u(e.Gx*e.Gy)),x.ZERO=new x(it,Ye,Ye,it);const{BASE:E,ZERO:B}=x,T=Uc(x,a*8);function j(q){return _t(q,r)}function ue(q){return j(Un(q))}function we(q){const v=a;q=Ct("private key",q,v);const S=Ct("hashed private key",i(q),2*v),A=g(S.slice(0,v)),N=S.slice(v,2*v),K=ue(A),U=E.multiply(K),H=U.toRawBytes();return{head:A,prefix:N,scalar:K,point:U,pointBytes:H}}function ze(q){return we(q).pointBytes}function De(q=new Uint8Array,...v){const S=Ai(...v);return ue(i(d(S,Ct("context",q),!!s)))}function Bt(q,v,S={}){q=Ct("message",q),s&&(q=s(q));const{prefix:A,scalar:N,pointBytes:K}=we(v),U=De(S.context,A,q),H=E.multiply(U).toRawBytes(),G=De(S.context,H,K,q),Q=j(U+G*N);I(Q);const fe=Ai(H,Ii(Q,t.BYTES));return Ct("result",fe,a*2)}const kt=jc;function qt(q,v,S,A=kt){const{context:N,zip215:K}=A,U=t.BYTES;q=Ct("signature",q,2*U),v=Ct("message",v),s&&(v=s(v));const H=Un(q.slice(U,2*U));let G,Q,fe;try{G=x.fromHex(S,K),Q=x.fromHex(q.slice(0,U),K),fe=E.multiplyUnsafe(H)}catch{return!1}if(!K&&G.isSmallOrder())return!1;const ge=De(N,Q.toRawBytes(),G.toRawBytes(),v);return Q.add(G.multiplyUnsafe(ge)).subtract(fe).clearCofactor().equals(x.ZERO)}return E._setWindowSize(8),{CURVE:e,getPublicKey:ze,sign:Bt,verify:qt,ExtendedPoint:x,utils:{getExtendedPublicKey:we,randomPrivateKey:()=>o(t.BYTES),precompute(q=8,v=x.BASE){return v._setWindowSize(q),v.multiply(BigInt(3)),v}}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const As=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Ri=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Vc=BigInt(1),ls=BigInt(2),Hc=BigInt(5),Pi=BigInt(10),Gc=BigInt(20),Yc=BigInt(40),Bi=BigInt(80);function Jc(n){const e=As,r=n*n%e*n%e,s=ut(r,ls,e)*r%e,i=ut(s,Vc,e)*n%e,o=ut(i,Hc,e)*i%e,a=ut(o,Pi,e)*o%e,c=ut(a,Gc,e)*a%e,l=ut(c,Yc,e)*c%e,u=ut(l,Bi,e)*l%e,h=ut(u,Bi,e)*l%e,g=ut(h,Pi,e)*o%e;return{pow_p_5_8:ut(g,ls,e)*n%e,b2:r}}function Zc(n){return n[0]&=248,n[31]&=127,n[31]|=64,n}function Xc(n,e){const t=As,r=_t(e*e*e,t),s=_t(r*r*e,t),i=Jc(n*s).pow_p_5_8;let o=_t(n*r*i,t);const a=_t(e*o*o,t),c=o,l=_t(o*Ri,t),u=a===n,h=a===_t(-n,t),g=a===_t(-n*Ri,t);return u&&(o=c),(h||g)&&(o=l),zc(o,t)&&(o=_t(-o,t)),{isValid:u||h,value:o}}const Pt=Fc(As,void 0,!0),xs={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Pt,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:_o,randomBytes:Sc,adjustScalarBytes:Zc,uvRatio:Xc},Sr=Is(xs);function Eo(n,e,t){if(e.length>255)throw new Error("Context is too big");return _c(Ec("SigEd25519 no Ed25519 collisions"),new Uint8Array([t?1:0,e.length]),e,n)}({...xs});({...xs});const Qc=(Pt.ORDER+BigInt(3))/BigInt(8);Pt.pow(ls,Qc);Pt.sqrt(Pt.neg(Pt.ONE));(Pt.ORDER-BigInt(5))/BigInt(8);BigInt(486662);Kc(Pt,Pt.neg(BigInt(486664)));BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235");BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578");BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838");BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");var Yr=So.Buffer;function eu(n){if(n.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),t=0;t<e.length;t++)e[t]=255;for(var r=0;r<n.length;r++){var s=n.charAt(r),i=s.charCodeAt(0);if(e[i]!==255)throw new TypeError(s+" is ambiguous");e[i]=r}var o=n.length,a=n.charAt(0),c=Math.log(o)/Math.log(256),l=Math.log(256)/Math.log(o);function u(d){if((Array.isArray(d)||d instanceof Uint8Array)&&(d=Yr.from(d)),!Yr.isBuffer(d))throw new TypeError("Expected Buffer");if(d.length===0)return"";for(var p=0,y=0,f=0,k=d.length;f!==k&&d[f]===0;)f++,p++;for(var I=(k-f)*l+1>>>0,b=new Uint8Array(I);f!==k;){for(var _=d[f],x=0,E=I-1;(_!==0||x<y)&&E!==-1;E--,x++)_+=256*b[E]>>>0,b[E]=_%o>>>0,_=_/o>>>0;if(_!==0)throw new Error("Non-zero carry");y=x,f++}for(var B=I-y;B!==I&&b[B]===0;)B++;for(var T=a.repeat(p);B<I;++B)T+=n.charAt(b[B]);return T}function h(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return Yr.alloc(0);for(var p=0,y=0,f=0;d[p]===a;)y++,p++;for(var k=(d.length-p)*c+1>>>0,I=new Uint8Array(k);d[p];){var b=e[d.charCodeAt(p)];if(b===255)return;for(var _=0,x=k-1;(b!==0||_<f)&&x!==-1;x--,_++)b+=o*I[x]>>>0,I[x]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");f=_,p++}for(var E=k-f;E!==k&&I[E]===0;)E++;var B=Yr.allocUnsafe(y+(k-E));B.fill(0,0,y);for(var T=y;E!==k;)B[T++]=I[E++];return B}function g(d){var p=h(d);if(p)return p;throw new Error("Non-base"+o+" character")}return{encode:u,decodeUnsafe:h,decode:g}}var tu=eu,ru=tu,nu="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",su=ru(nu);const Te=fn(su);var Be={},Jr=So.Buffer;function iu(n){if(n.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),t=0;t<e.length;t++)e[t]=255;for(var r=0;r<n.length;r++){var s=n.charAt(r),i=s.charCodeAt(0);if(e[i]!==255)throw new TypeError(s+" is ambiguous");e[i]=r}var o=n.length,a=n.charAt(0),c=Math.log(o)/Math.log(256),l=Math.log(256)/Math.log(o);function u(d){if((Array.isArray(d)||d instanceof Uint8Array)&&(d=Jr.from(d)),!Jr.isBuffer(d))throw new TypeError("Expected Buffer");if(d.length===0)return"";for(var p=0,y=0,f=0,k=d.length;f!==k&&d[f]===0;)f++,p++;for(var I=(k-f)*l+1>>>0,b=new Uint8Array(I);f!==k;){for(var _=d[f],x=0,E=I-1;(_!==0||x<y)&&E!==-1;E--,x++)_+=256*b[E]>>>0,b[E]=_%o>>>0,_=_/o>>>0;if(_!==0)throw new Error("Non-zero carry");y=x,f++}for(var B=I-y;B!==I&&b[B]===0;)B++;for(var T=a.repeat(p);B<I;++B)T+=n.charAt(b[B]);return T}function h(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return Jr.alloc(0);for(var p=0,y=0,f=0;d[p]===a;)y++,p++;for(var k=(d.length-p)*c+1>>>0,I=new Uint8Array(k);d[p];){var b=e[d.charCodeAt(p)];if(b===255)return;for(var _=0,x=k-1;(b!==0||_<f)&&x!==-1;x--,_++)b+=o*I[x]>>>0,I[x]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");f=_,p++}for(var E=k-f;E!==k&&I[E]===0;)E++;var B=Jr.allocUnsafe(y+(k-E));B.fill(0,0,y);for(var T=y;E!==k;)B[T++]=I[E++];return B}function g(d){var p=h(d);if(p)return p;throw new Error("Non-base"+o+" character")}return{encode:u,decodeUnsafe:h,decode:g}}var ou=iu,au=ou,cu="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",uu=au(cu);function At(n,e,t){return e<=n&&n<=t}function pn(n){if(n===void 0)return{};if(n===Object(n))return n;throw TypeError("Could not convert argument to dictionary")}function lu(n){for(var e=String(n),t=e.length,r=0,s=[];r<t;){var i=e.charCodeAt(r);if(i<55296||i>57343)s.push(i);else if(56320<=i&&i<=57343)s.push(65533);else if(55296<=i&&i<=56319)if(r===t-1)s.push(65533);else{var o=n.charCodeAt(r+1);if(56320<=o&&o<=57343){var a=i&1023,c=o&1023;s.push(65536+(a<<10)+c),r+=1}else s.push(65533)}r+=1}return s}function du(n){for(var e="",t=0;t<n.length;++t){var r=n[t];r<=65535?e+=String.fromCharCode(r):(r-=65536,e+=String.fromCharCode((r>>10)+55296,(r&1023)+56320))}return e}var rn=-1;function Rs(n){this.tokens=[].slice.call(n)}Rs.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.shift():rn},prepend:function(n){if(Array.isArray(n))for(var e=n;e.length;)this.tokens.unshift(e.pop());else this.tokens.unshift(n)},push:function(n){if(Array.isArray(n))for(var e=n;e.length;)this.tokens.push(e.shift());else this.tokens.push(n)}};var mr=-1;function Fn(n,e){if(n)throw TypeError("Decoder error");return e||65533}var nn="utf-8";function sn(n,e){if(!(this instanceof sn))return new sn(n,e);if(n=n!==void 0?String(n).toLowerCase():nn,n!==nn)throw new Error("Encoding not supported. Only utf-8 is supported");e=pn(e),this._streaming=!1,this._BOMseen=!1,this._decoder=null,this._fatal=!!e.fatal,this._ignoreBOM=!!e.ignoreBOM,Object.defineProperty(this,"encoding",{value:"utf-8"}),Object.defineProperty(this,"fatal",{value:this._fatal}),Object.defineProperty(this,"ignoreBOM",{value:this._ignoreBOM})}sn.prototype={decode:function(e,t){var r;typeof e=="object"&&e instanceof ArrayBuffer?r=new Uint8Array(e):typeof e=="object"&&"buffer"in e&&e.buffer instanceof ArrayBuffer?r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):r=new Uint8Array(0),t=pn(t),this._streaming||(this._decoder=new hu({fatal:this._fatal}),this._BOMseen=!1),this._streaming=!!t.stream;for(var s=new Rs(r),i=[],o;!s.endOfStream()&&(o=this._decoder.handler(s,s.read()),o!==mr);)o!==null&&(Array.isArray(o)?i.push.apply(i,o):i.push(o));if(!this._streaming){do{if(o=this._decoder.handler(s,s.read()),o===mr)break;o!==null&&(Array.isArray(o)?i.push.apply(i,o):i.push(o))}while(!s.endOfStream());this._decoder=null}return i.length&&["utf-8"].indexOf(this.encoding)!==-1&&!this._ignoreBOM&&!this._BOMseen&&(i[0]===65279?(this._BOMseen=!0,i.shift()):this._BOMseen=!0),du(i)}};function on(n,e){if(!(this instanceof on))return new on(n,e);if(n=n!==void 0?String(n).toLowerCase():nn,n!==nn)throw new Error("Encoding not supported. Only utf-8 is supported");e=pn(e),this._streaming=!1,this._encoder=null,this._options={fatal:!!e.fatal},Object.defineProperty(this,"encoding",{value:"utf-8"})}on.prototype={encode:function(e,t){e=e?String(e):"",t=pn(t),this._streaming||(this._encoder=new fu(this._options)),this._streaming=!!t.stream;for(var r=[],s=new Rs(lu(e)),i;!s.endOfStream()&&(i=this._encoder.handler(s,s.read()),i!==mr);)Array.isArray(i)?r.push.apply(r,i):r.push(i);if(!this._streaming){for(;i=this._encoder.handler(s,s.read()),i!==mr;)Array.isArray(i)?r.push.apply(r,i):r.push(i);this._encoder=null}return new Uint8Array(r)}};function hu(n){var e=n.fatal,t=0,r=0,s=0,i=128,o=191;this.handler=function(a,c){if(c===rn&&s!==0)return s=0,Fn(e);if(c===rn)return mr;if(s===0){if(At(c,0,127))return c;if(At(c,194,223))s=1,t=c-192;else if(At(c,224,239))c===224&&(i=160),c===237&&(o=159),s=2,t=c-224;else if(At(c,240,244))c===240&&(i=144),c===244&&(o=143),s=3,t=c-240;else return Fn(e);return t=t<<6*s,null}if(!At(c,i,o))return t=s=r=0,i=128,o=191,a.prepend(c),Fn(e);if(i=128,o=191,r+=1,t+=c-128<<6*(s-r),r!==s)return null;var l=t;return t=s=r=0,l}}function fu(n){n.fatal,this.handler=function(e,t){if(t===rn)return mr;if(At(t,0,127))return t;var r,s;At(t,128,2047)?(r=1,s=192):At(t,2048,65535)?(r=2,s=224):At(t,65536,1114111)&&(r=3,s=240);for(var i=[(t>>6*r)+s];r>0;){var o=t>>6*(r-1);i.push(128|o&63),r-=1}return i}}const pu=Object.freeze(Object.defineProperty({__proto__:null,TextDecoder:sn,TextEncoder:on},Symbol.toStringTag,{value:"Module"})),gu=_s(pu);var yu=gt&&gt.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),mu=gt&&gt.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),bt=gt&&gt.__decorate||function(n,e,t,r){var s=arguments.length,i=s<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,t):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(n,e,t,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(i=(s<3?o(i):s>3?o(e,t,i):o(e,t))||i);return s>3&&i&&Object.defineProperty(e,t,i),i},bu=gt&&gt.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.hasOwnProperty.call(n,t)&&yu(e,n,t);return mu(e,n),e},Io=gt&&gt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Be,"__esModule",{value:!0});var Ao=Be.deserializeUnchecked=Co=Be.deserialize=To=Be.serialize=Be.BinaryReader=Be.BinaryWriter=Be.BorshError=Be.baseDecode=Be.baseEncode=void 0;const Ut=Io(Ic),xo=Io(uu),wu=bu(gu),vu=typeof TextDecoder!="function"?wu.TextDecoder:TextDecoder,ku=new vu("utf-8",{fatal:!0});function Su(n){return typeof n=="string"&&(n=Buffer.from(n,"utf8")),xo.default.encode(Buffer.from(n))}Be.baseEncode=Su;function _u(n){return Buffer.from(xo.default.decode(n))}Be.baseDecode=_u;const Kn=1024;class We extends Error{constructor(e){super(e),this.fieldPath=[],this.originalMessage=e}addToFieldPath(e){this.fieldPath.splice(0,0,e),this.message=this.originalMessage+": "+this.fieldPath.join(".")}}Be.BorshError=We;class Ro{constructor(){this.buf=Buffer.alloc(Kn),this.length=0}maybeResize(){this.buf.length<16+this.length&&(this.buf=Buffer.concat([this.buf,Buffer.alloc(Kn)]))}writeU8(e){this.maybeResize(),this.buf.writeUInt8(e,this.length),this.length+=1}writeU16(e){this.maybeResize(),this.buf.writeUInt16LE(e,this.length),this.length+=2}writeU32(e){this.maybeResize(),this.buf.writeUInt32LE(e,this.length),this.length+=4}writeU64(e){this.maybeResize(),this.writeBuffer(Buffer.from(new Ut.default(e).toArray("le",8)))}writeU128(e){this.maybeResize(),this.writeBuffer(Buffer.from(new Ut.default(e).toArray("le",16)))}writeU256(e){this.maybeResize(),this.writeBuffer(Buffer.from(new Ut.default(e).toArray("le",32)))}writeU512(e){this.maybeResize(),this.writeBuffer(Buffer.from(new Ut.default(e).toArray("le",64)))}writeBuffer(e){this.buf=Buffer.concat([Buffer.from(this.buf.subarray(0,this.length)),e,Buffer.alloc(Kn)]),this.length+=e.length}writeString(e){this.maybeResize();const t=Buffer.from(e,"utf8");this.writeU32(t.length),this.writeBuffer(t)}writeFixedArray(e){this.writeBuffer(Buffer.from(e))}writeArray(e,t){this.maybeResize(),this.writeU32(e.length);for(const r of e)this.maybeResize(),t(r)}toArray(){return this.buf.subarray(0,this.length)}}Be.BinaryWriter=Ro;function wt(n,e,t){const r=t.value;t.value=function(...s){try{return r.apply(this,s)}catch(i){if(i instanceof RangeError){const o=i.code;if(["ERR_BUFFER_OUT_OF_BOUNDS","ERR_OUT_OF_RANGE"].indexOf(o)>=0)throw new We("Reached the end of buffer when deserializing")}throw i}}}class et{constructor(e){this.buf=e,this.offset=0}readU8(){const e=this.buf.readUInt8(this.offset);return this.offset+=1,e}readU16(){const e=this.buf.readUInt16LE(this.offset);return this.offset+=2,e}readU32(){const e=this.buf.readUInt32LE(this.offset);return this.offset+=4,e}readU64(){const e=this.readBuffer(8);return new Ut.default(e,"le")}readU128(){const e=this.readBuffer(16);return new Ut.default(e,"le")}readU256(){const e=this.readBuffer(32);return new Ut.default(e,"le")}readU512(){const e=this.readBuffer(64);return new Ut.default(e,"le")}readBuffer(e){if(this.offset+e>this.buf.length)throw new We(`Expected buffer length ${e} isn't within bounds`);const t=this.buf.slice(this.offset,this.offset+e);return this.offset+=e,t}readString(){const e=this.readU32(),t=this.readBuffer(e);try{return ku.decode(t)}catch(r){throw new We(`Error decoding UTF-8 string: ${r}`)}}readFixedArray(e){return new Uint8Array(this.readBuffer(e))}readArray(e){const t=this.readU32(),r=Array();for(let s=0;s<t;++s)r.push(e());return r}}bt([wt],et.prototype,"readU8",null);bt([wt],et.prototype,"readU16",null);bt([wt],et.prototype,"readU32",null);bt([wt],et.prototype,"readU64",null);bt([wt],et.prototype,"readU128",null);bt([wt],et.prototype,"readU256",null);bt([wt],et.prototype,"readU512",null);bt([wt],et.prototype,"readString",null);bt([wt],et.prototype,"readFixedArray",null);bt([wt],et.prototype,"readArray",null);Be.BinaryReader=et;function Po(n){return n.charAt(0).toUpperCase()+n.slice(1)}function $t(n,e,t,r,s){try{if(typeof r=="string")s[`write${Po(r)}`](t);else if(r instanceof Array)if(typeof r[0]=="number"){if(t.length!==r[0])throw new We(`Expecting byte array of length ${r[0]}, but got ${t.length} bytes`);s.writeFixedArray(t)}else if(r.length===2&&typeof r[1]=="number"){if(t.length!==r[1])throw new We(`Expecting byte array of length ${r[1]}, but got ${t.length} bytes`);for(let i=0;i<r[1];i++)$t(n,null,t[i],r[0],s)}else s.writeArray(t,i=>{$t(n,e,i,r[0],s)});else if(r.kind!==void 0)switch(r.kind){case"option":{t==null?s.writeU8(0):(s.writeU8(1),$t(n,e,t,r.type,s));break}case"map":{s.writeU32(t.size),t.forEach((i,o)=>{$t(n,e,o,r.key,s),$t(n,e,i,r.value,s)});break}default:throw new We(`FieldType ${r} unrecognized`)}else Bo(n,t,s)}catch(i){throw i instanceof We&&i.addToFieldPath(e),i}}function Bo(n,e,t){if(typeof e.borshSerialize=="function"){e.borshSerialize(t);return}const r=n.get(e.constructor);if(!r)throw new We(`Class ${e.constructor.name} is missing in schema`);if(r.kind==="struct")r.fields.map(([s,i])=>{$t(n,s,e[s],i,t)});else if(r.kind==="enum"){const s=e[r.field];for(let i=0;i<r.values.length;++i){const[o,a]=r.values[i];if(o===s){t.writeU8(i),$t(n,o,e[o],a,t);break}}}else throw new We(`Unexpected schema kind: ${r.kind} for ${e.constructor.name}`)}function Eu(n,e,t=Ro){const r=new t;return Bo(n,e,r),r.toArray()}var To=Be.serialize=Eu;function Vt(n,e,t,r){try{if(typeof t=="string")return r[`read${Po(t)}`]();if(t instanceof Array){if(typeof t[0]=="number")return r.readFixedArray(t[0]);if(typeof t[1]=="number"){const s=[];for(let i=0;i<t[1];i++)s.push(Vt(n,null,t[0],r));return s}else return r.readArray(()=>Vt(n,e,t[0],r))}if(t.kind==="option")return r.readU8()?Vt(n,e,t.type,r):void 0;if(t.kind==="map"){let s=new Map;const i=r.readU32();for(let o=0;o<i;o++){const a=Vt(n,e,t.key,r),c=Vt(n,e,t.value,r);s.set(a,c)}return s}return Ps(n,t,r)}catch(s){throw s instanceof We&&s.addToFieldPath(e),s}}function Ps(n,e,t){if(typeof e.borshDeserialize=="function")return e.borshDeserialize(t);const r=n.get(e);if(!r)throw new We(`Class ${e.name} is missing in schema`);if(r.kind==="struct"){const s={};for(const[i,o]of n.get(e).fields)s[i]=Vt(n,i,o,t);return new e(s)}if(r.kind==="enum"){const s=t.readU8();if(s>=r.values.length)throw new We(`Enum index: ${s} is out of range`);const[i,o]=r.values[s],a=Vt(n,i,o,t);return new e({[i]:a})}throw new We(`Unexpected schema kind: ${r.kind} for ${e.constructor.name}`)}function Iu(n,e,t,r=et){const s=new r(t),i=Ps(n,e,s);if(s.offset<t.length)throw new We(`Unexpected ${t.length-s.offset} bytes after deserialized data`);return i}var Co=Be.deserialize=Iu;function Au(n,e,t,r=et){const s=new r(t);return Ps(n,e,s)}Ao=Be.deserializeUnchecked=Au;var w={};Object.defineProperty(w,"__esModule",{value:!0});w.s16=w.s8=w.nu64be=w.u48be=w.u40be=w.u32be=w.u24be=w.u16be=Pe=w.nu64=w.u48=w.u40=D=w.u32=w.u24=nt=w.u16=re=w.u8=Kt=w.offset=w.greedy=w.Constant=w.UTF8=w.CString=w.Blob=w.Boolean=w.BitField=w.BitStructure=w.VariantLayout=w.Union=w.UnionLayoutDiscriminator=w.UnionDiscriminator=w.Structure=w.Sequence=w.DoubleBE=w.Double=w.FloatBE=w.Float=w.NearInt64BE=w.NearInt64=w.NearUInt64BE=w.NearUInt64=w.IntBE=w.Int=w.UIntBE=w.UInt=w.OffsetLayout=w.GreedyCount=w.ExternalLayout=w.bindConstructorLayout=w.nameWithProperty=w.Layout=w.uint8ArrayToBuffer=w.checkUint8Array=void 0;w.constant=w.utf8=w.cstr=he=w.blob=w.unionLayoutDiscriminator=w.union=Ce=w.seq=w.bits=M=w.struct=w.f64be=w.f64=w.f32be=w.f32=w.ns64be=w.s48be=w.s40be=w.s32be=w.s24be=w.s16be=Je=w.ns64=w.s48=w.s40=w.s32=w.s24=void 0;const Bs=$;function _r(n){if(!(n instanceof Uint8Array))throw new TypeError("b must be a Uint8Array")}w.checkUint8Array=_r;function ie(n){return _r(n),Bs.Buffer.from(n.buffer,n.byteOffset,n.length)}w.uint8ArrayToBuffer=ie;class ce{constructor(e,t){if(!Number.isInteger(e))throw new TypeError("span must be an integer");this.span=e,this.property=t}makeDestinationObject(){return{}}getSpan(e,t){if(0>this.span)throw new RangeError("indeterminate span");return this.span}replicate(e){const t=Object.create(this.constructor.prototype);return Object.assign(t,this),t.property=e,t}fromArray(e){}}w.Layout=ce;function Ts(n,e){return e.property?n+"["+e.property+"]":n}w.nameWithProperty=Ts;function xu(n,e){if(typeof n!="function")throw new TypeError("Class must be constructor");if(Object.prototype.hasOwnProperty.call(n,"layout_"))throw new Error("Class is already bound to a layout");if(!(e&&e instanceof ce))throw new TypeError("layout must be a Layout");if(Object.prototype.hasOwnProperty.call(e,"boundConstructor_"))throw new Error("layout is already bound to a constructor");n.layout_=e,e.boundConstructor_=n,e.makeDestinationObject=()=>new n,Object.defineProperty(n.prototype,"encode",{value(t,r){return e.encode(this,t,r)},writable:!0}),Object.defineProperty(n,"decode",{value(t,r){return e.decode(t,r)},writable:!0})}w.bindConstructorLayout=xu;class $e extends ce{isCount(){throw new Error("ExternalLayout is abstract")}}w.ExternalLayout=$e;class Oo extends $e{constructor(e=1,t){if(!Number.isInteger(e)||0>=e)throw new TypeError("elementSpan must be a (positive) integer");super(-1,t),this.elementSpan=e}isCount(){return!0}decode(e,t=0){_r(e);const r=e.length-t;return Math.floor(r/this.elementSpan)}encode(e,t,r){return 0}}w.GreedyCount=Oo;class Cs extends $e{constructor(e,t=0,r){if(!(e instanceof ce))throw new TypeError("layout must be a Layout");if(!Number.isInteger(t))throw new TypeError("offset must be integer or undefined");super(e.span,r||e.property),this.layout=e,this.offset=t}isCount(){return this.layout instanceof st||this.layout instanceof ot}decode(e,t=0){return this.layout.decode(e,t+this.offset)}encode(e,t,r=0){return this.layout.encode(e,t,r+this.offset)}}w.OffsetLayout=Cs;class st extends ce{constructor(e,t){if(super(e,t),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(e,t=0){return ie(e).readUIntLE(t,this.span)}encode(e,t,r=0){return ie(t).writeUIntLE(e,r,this.span),this.span}}w.UInt=st;class ot extends ce{constructor(e,t){if(super(e,t),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(e,t=0){return ie(e).readUIntBE(t,this.span)}encode(e,t,r=0){return ie(t).writeUIntBE(e,r,this.span),this.span}}w.UIntBE=ot;class sr extends ce{constructor(e,t){if(super(e,t),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(e,t=0){return ie(e).readIntLE(t,this.span)}encode(e,t,r=0){return ie(t).writeIntLE(e,r,this.span),this.span}}w.Int=sr;class Er extends ce{constructor(e,t){if(super(e,t),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(e,t=0){return ie(e).readIntBE(t,this.span)}encode(e,t,r=0){return ie(t).writeIntBE(e,r,this.span),this.span}}w.IntBE=Er;const ds=Math.pow(2,32);function gn(n){const e=Math.floor(n/ds),t=n-e*ds;return{hi32:e,lo32:t}}function yn(n,e){return n*ds+e}class Lo extends ce{constructor(e){super(8,e)}decode(e,t=0){const r=ie(e),s=r.readUInt32LE(t),i=r.readUInt32LE(t+4);return yn(i,s)}encode(e,t,r=0){const s=gn(e),i=ie(t);return i.writeUInt32LE(s.lo32,r),i.writeUInt32LE(s.hi32,r+4),8}}w.NearUInt64=Lo;class No extends ce{constructor(e){super(8,e)}decode(e,t=0){const r=ie(e),s=r.readUInt32BE(t),i=r.readUInt32BE(t+4);return yn(s,i)}encode(e,t,r=0){const s=gn(e),i=ie(t);return i.writeUInt32BE(s.hi32,r),i.writeUInt32BE(s.lo32,r+4),8}}w.NearUInt64BE=No;class Uo extends ce{constructor(e){super(8,e)}decode(e,t=0){const r=ie(e),s=r.readUInt32LE(t),i=r.readInt32LE(t+4);return yn(i,s)}encode(e,t,r=0){const s=gn(e),i=ie(t);return i.writeUInt32LE(s.lo32,r),i.writeInt32LE(s.hi32,r+4),8}}w.NearInt64=Uo;class Fo extends ce{constructor(e){super(8,e)}decode(e,t=0){const r=ie(e),s=r.readInt32BE(t),i=r.readUInt32BE(t+4);return yn(s,i)}encode(e,t,r=0){const s=gn(e),i=ie(t);return i.writeInt32BE(s.hi32,r),i.writeUInt32BE(s.lo32,r+4),8}}w.NearInt64BE=Fo;class Ko extends ce{constructor(e){super(4,e)}decode(e,t=0){return ie(e).readFloatLE(t)}encode(e,t,r=0){return ie(t).writeFloatLE(e,r),4}}w.Float=Ko;class zo extends ce{constructor(e){super(4,e)}decode(e,t=0){return ie(e).readFloatBE(t)}encode(e,t,r=0){return ie(t).writeFloatBE(e,r),4}}w.FloatBE=zo;class Do extends ce{constructor(e){super(8,e)}decode(e,t=0){return ie(e).readDoubleLE(t)}encode(e,t,r=0){return ie(t).writeDoubleLE(e,r),8}}w.Double=Do;class Mo extends ce{constructor(e){super(8,e)}decode(e,t=0){return ie(e).readDoubleBE(t)}encode(e,t,r=0){return ie(t).writeDoubleBE(e,r),8}}w.DoubleBE=Mo;class Wo extends ce{constructor(e,t,r){if(!(e instanceof ce))throw new TypeError("elementLayout must be a Layout");if(!(t instanceof $e&&t.isCount()||Number.isInteger(t)&&0<=t))throw new TypeError("count must be non-negative integer or an unsigned integer ExternalLayout");let s=-1;!(t instanceof $e)&&0<e.span&&(s=t*e.span),super(s,r),this.elementLayout=e,this.count=t}getSpan(e,t=0){if(0<=this.span)return this.span;let r=0,s=this.count;if(s instanceof $e&&(s=s.decode(e,t)),0<this.elementLayout.span)r=s*this.elementLayout.span;else{let i=0;for(;i<s;)r+=this.elementLayout.getSpan(e,t+r),++i}return r}decode(e,t=0){const r=[];let s=0,i=this.count;for(i instanceof $e&&(i=i.decode(e,t));s<i;)r.push(this.elementLayout.decode(e,t)),t+=this.elementLayout.getSpan(e,t),s+=1;return r}encode(e,t,r=0){const s=this.elementLayout,i=e.reduce((o,a)=>o+s.encode(a,t,r+o),0);return this.count instanceof $e&&this.count.encode(e.length,t,r),i}}w.Sequence=Wo;class qo extends ce{constructor(e,t,r){if(!(Array.isArray(e)&&e.reduce((i,o)=>i&&o instanceof ce,!0)))throw new TypeError("fields must be array of Layout instances");typeof t=="boolean"&&r===void 0&&(r=t,t=void 0);for(const i of e)if(0>i.span&&i.property===void 0)throw new Error("fields cannot contain unnamed variable-length layout");let s=-1;try{s=e.reduce((i,o)=>i+o.getSpan(),0)}catch{}super(s,t),this.fields=e,this.decodePrefixes=!!r}getSpan(e,t=0){if(0<=this.span)return this.span;let r=0;try{r=this.fields.reduce((s,i)=>{const o=i.getSpan(e,t);return t+=o,s+o},0)}catch{throw new RangeError("indeterminate span")}return r}decode(e,t=0){_r(e);const r=this.makeDestinationObject();for(const s of this.fields)if(s.property!==void 0&&(r[s.property]=s.decode(e,t)),t+=s.getSpan(e,t),this.decodePrefixes&&e.length===t)break;return r}encode(e,t,r=0){const s=r;let i=0,o=0;for(const a of this.fields){let c=a.span;if(o=0<c?c:0,a.property!==void 0){const l=e[a.property];l!==void 0&&(o=a.encode(l,t,r),0>c&&(c=a.getSpan(t,r)))}i=r,r+=c}return i+o-s}fromArray(e){const t=this.makeDestinationObject();for(const r of this.fields)r.property!==void 0&&0<e.length&&(t[r.property]=e.shift());return t}layoutFor(e){if(typeof e!="string")throw new TypeError("property must be string");for(const t of this.fields)if(t.property===e)return t}offsetOf(e){if(typeof e!="string")throw new TypeError("property must be string");let t=0;for(const r of this.fields){if(r.property===e)return t;0>r.span?t=-1:0<=t&&(t+=r.span)}}}w.Structure=qo;class Os{constructor(e){this.property=e}decode(e,t){throw new Error("UnionDiscriminator is abstract")}encode(e,t,r){throw new Error("UnionDiscriminator is abstract")}}w.UnionDiscriminator=Os;class an extends Os{constructor(e,t){if(!(e instanceof $e&&e.isCount()))throw new TypeError("layout must be an unsigned integer ExternalLayout");super(t||e.property||"variant"),this.layout=e}decode(e,t){return this.layout.decode(e,t)}encode(e,t,r){return this.layout.encode(e,t,r)}}w.UnionLayoutDiscriminator=an;class Ls extends ce{constructor(e,t,r){let s;if(e instanceof st||e instanceof ot)s=new an(new Cs(e));else if(e instanceof $e&&e.isCount())s=new an(e);else if(e instanceof Os)s=e;else throw new TypeError("discr must be a UnionDiscriminator or an unsigned integer layout");if(t===void 0&&(t=null),!(t===null||t instanceof ce))throw new TypeError("defaultLayout must be null or a Layout");if(t!==null){if(0>t.span)throw new Error("defaultLayout must have constant span");t.property===void 0&&(t=t.replicate("content"))}let i=-1;t&&(i=t.span,0<=i&&(e instanceof st||e instanceof ot)&&(i+=s.layout.span)),super(i,r),this.discriminator=s,this.usesPrefixDiscriminator=e instanceof st||e instanceof ot,this.defaultLayout=t,this.registry={};let o=this.defaultGetSourceVariant.bind(this);this.getSourceVariant=function(a){return o(a)},this.configGetSourceVariant=function(a){o=a.bind(this)}}getSpan(e,t=0){if(0<=this.span)return this.span;const r=this.getVariant(e,t);if(!r)throw new Error("unable to determine span for unrecognized variant");return r.getSpan(e,t)}defaultGetSourceVariant(e){if(Object.prototype.hasOwnProperty.call(e,this.discriminator.property)){if(this.defaultLayout&&this.defaultLayout.property&&Object.prototype.hasOwnProperty.call(e,this.defaultLayout.property))return;const t=this.registry[e[this.discriminator.property]];if(t&&(!t.layout||t.property&&Object.prototype.hasOwnProperty.call(e,t.property)))return t}else for(const t in this.registry){const r=this.registry[t];if(r.property&&Object.prototype.hasOwnProperty.call(e,r.property))return r}throw new Error("unable to infer src variant")}decode(e,t=0){let r;const s=this.discriminator,i=s.decode(e,t),o=this.registry[i];if(o===void 0){const a=this.defaultLayout;let c=0;this.usesPrefixDiscriminator&&(c=s.layout.span),r=this.makeDestinationObject(),r[s.property]=i,r[a.property]=a.decode(e,t+c)}else r=o.decode(e,t);return r}encode(e,t,r=0){const s=this.getSourceVariant(e);if(s===void 0){const i=this.discriminator,o=this.defaultLayout;let a=0;return this.usesPrefixDiscriminator&&(a=i.layout.span),i.encode(e[i.property],t,r),a+o.encode(e[o.property],t,r+a)}return s.encode(e,t,r)}addVariant(e,t,r){const s=new jo(this,e,t,r);return this.registry[e]=s,s}getVariant(e,t=0){let r;return e instanceof Uint8Array?r=this.discriminator.decode(e,t):r=e,this.registry[r]}}w.Union=Ls;class jo extends ce{constructor(e,t,r,s){if(!(e instanceof Ls))throw new TypeError("union must be a Union");if(!Number.isInteger(t)||0>t)throw new TypeError("variant must be a (non-negative) integer");if(typeof r=="string"&&s===void 0&&(s=r,r=null),r){if(!(r instanceof ce))throw new TypeError("layout must be a Layout");if(e.defaultLayout!==null&&0<=r.span&&r.span>e.defaultLayout.span)throw new Error("variant span exceeds span of containing union");if(typeof s!="string")throw new TypeError("variant must have a String property")}let i=e.span;0>e.span&&(i=r?r.span:0,0<=i&&e.usesPrefixDiscriminator&&(i+=e.discriminator.layout.span)),super(i,s),this.union=e,this.variant=t,this.layout=r||null}getSpan(e,t=0){if(0<=this.span)return this.span;let r=0;this.union.usesPrefixDiscriminator&&(r=this.union.discriminator.layout.span);let s=0;return this.layout&&(s=this.layout.getSpan(e,t+r)),r+s}decode(e,t=0){const r=this.makeDestinationObject();if(this!==this.union.getVariant(e,t))throw new Error("variant mismatch");let s=0;return this.union.usesPrefixDiscriminator&&(s=this.union.discriminator.layout.span),this.layout?r[this.property]=this.layout.decode(e,t+s):this.property?r[this.property]=!0:this.union.usesPrefixDiscriminator&&(r[this.union.discriminator.property]=this.variant),r}encode(e,t,r=0){let s=0;if(this.union.usesPrefixDiscriminator&&(s=this.union.discriminator.layout.span),this.layout&&!Object.prototype.hasOwnProperty.call(e,this.property))throw new TypeError("variant lacks property "+this.property);this.union.discriminator.encode(this.variant,t,r);let i=s;if(this.layout&&(this.layout.encode(e[this.property],t,r+s),i+=this.layout.getSpan(t,r+s),0<=this.union.span&&i>this.union.span))throw new Error("encoded variant overruns containing union");return i}fromArray(e){if(this.layout)return this.layout.fromArray(e)}}w.VariantLayout=jo;function lr(n){return 0>n&&(n+=4294967296),n}class Ns extends ce{constructor(e,t,r){if(!(e instanceof st||e instanceof ot))throw new TypeError("word must be a UInt or UIntBE layout");if(typeof t=="string"&&r===void 0&&(r=t,t=!1),4<e.span)throw new RangeError("word cannot exceed 32 bits");super(e.span,r),this.word=e,this.msb=!!t,this.fields=[];let s=0;this._packedSetValue=function(i){return s=lr(i),this},this._packedGetValue=function(){return s}}decode(e,t=0){const r=this.makeDestinationObject(),s=this.word.decode(e,t);this._packedSetValue(s);for(const i of this.fields)i.property!==void 0&&(r[i.property]=i.decode(e));return r}encode(e,t,r=0){const s=this.word.decode(t,r);this._packedSetValue(s);for(const i of this.fields)if(i.property!==void 0){const o=e[i.property];o!==void 0&&i.encode(o)}return this.word.encode(this._packedGetValue(),t,r)}addField(e,t){const r=new Us(this,e,t);return this.fields.push(r),r}addBoolean(e){const t=new $o(this,e);return this.fields.push(t),t}fieldFor(e){if(typeof e!="string")throw new TypeError("property must be string");for(const t of this.fields)if(t.property===e)return t}}w.BitStructure=Ns;class Us{constructor(e,t,r){if(!(e instanceof Ns))throw new TypeError("container must be a BitStructure");if(!Number.isInteger(t)||0>=t)throw new TypeError("bits must be positive integer");const s=8*e.span,i=e.fields.reduce((o,a)=>o+a.bits,0);if(t+i>s)throw new Error("bits too long for span remainder ("+(s-i)+" of "+s+" remain)");this.container=e,this.bits=t,this.valueMask=(1<<t)-1,t===32&&(this.valueMask=4294967295),this.start=i,this.container.msb&&(this.start=s-i-t),this.wordMask=lr(this.valueMask<<this.start),this.property=r}decode(e,t){const r=this.container._packedGetValue();return lr(r&this.wordMask)>>>this.start}encode(e){if(typeof e!="number"||!Number.isInteger(e)||e!==lr(e&this.valueMask))throw new TypeError(Ts("BitField.encode",this)+" value must be integer not exceeding "+this.valueMask);const t=this.container._packedGetValue(),r=lr(e<<this.start);this.container._packedSetValue(lr(t&~this.wordMask)|r)}}w.BitField=Us;let $o=class extends Us{constructor(e,t){super(e,1,t)}decode(e,t){return!!super.decode(e,t)}encode(e){typeof e=="boolean"&&(e=+e),super.encode(e)}};w.Boolean=$o;class Vo extends ce{constructor(e,t){if(!(e instanceof $e&&e.isCount()||Number.isInteger(e)&&0<=e))throw new TypeError("length must be positive integer or an unsigned integer ExternalLayout");let r=-1;e instanceof $e||(r=e),super(r,t),this.length=e}getSpan(e,t){let r=this.span;return 0>r&&(r=this.length.decode(e,t)),r}decode(e,t=0){let r=this.span;return 0>r&&(r=this.length.decode(e,t)),ie(e).slice(t,t+r)}encode(e,t,r){let s=this.length;if(this.length instanceof $e&&(s=e.length),!(e instanceof Uint8Array&&s===e.length))throw new TypeError(Ts("Blob.encode",this)+" requires (length "+s+") Uint8Array as src");if(r+s>t.length)throw new RangeError("encoding overruns Uint8Array");const i=ie(e);return ie(t).write(i.toString("hex"),r,s,"hex"),this.length instanceof $e&&this.length.encode(s,t,r),s}}w.Blob=Vo;class Ho extends ce{constructor(e){super(-1,e)}getSpan(e,t=0){_r(e);let r=t;for(;r<e.length&&e[r]!==0;)r+=1;return 1+r-t}decode(e,t=0){const r=this.getSpan(e,t);return ie(e).slice(t,t+r-1).toString("utf-8")}encode(e,t,r=0){typeof e!="string"&&(e=String(e));const s=Bs.Buffer.from(e,"utf8"),i=s.length;if(r+i>t.length)throw new RangeError("encoding overruns Buffer");const o=ie(t);return s.copy(o,r),o[r+i]=0,i+1}}w.CString=Ho;class Go extends ce{constructor(e,t){if(typeof e=="string"&&t===void 0&&(t=e,e=void 0),e===void 0)e=-1;else if(!Number.isInteger(e))throw new TypeError("maxSpan must be an integer");super(-1,t),this.maxSpan=e}getSpan(e,t=0){return _r(e),e.length-t}decode(e,t=0){const r=this.getSpan(e,t);if(0<=this.maxSpan&&this.maxSpan<r)throw new RangeError("text length exceeds maxSpan");return ie(e).slice(t,t+r).toString("utf-8")}encode(e,t,r=0){typeof e!="string"&&(e=String(e));const s=Bs.Buffer.from(e,"utf8"),i=s.length;if(0<=this.maxSpan&&this.maxSpan<i)throw new RangeError("text length exceeds maxSpan");if(r+i>t.length)throw new RangeError("encoding overruns Buffer");return s.copy(ie(t),r),i}}w.UTF8=Go;class Yo extends ce{constructor(e,t){super(0,t),this.value=e}decode(e,t){return this.value}encode(e,t,r){return 0}}w.Constant=Yo;w.greedy=(n,e)=>new Oo(n,e);var Kt=w.offset=(n,e,t)=>new Cs(n,e,t),re=w.u8=n=>new st(1,n),nt=w.u16=n=>new st(2,n);w.u24=n=>new st(3,n);var D=w.u32=n=>new st(4,n);w.u40=n=>new st(5,n);w.u48=n=>new st(6,n);var Pe=w.nu64=n=>new Lo(n);w.u16be=n=>new ot(2,n);w.u24be=n=>new ot(3,n);w.u32be=n=>new ot(4,n);w.u40be=n=>new ot(5,n);w.u48be=n=>new ot(6,n);w.nu64be=n=>new No(n);w.s8=n=>new sr(1,n);w.s16=n=>new sr(2,n);w.s24=n=>new sr(3,n);w.s32=n=>new sr(4,n);w.s40=n=>new sr(5,n);w.s48=n=>new sr(6,n);var Je=w.ns64=n=>new Uo(n);w.s16be=n=>new Er(2,n);w.s24be=n=>new Er(3,n);w.s32be=n=>new Er(4,n);w.s40be=n=>new Er(5,n);w.s48be=n=>new Er(6,n);w.ns64be=n=>new Fo(n);w.f32=n=>new Ko(n);w.f32be=n=>new zo(n);w.f64=n=>new Do(n);w.f64be=n=>new Mo(n);var M=w.struct=(n,e,t)=>new qo(n,e,t);w.bits=(n,e,t)=>new Ns(n,e,t);var Ce=w.seq=(n,e,t)=>new Wo(n,e,t);w.union=(n,e,t)=>new Ls(n,e,t);w.unionLayoutDiscriminator=(n,e)=>new an(n,e);var he=w.blob=(n,e)=>new Vo(n,e);w.cstr=n=>new Ho(n);w.utf8=(n,e)=>new Go(n,e);w.constant=(n,e)=>new Yo(n,e);var Kr={};Object.defineProperty(Kr,"__esModule",{value:!0});function Ru(n){{const e=Buffer.from(n);e.reverse();const t=e.toString("hex");return t.length===0?BigInt(0):BigInt(`0x${t}`)}}var Pu=Kr.toBigIntLE=Ru;function Bu(n){{const e=n.toString("hex");return e.length===0?BigInt(0):BigInt(`0x${e}`)}}Kr.toBigIntBE=Bu;function Tu(n,e){{const t=n.toString(16),r=Buffer.from(t.padStart(e*2,"0").slice(0,e*2),"hex");return r.reverse(),r}}var Jo=Kr.toBufferLE=Tu;function Cu(n,e){{const t=n.toString(16);return Buffer.from(t.padStart(e*2,"0").slice(0,e*2),"hex")}}Kr.toBufferBE=Cu;class Ou extends TypeError{constructor(e,t){let r;const{message:s,...i}=e,{path:o}=e,a=o.length===0?s:"At path: "+o.join(".")+" -- "+s;super(a),Object.assign(this,i),this.name=this.constructor.name,this.failures=()=>{var c;return(c=r)!=null?c:r=[e,...t()]}}}function Lu(n){return zt(n)&&typeof n[Symbol.iterator]=="function"}function zt(n){return typeof n=="object"&&n!=null}function at(n){return typeof n=="string"?JSON.stringify(n):""+n}function Nu(n){const{done:e,value:t}=n.next();return e?void 0:t}function Uu(n,e,t,r){if(n===!0)return;n===!1?n={}:typeof n=="string"&&(n={message:n});const{path:s,branch:i}=e,{type:o}=t,{refinement:a,message:c="Expected a value of type `"+o+"`"+(a?" with refinement `"+a+"`":"")+", but received: `"+at(r)+"`"}=n;return{value:r,type:o,refinement:a,key:s[s.length-1],path:s,branch:i,...n,message:c}}function*Ti(n,e,t,r){Lu(n)||(n=[n]);for(const s of n){const i=Uu(s,e,t,r);i&&(yield i)}}function*Fs(n,e,t={}){const{path:r=[],branch:s=[n],coerce:i=!1,mask:o=!1}=t,a={path:r,branch:s};if(i&&(n=e.coercer(n,a),o&&e.type!=="type"&&zt(e.schema)&&zt(n)&&!Array.isArray(n)))for(const l in n)e.schema[l]===void 0&&delete n[l];let c=!0;for(const l of e.validator(n,a))c=!1,yield[l,void 0];for(let[l,u,h]of e.entries(n,a)){const g=Fs(u,h,{path:l===void 0?r:[...r,l],branch:l===void 0?s:[...s,u],coerce:i,mask:o});for(const d of g)d[0]?(c=!1,yield[d[0],void 0]):i&&(u=d[1],l===void 0?n=u:n instanceof Map?n.set(l,u):n instanceof Set?n.add(u):zt(n)&&(n[l]=u))}if(c)for(const l of e.refiner(n,a))c=!1,yield[l,void 0];c&&(yield[void 0,n])}let vt=class{constructor(e){const{type:t,schema:r,validator:s,refiner:i,coercer:o=c=>c,entries:a=function*(){}}=e;this.type=t,this.schema=r,this.entries=a,this.coercer=o,s?this.validator=(c,l)=>{const u=s(c,l);return Ti(u,l,this,c)}:this.validator=()=>[],i?this.refiner=(c,l)=>{const u=i(c,l);return Ti(u,l,this,c)}:this.refiner=()=>[]}assert(e){return Zo(e,this)}create(e){return L(e,this)}is(e){return Xo(e,this)}mask(e){return Fu(e,this)}validate(e,t={}){return zr(e,this,t)}};function Zo(n,e){const t=zr(n,e);if(t[0])throw t[0]}function L(n,e){const t=zr(n,e,{coerce:!0});if(t[0])throw t[0];return t[1]}function Fu(n,e){const t=zr(n,e,{coerce:!0,mask:!0});if(t[0])throw t[0];return t[1]}function Xo(n,e){return!zr(n,e)[0]}function zr(n,e,t={}){const r=Fs(n,e,t),s=Nu(r);return s[0]?[new Ou(s[0],function*(){for(const o of r)o[0]&&(yield o[0])}),void 0]:[void 0,s[1]]}function ir(n,e){return new vt({type:n,schema:null,validator:e})}function Ku(){return ir("any",()=>!0)}function z(n){return new vt({type:"array",schema:n,*entries(e){if(n&&Array.isArray(e))for(const[t,r]of e.entries())yield[t,r,n]},coercer(e){return Array.isArray(e)?e.slice():e},validator(e){return Array.isArray(e)||"Expected an array value, but received: "+at(e)}})}function yt(){return ir("boolean",n=>typeof n=="boolean")}function Ks(n){return ir("instance",e=>e instanceof n||"Expected a `"+n.name+"` instance, but received: "+at(e))}function ye(n){const e=at(n),t=typeof n;return new vt({type:"literal",schema:t==="string"||t==="number"||t==="boolean"?n:null,validator(r){return r===n||"Expected the literal `"+e+"`, but received: "+at(r)}})}function zu(){return ir("never",()=>!1)}function F(n){return new vt({...n,validator:(e,t)=>e===null||n.validator(e,t),refiner:(e,t)=>e===null||n.refiner(e,t)})}function m(){return ir("number",n=>typeof n=="number"&&!isNaN(n)||"Expected a number, but received: "+at(n))}function V(n){return new vt({...n,validator:(e,t)=>e===void 0||n.validator(e,t),refiner:(e,t)=>e===void 0||n.refiner(e,t)})}function Qo(n,e){return new vt({type:"record",schema:null,*entries(t){if(zt(t))for(const r in t){const s=t[r];yield[r,r,n],yield[r,s,e]}},validator(t){return zt(t)||"Expected an object, but received: "+at(t)}})}function C(){return ir("string",n=>typeof n=="string"||"Expected a string, but received: "+at(n))}function zs(n){const e=zu();return new vt({type:"tuple",schema:null,*entries(t){if(Array.isArray(t)){const r=Math.max(n.length,t.length);for(let s=0;s<r;s++)yield[s,t[s],n[s]||e]}},validator(t){return Array.isArray(t)||"Expected an array, but received: "+at(t)}})}function P(n){const e=Object.keys(n);return new vt({type:"type",schema:n,*entries(t){if(zt(t))for(const r of e)yield[r,t[r],n[r]]},validator(t){return zt(t)||"Expected an object, but received: "+at(t)}})}function He(n){const e=n.map(t=>t.type).join(" | ");return new vt({type:"union",schema:null,validator(t,r){const s=[];for(const i of n){const[...o]=Fs(t,i,r),[a]=o;if(a[0])for(const[c]of o)c&&s.push(c);else return[]}return["Expected the value to satisfy a union of `"+e+"`, but received: "+at(t),...s]}})}function Dr(){return ir("unknown",()=>!0)}function Mr(n,e,t){return new vt({...n,coercer:(r,s)=>Xo(r,e)?n.coercer(t(r,s),s):n.coercer(r,s)})}var Zr,Du=new Uint8Array(16);function ea(){if(!Zr&&(Zr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Zr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Zr(Du)}const Mu=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function mn(n){return typeof n=="string"&&Mu.test(n)}var xe=[];for(var zn=0;zn<256;++zn)xe.push((zn+256).toString(16).substr(1));function bn(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(xe[n[e+0]]+xe[n[e+1]]+xe[n[e+2]]+xe[n[e+3]]+"-"+xe[n[e+4]]+xe[n[e+5]]+"-"+xe[n[e+6]]+xe[n[e+7]]+"-"+xe[n[e+8]]+xe[n[e+9]]+"-"+xe[n[e+10]]+xe[n[e+11]]+xe[n[e+12]]+xe[n[e+13]]+xe[n[e+14]]+xe[n[e+15]]).toLowerCase();if(!mn(t))throw TypeError("Stringified UUID is invalid");return t}var Ci,Dn,Mn=0,Wn=0;function Wu(n,e,t){var r=e&&t||0,s=e||new Array(16);n=n||{};var i=n.node||Ci,o=n.clockseq!==void 0?n.clockseq:Dn;if(i==null||o==null){var a=n.random||(n.rng||ea)();i==null&&(i=Ci=[a[0]|1,a[1],a[2],a[3],a[4],a[5]]),o==null&&(o=Dn=(a[6]<<8|a[7])&16383)}var c=n.msecs!==void 0?n.msecs:Date.now(),l=n.nsecs!==void 0?n.nsecs:Wn+1,u=c-Mn+(l-Wn)/1e4;if(u<0&&n.clockseq===void 0&&(o=o+1&16383),(u<0||c>Mn)&&n.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Mn=c,Wn=l,Dn=o,c+=122192928e5;var h=((c&268435455)*1e4+l)%4294967296;s[r++]=h>>>24&255,s[r++]=h>>>16&255,s[r++]=h>>>8&255,s[r++]=h&255;var g=c/4294967296*1e4&268435455;s[r++]=g>>>8&255,s[r++]=g&255,s[r++]=g>>>24&15|16,s[r++]=g>>>16&255,s[r++]=o>>>8|128,s[r++]=o&255;for(var d=0;d<6;++d)s[r+d]=i[d];return e||bn(s)}function ta(n){if(!mn(n))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}function qu(n){n=unescape(encodeURIComponent(n));for(var e=[],t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e}var ju="6ba7b810-9dad-11d1-80b4-00c04fd430c8",$u="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function ra(n,e,t){function r(s,i,o,a){if(typeof s=="string"&&(s=qu(s)),typeof i=="string"&&(i=ta(i)),i.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+s.length);if(c.set(i),c.set(s,i.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,o){a=a||0;for(var l=0;l<16;++l)o[a+l]=c[l];return o}return bn(c)}try{r.name=n}catch{}return r.DNS=ju,r.URL=$u,r}function Vu(n){if(typeof n=="string"){var e=unescape(encodeURIComponent(n));n=new Uint8Array(e.length);for(var t=0;t<e.length;++t)n[t]=e.charCodeAt(t)}return Hu(Gu(Yu(n),n.length*8))}function Hu(n){for(var e=[],t=n.length*32,r="0123456789abcdef",s=0;s<t;s+=8){var i=n[s>>5]>>>s%32&255,o=parseInt(r.charAt(i>>>4&15)+r.charAt(i&15),16);e.push(o)}return e}function na(n){return(n+64>>>9<<4)+14+1}function Gu(n,e){n[e>>5]|=128<<e%32,n[na(e)-1]=e;for(var t=1732584193,r=-271733879,s=-1732584194,i=271733878,o=0;o<n.length;o+=16){var a=t,c=r,l=s,u=i;t=Oe(t,r,s,i,n[o],7,-680876936),i=Oe(i,t,r,s,n[o+1],12,-389564586),s=Oe(s,i,t,r,n[o+2],17,606105819),r=Oe(r,s,i,t,n[o+3],22,-1044525330),t=Oe(t,r,s,i,n[o+4],7,-176418897),i=Oe(i,t,r,s,n[o+5],12,1200080426),s=Oe(s,i,t,r,n[o+6],17,-1473231341),r=Oe(r,s,i,t,n[o+7],22,-45705983),t=Oe(t,r,s,i,n[o+8],7,1770035416),i=Oe(i,t,r,s,n[o+9],12,-1958414417),s=Oe(s,i,t,r,n[o+10],17,-42063),r=Oe(r,s,i,t,n[o+11],22,-1990404162),t=Oe(t,r,s,i,n[o+12],7,1804603682),i=Oe(i,t,r,s,n[o+13],12,-40341101),s=Oe(s,i,t,r,n[o+14],17,-1502002290),r=Oe(r,s,i,t,n[o+15],22,1236535329),t=Le(t,r,s,i,n[o+1],5,-165796510),i=Le(i,t,r,s,n[o+6],9,-1069501632),s=Le(s,i,t,r,n[o+11],14,643717713),r=Le(r,s,i,t,n[o],20,-373897302),t=Le(t,r,s,i,n[o+5],5,-701558691),i=Le(i,t,r,s,n[o+10],9,38016083),s=Le(s,i,t,r,n[o+15],14,-660478335),r=Le(r,s,i,t,n[o+4],20,-405537848),t=Le(t,r,s,i,n[o+9],5,568446438),i=Le(i,t,r,s,n[o+14],9,-1019803690),s=Le(s,i,t,r,n[o+3],14,-187363961),r=Le(r,s,i,t,n[o+8],20,1163531501),t=Le(t,r,s,i,n[o+13],5,-1444681467),i=Le(i,t,r,s,n[o+2],9,-51403784),s=Le(s,i,t,r,n[o+7],14,1735328473),r=Le(r,s,i,t,n[o+12],20,-1926607734),t=Ne(t,r,s,i,n[o+5],4,-378558),i=Ne(i,t,r,s,n[o+8],11,-2022574463),s=Ne(s,i,t,r,n[o+11],16,1839030562),r=Ne(r,s,i,t,n[o+14],23,-35309556),t=Ne(t,r,s,i,n[o+1],4,-1530992060),i=Ne(i,t,r,s,n[o+4],11,1272893353),s=Ne(s,i,t,r,n[o+7],16,-155497632),r=Ne(r,s,i,t,n[o+10],23,-1094730640),t=Ne(t,r,s,i,n[o+13],4,681279174),i=Ne(i,t,r,s,n[o],11,-358537222),s=Ne(s,i,t,r,n[o+3],16,-722521979),r=Ne(r,s,i,t,n[o+6],23,76029189),t=Ne(t,r,s,i,n[o+9],4,-640364487),i=Ne(i,t,r,s,n[o+12],11,-421815835),s=Ne(s,i,t,r,n[o+15],16,530742520),r=Ne(r,s,i,t,n[o+2],23,-995338651),t=Ue(t,r,s,i,n[o],6,-198630844),i=Ue(i,t,r,s,n[o+7],10,1126891415),s=Ue(s,i,t,r,n[o+14],15,-1416354905),r=Ue(r,s,i,t,n[o+5],21,-57434055),t=Ue(t,r,s,i,n[o+12],6,1700485571),i=Ue(i,t,r,s,n[o+3],10,-1894986606),s=Ue(s,i,t,r,n[o+10],15,-1051523),r=Ue(r,s,i,t,n[o+1],21,-2054922799),t=Ue(t,r,s,i,n[o+8],6,1873313359),i=Ue(i,t,r,s,n[o+15],10,-30611744),s=Ue(s,i,t,r,n[o+6],15,-1560198380),r=Ue(r,s,i,t,n[o+13],21,1309151649),t=Ue(t,r,s,i,n[o+4],6,-145523070),i=Ue(i,t,r,s,n[o+11],10,-1120210379),s=Ue(s,i,t,r,n[o+2],15,718787259),r=Ue(r,s,i,t,n[o+9],21,-343485551),t=Ft(t,a),r=Ft(r,c),s=Ft(s,l),i=Ft(i,u)}return[t,r,s,i]}function Yu(n){if(n.length===0)return[];for(var e=n.length*8,t=new Uint32Array(na(e)),r=0;r<e;r+=8)t[r>>5]|=(n[r/8]&255)<<r%32;return t}function Ft(n,e){var t=(n&65535)+(e&65535),r=(n>>16)+(e>>16)+(t>>16);return r<<16|t&65535}function Ju(n,e){return n<<e|n>>>32-e}function wn(n,e,t,r,s,i){return Ft(Ju(Ft(Ft(e,n),Ft(r,i)),s),t)}function Oe(n,e,t,r,s,i,o){return wn(e&t|~e&r,n,e,s,i,o)}function Le(n,e,t,r,s,i,o){return wn(e&r|t&~r,n,e,s,i,o)}function Ne(n,e,t,r,s,i,o){return wn(e^t^r,n,e,s,i,o)}function Ue(n,e,t,r,s,i,o){return wn(t^(e|~r),n,e,s,i,o)}var Zu=ra("v3",48,Vu);const Xu=Zu;function Qu(n,e,t){n=n||{};var r=n.random||(n.rng||ea)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var s=0;s<16;++s)e[t+s]=r[s];return e}return bn(r)}function el(n,e,t,r){switch(n){case 0:return e&t^~e&r;case 1:return e^t^r;case 2:return e&t^e&r^t&r;case 3:return e^t^r}}function qn(n,e){return n<<e|n>>>32-e}function tl(n){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){var r=unescape(encodeURIComponent(n));n=[];for(var s=0;s<r.length;++s)n.push(r.charCodeAt(s))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);for(var i=n.length/4+2,o=Math.ceil(i/16),a=new Array(o),c=0;c<o;++c){for(var l=new Uint32Array(16),u=0;u<16;++u)l[u]=n[c*64+u*4]<<24|n[c*64+u*4+1]<<16|n[c*64+u*4+2]<<8|n[c*64+u*4+3];a[c]=l}a[o-1][14]=(n.length-1)*8/Math.pow(2,32),a[o-1][14]=Math.floor(a[o-1][14]),a[o-1][15]=(n.length-1)*8&4294967295;for(var h=0;h<o;++h){for(var g=new Uint32Array(80),d=0;d<16;++d)g[d]=a[h][d];for(var p=16;p<80;++p)g[p]=qn(g[p-3]^g[p-8]^g[p-14]^g[p-16],1);for(var y=t[0],f=t[1],k=t[2],I=t[3],b=t[4],_=0;_<80;++_){var x=Math.floor(_/20),E=qn(y,5)+el(x,f,k,I)+b+e[x]+g[_]>>>0;b=I,I=k,k=qn(f,30)>>>0,f=y,y=E}t[0]=t[0]+y>>>0,t[1]=t[1]+f>>>0,t[2]=t[2]+k>>>0,t[3]=t[3]+I>>>0,t[4]=t[4]+b>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var rl=ra("v5",80,tl);const nl=rl,sl="00000000-0000-0000-0000-000000000000";function il(n){if(!mn(n))throw TypeError("Invalid UUID");return parseInt(n.substr(14,1),16)}const ol=Object.freeze(Object.defineProperty({__proto__:null,NIL:sl,parse:ta,stringify:bn,v1:Wu,v3:Xu,v4:Qu,v5:nl,validate:mn,version:il},Symbol.toStringTag,{value:"Module"})),sa=_s(ol),al=sa.v4,cl=function(n,e,t,r){if(typeof n!="string")throw new TypeError(n+" must be a string");r=r||{};const s=typeof r.version=="number"?r.version:2;if(s!==1&&s!==2)throw new TypeError(s+" must be 1 or 2");const i={method:n};if(s===2&&(i.jsonrpc="2.0"),e){if(typeof e!="object"&&!Array.isArray(e))throw new TypeError(e+" must be an object, array or omitted");i.params=e}if(typeof t>"u"){const o=typeof r.generator=="function"?r.generator:function(){return al()};i.id=o(i,r)}else s===2&&t===null?r.notificationIdNull&&(i.id=null):i.id=t;return i};var ul=cl;const ll=sa.v4,dl=ul,Tr=function(n,e){if(!(this instanceof Tr))return new Tr(n,e);e||(e={}),this.options={reviver:typeof e.reviver<"u"?e.reviver:null,replacer:typeof e.replacer<"u"?e.replacer:null,generator:typeof e.generator<"u"?e.generator:function(){return ll()},version:typeof e.version<"u"?e.version:2,notificationIdNull:typeof e.notificationIdNull=="boolean"?e.notificationIdNull:!1},this.callServer=n};var hl=Tr;Tr.prototype.request=function(n,e,t,r){const s=this;let i=null;const o=Array.isArray(n)&&typeof e=="function";if(this.options.version===1&&o)throw new TypeError("JSON-RPC 1.0 does not support batching");if(o||!o&&n&&typeof n=="object"&&typeof e=="function")r=e,i=n;else{typeof t=="function"&&(r=t,t=void 0);const l=typeof r=="function";try{i=dl(n,e,t,{generator:this.options.generator,version:this.options.version,notificationIdNull:this.options.notificationIdNull})}catch(u){if(l)return r(u);throw u}if(!l)return i}let c;try{c=JSON.stringify(i,this.options.replacer)}catch(l){return r(l)}return this.callServer(c,function(l,u){s._parseResponse(l,u,r)}),i};Tr.prototype._parseResponse=function(n,e,t){if(n){t(n);return}if(!e)return t();let r;try{r=JSON.parse(e,this.options.reviver)}catch(s){return t(s)}if(t.length===3)if(Array.isArray(r)){const s=function(o){return typeof o.error<"u"},i=function(o){return!s(o)};return t(null,r.filter(s),r.filter(i))}else return t(null,r.error,r.result);t(null,r)};const fl=fn(hl);var ia={},oa={exports:{}};(function(n){function e(t){return t&&t.__esModule?t:{default:t}}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports})(oa);var Ds=oa.exports,jn={exports:{}},$n={exports:{}},Oi;function Wr(){return Oi||(Oi=1,function(n){function e(t){"@babel/helpers - typeof";return n.exports=e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},n.exports.__esModule=!0,n.exports.default=n.exports,e(t)}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports}($n)),$n.exports}var Li;function pl(){return Li||(Li=1,function(n){var e=Wr().default;function t(){n.exports=t=function(){return s},n.exports.__esModule=!0,n.exports.default=n.exports;var r,s={},i=Object.prototype,o=i.hasOwnProperty,a=Object.defineProperty||function(v,S,A){v[S]=A.value},c=typeof Symbol=="function"?Symbol:{},l=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",h=c.toStringTag||"@@toStringTag";function g(v,S,A){return Object.defineProperty(v,S,{value:A,enumerable:!0,configurable:!0,writable:!0}),v[S]}try{g({},"")}catch{g=function(A,N,K){return A[N]=K}}function d(v,S,A,N){var K=S&&S.prototype instanceof _?S:_,U=Object.create(K.prototype),H=new cr(N||[]);return a(U,"_invoke",{value:De(v,A,H)}),U}function p(v,S,A){try{return{type:"normal",arg:v.call(S,A)}}catch(N){return{type:"throw",arg:N}}}s.wrap=d;var y="suspendedStart",f="suspendedYield",k="executing",I="completed",b={};function _(){}function x(){}function E(){}var B={};g(B,l,function(){return this});var T=Object.getPrototypeOf,j=T&&T(T(q([])));j&&j!==i&&o.call(j,l)&&(B=j);var ue=E.prototype=_.prototype=Object.create(B);function we(v){["next","throw","return"].forEach(function(S){g(v,S,function(A){return this._invoke(S,A)})})}function ze(v,S){function A(K,U,H,G){var Q=p(v[K],v,U);if(Q.type!=="throw"){var fe=Q.arg,ge=fe.value;return ge&&e(ge)=="object"&&o.call(ge,"__await")?S.resolve(ge.__await).then(function(Se){A("next",Se,H,G)},function(Se){A("throw",Se,H,G)}):S.resolve(ge).then(function(Se){fe.value=Se,H(fe)},function(Se){return A("throw",Se,H,G)})}G(Q.arg)}var N;a(this,"_invoke",{value:function(U,H){function G(){return new S(function(Q,fe){A(U,H,Q,fe)})}return N=N?N.then(G,G):G()}})}function De(v,S,A){var N=y;return function(K,U){if(N===k)throw new Error("Generator is already running");if(N===I){if(K==="throw")throw U;return{value:r,done:!0}}for(A.method=K,A.arg=U;;){var H=A.delegate;if(H){var G=Bt(H,A);if(G){if(G===b)continue;return G}}if(A.method==="next")A.sent=A._sent=A.arg;else if(A.method==="throw"){if(N===y)throw N=I,A.arg;A.dispatchException(A.arg)}else A.method==="return"&&A.abrupt("return",A.arg);N=k;var Q=p(v,S,A);if(Q.type==="normal"){if(N=A.done?I:f,Q.arg===b)continue;return{value:Q.arg,done:A.done}}Q.type==="throw"&&(N=I,A.method="throw",A.arg=Q.arg)}}}function Bt(v,S){var A=S.method,N=v.iterator[A];if(N===r)return S.delegate=null,A==="throw"&&v.iterator.return&&(S.method="return",S.arg=r,Bt(v,S),S.method==="throw")||A!=="return"&&(S.method="throw",S.arg=new TypeError("The iterator does not provide a '"+A+"' method")),b;var K=p(N,v.iterator,S.arg);if(K.type==="throw")return S.method="throw",S.arg=K.arg,S.delegate=null,b;var U=K.arg;return U?U.done?(S[v.resultName]=U.value,S.next=v.nextLoc,S.method!=="return"&&(S.method="next",S.arg=r),S.delegate=null,b):U:(S.method="throw",S.arg=new TypeError("iterator result is not an object"),S.delegate=null,b)}function kt(v){var S={tryLoc:v[0]};1 in v&&(S.catchLoc=v[1]),2 in v&&(S.finallyLoc=v[2],S.afterLoc=v[3]),this.tryEntries.push(S)}function qt(v){var S=v.completion||{};S.type="normal",delete S.arg,v.completion=S}function cr(v){this.tryEntries=[{tryLoc:"root"}],v.forEach(kt,this),this.reset(!0)}function q(v){if(v||v===""){var S=v[l];if(S)return S.call(v);if(typeof v.next=="function")return v;if(!isNaN(v.length)){var A=-1,N=function K(){for(;++A<v.length;)if(o.call(v,A))return K.value=v[A],K.done=!1,K;return K.value=r,K.done=!0,K};return N.next=N}}throw new TypeError(e(v)+" is not iterable")}return x.prototype=E,a(ue,"constructor",{value:E,configurable:!0}),a(E,"constructor",{value:x,configurable:!0}),x.displayName=g(E,h,"GeneratorFunction"),s.isGeneratorFunction=function(v){var S=typeof v=="function"&&v.constructor;return!!S&&(S===x||(S.displayName||S.name)==="GeneratorFunction")},s.mark=function(v){return Object.setPrototypeOf?Object.setPrototypeOf(v,E):(v.__proto__=E,g(v,h,"GeneratorFunction")),v.prototype=Object.create(ue),v},s.awrap=function(v){return{__await:v}},we(ze.prototype),g(ze.prototype,u,function(){return this}),s.AsyncIterator=ze,s.async=function(v,S,A,N,K){K===void 0&&(K=Promise);var U=new ze(d(v,S,A,N),K);return s.isGeneratorFunction(S)?U:U.next().then(function(H){return H.done?H.value:U.next()})},we(ue),g(ue,h,"Generator"),g(ue,l,function(){return this}),g(ue,"toString",function(){return"[object Generator]"}),s.keys=function(v){var S=Object(v),A=[];for(var N in S)A.push(N);return A.reverse(),function K(){for(;A.length;){var U=A.pop();if(U in S)return K.value=U,K.done=!1,K}return K.done=!0,K}},s.values=q,cr.prototype={constructor:cr,reset:function(S){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(qt),!S)for(var A in this)A.charAt(0)==="t"&&o.call(this,A)&&!isNaN(+A.slice(1))&&(this[A]=r)},stop:function(){this.done=!0;var S=this.tryEntries[0].completion;if(S.type==="throw")throw S.arg;return this.rval},dispatchException:function(S){if(this.done)throw S;var A=this;function N(fe,ge){return H.type="throw",H.arg=S,A.next=fe,ge&&(A.method="next",A.arg=r),!!ge}for(var K=this.tryEntries.length-1;K>=0;--K){var U=this.tryEntries[K],H=U.completion;if(U.tryLoc==="root")return N("end");if(U.tryLoc<=this.prev){var G=o.call(U,"catchLoc"),Q=o.call(U,"finallyLoc");if(G&&Q){if(this.prev<U.catchLoc)return N(U.catchLoc,!0);if(this.prev<U.finallyLoc)return N(U.finallyLoc)}else if(G){if(this.prev<U.catchLoc)return N(U.catchLoc,!0)}else{if(!Q)throw new Error("try statement without catch or finally");if(this.prev<U.finallyLoc)return N(U.finallyLoc)}}}},abrupt:function(S,A){for(var N=this.tryEntries.length-1;N>=0;--N){var K=this.tryEntries[N];if(K.tryLoc<=this.prev&&o.call(K,"finallyLoc")&&this.prev<K.finallyLoc){var U=K;break}}U&&(S==="break"||S==="continue")&&U.tryLoc<=A&&A<=U.finallyLoc&&(U=null);var H=U?U.completion:{};return H.type=S,H.arg=A,U?(this.method="next",this.next=U.finallyLoc,b):this.complete(H)},complete:function(S,A){if(S.type==="throw")throw S.arg;return S.type==="break"||S.type==="continue"?this.next=S.arg:S.type==="return"?(this.rval=this.arg=S.arg,this.method="return",this.next="end"):S.type==="normal"&&A&&(this.next=A),b},finish:function(S){for(var A=this.tryEntries.length-1;A>=0;--A){var N=this.tryEntries[A];if(N.finallyLoc===S)return this.complete(N.completion,N.afterLoc),qt(N),b}},catch:function(S){for(var A=this.tryEntries.length-1;A>=0;--A){var N=this.tryEntries[A];if(N.tryLoc===S){var K=N.completion;if(K.type==="throw"){var U=K.arg;qt(N)}return U}}throw new Error("illegal catch attempt")},delegateYield:function(S,A,N){return this.delegate={iterator:q(S),resultName:A,nextLoc:N},this.method==="next"&&(this.arg=r),b}},s}n.exports=t,n.exports.__esModule=!0,n.exports.default=n.exports}(jn)),jn.exports}var Vn,Ni;function gl(){if(Ni)return Vn;Ni=1;var n=pl()();Vn=n;try{regeneratorRuntime=n}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}return Vn}var Hn={exports:{}},Ui;function yl(){return Ui||(Ui=1,function(n){function e(r,s,i,o,a,c,l){try{var u=r[c](l),h=u.value}catch(g){i(g);return}u.done?s(h):Promise.resolve(h).then(o,a)}function t(r){return function(){var s=this,i=arguments;return new Promise(function(o,a){var c=r.apply(s,i);function l(h){e(c,o,a,l,u,"next",h)}function u(h){e(c,o,a,l,u,"throw",h)}l(void 0)})}}n.exports=t,n.exports.__esModule=!0,n.exports.default=n.exports}(Hn)),Hn.exports}var Gn={exports:{}},Fi;function Ms(){return Fi||(Fi=1,function(n){function e(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports}(Gn)),Gn.exports}var Yn={exports:{}},Jn={exports:{}},Zn={exports:{}},Ki;function ml(){return Ki||(Ki=1,function(n){var e=Wr().default;function t(r,s){if(e(r)!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var o=i.call(r,s||"default");if(e(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(r)}n.exports=t,n.exports.__esModule=!0,n.exports.default=n.exports}(Zn)),Zn.exports}var zi;function bl(){return zi||(zi=1,function(n){var e=Wr().default,t=ml();function r(s){var i=t(s,"string");return e(i)=="symbol"?i:String(i)}n.exports=r,n.exports.__esModule=!0,n.exports.default=n.exports}(Jn)),Jn.exports}var Di;function Ws(){return Di||(Di=1,function(n){var e=bl();function t(s,i){for(var o=0;o<i.length;o++){var a=i[o];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(s,e(a.key),a)}}function r(s,i,o){return i&&t(s.prototype,i),o&&t(s,o),Object.defineProperty(s,"prototype",{writable:!1}),s}n.exports=r,n.exports.__esModule=!0,n.exports.default=n.exports}(Yn)),Yn.exports}var Xn={exports:{}},Qn={exports:{}},Mi;function wl(){return Mi||(Mi=1,function(n){function e(t,r){return n.exports=e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,o){return i.__proto__=o,i},n.exports.__esModule=!0,n.exports.default=n.exports,e(t,r)}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports}(Qn)),Qn.exports}var Wi;function aa(){return Wi||(Wi=1,function(n){var e=wl();function t(r,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(s&&s.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),s&&e(r,s)}n.exports=t,n.exports.__esModule=!0,n.exports.default=n.exports}(Xn)),Xn.exports}var es={exports:{}},ts={exports:{}},qi;function vl(){return qi||(qi=1,function(n){function e(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports}(ts)),ts.exports}var ji;function ca(){return ji||(ji=1,function(n){var e=Wr().default,t=vl();function r(s,i){if(i&&(e(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return t(s)}n.exports=r,n.exports.__esModule=!0,n.exports.default=n.exports}(es)),es.exports}var rs={exports:{}},$i;function ua(){return $i||($i=1,function(n){function e(t){return n.exports=e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},n.exports.__esModule=!0,n.exports.default=n.exports,e(t)}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports}(rs)),rs.exports}var ns={exports:{}},Vi;function la(){return Vi||(Vi=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function i(c,l,u,h,g){if(typeof u!="function")throw new TypeError("The listener must be a function");var d=new s(u,h||c,g),p=t?t+l:l;return c._events[p]?c._events[p].fn?c._events[p]=[c._events[p],d]:c._events[p].push(d):(c._events[p]=d,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new r:delete c._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],u,h;if(this._eventsCount===0)return l;for(h in u=this._events)e.call(u,h)&&l.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},a.prototype.listeners=function(l){var u=t?t+l:l,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var g=0,d=h.length,p=new Array(d);g<d;g++)p[g]=h[g].fn;return p},a.prototype.listenerCount=function(l){var u=t?t+l:l,h=this._events[u];return h?h.fn?1:h.length:0},a.prototype.emit=function(l,u,h,g,d,p){var y=t?t+l:l;if(!this._events[y])return!1;var f=this._events[y],k=arguments.length,I,b;if(f.fn){switch(f.once&&this.removeListener(l,f.fn,void 0,!0),k){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,u),!0;case 3:return f.fn.call(f.context,u,h),!0;case 4:return f.fn.call(f.context,u,h,g),!0;case 5:return f.fn.call(f.context,u,h,g,d),!0;case 6:return f.fn.call(f.context,u,h,g,d,p),!0}for(b=1,I=new Array(k-1);b<k;b++)I[b-1]=arguments[b];f.fn.apply(f.context,I)}else{var _=f.length,x;for(b=0;b<_;b++)switch(f[b].once&&this.removeListener(l,f[b].fn,void 0,!0),k){case 1:f[b].fn.call(f[b].context);break;case 2:f[b].fn.call(f[b].context,u);break;case 3:f[b].fn.call(f[b].context,u,h);break;case 4:f[b].fn.call(f[b].context,u,h,g);break;default:if(!I)for(x=1,I=new Array(k-1);x<k;x++)I[x-1]=arguments[x];f[b].fn.apply(f[b].context,I)}}return!0},a.prototype.on=function(l,u,h){return i(this,l,u,h,!1)},a.prototype.once=function(l,u,h){return i(this,l,u,h,!0)},a.prototype.removeListener=function(l,u,h,g){var d=t?t+l:l;if(!this._events[d])return this;if(!u)return o(this,d),this;var p=this._events[d];if(p.fn)p.fn===u&&(!g||p.once)&&(!h||p.context===h)&&o(this,d);else{for(var y=0,f=[],k=p.length;y<k;y++)(p[y].fn!==u||g&&!p[y].once||h&&p[y].context!==h)&&f.push(p[y]);f.length?this._events[d]=f.length===1?f[0]:f:o(this,d)}return this},a.prototype.removeAllListeners=function(l){var u;return l?(u=t?t+l:l,this._events[u]&&o(this,u)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a}(ns)),ns.exports}var ur={},Hi;function kl(){if(Hi)return ur;Hi=1;var n=Ds;Object.defineProperty(ur,"__esModule",{value:!0}),ur.DefaultDataPack=void 0,ur.createError=i;var e=n(Ms()),t=n(Ws()),r=new Map([[-32e3,"Event not provided"],[-32600,"Invalid Request"],[-32601,"Method not found"],[-32602,"Invalid params"],[-32603,"Internal error"],[-32604,"Params not found"],[-32605,"Method forbidden"],[-32606,"Event forbidden"],[-32700,"Parse error"]]),s=function(){function o(){(0,e.default)(this,o)}return(0,t.default)(o,[{key:"encode",value:function(c){return JSON.stringify(c)}},{key:"decode",value:function(c){return JSON.parse(c)}}]),o}();ur.DefaultDataPack=s;function i(o,a){var c={code:o,message:r.get(o)||"Internal Server Error"};return a&&(c.data=a),c}return ur}(function(n){var e=Ds;Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var t=e(gl()),r=e(yl()),s=e(Wr()),i=e(Ms()),o=e(Ws()),a=e(aa()),c=e(ca()),l=e(ua()),u=la(),h=kl();function g(f){var k=d();return function(){var b=(0,l.default)(f),_;if(k){var x=(0,l.default)(this).constructor;_=Reflect.construct(b,arguments,x)}else _=b.apply(this,arguments);return(0,c.default)(this,_)}}function d(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var p=function(f,k){var I={};for(var b in f)Object.prototype.hasOwnProperty.call(f,b)&&k.indexOf(b)<0&&(I[b]=f[b]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var _=0,b=Object.getOwnPropertySymbols(f);_<b.length;_++)k.indexOf(b[_])<0&&Object.prototype.propertyIsEnumerable.call(f,b[_])&&(I[b[_]]=f[b[_]]);return I},y=function(f){(0,a.default)(I,f);var k=g(I);function I(b){var _,x=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"ws://localhost:8080",E=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},B=arguments.length>3?arguments[3]:void 0,T=arguments.length>4?arguments[4]:void 0;(0,i.default)(this,I);var j=E.autoconnect,ue=j===void 0?!0:j,we=E.reconnect,ze=we===void 0?!0:we,De=E.reconnect_interval,Bt=De===void 0?1e3:De,kt=E.max_reconnects,qt=kt===void 0?5:kt,cr=p(E,["autoconnect","reconnect","reconnect_interval","max_reconnects"]);return _=k.call(this),_.webSocketFactory=b,_.queue={},_.rpc_id=0,_.address=x,_.autoconnect=ue,_.ready=!1,_.reconnect=ze,_.reconnect_timer_id=void 0,_.reconnect_interval=Bt,_.max_reconnects=qt,_.rest_options=cr,_.current_reconnects=0,_.generate_request_id=B||function(){return++_.rpc_id},T?_.dataPack=T:_.dataPack=new h.DefaultDataPack,_.autoconnect&&_._connect(_.address,Object.assign({autoconnect:_.autoconnect,reconnect:_.reconnect,reconnect_interval:_.reconnect_interval,max_reconnects:_.max_reconnects},_.rest_options)),_}return(0,o.default)(I,[{key:"connect",value:function(){this.socket||this._connect(this.address,Object.assign({autoconnect:this.autoconnect,reconnect:this.reconnect,reconnect_interval:this.reconnect_interval,max_reconnects:this.max_reconnects},this.rest_options))}},{key:"call",value:function(_,x,E,B){var T=this;return!B&&(0,s.default)(E)==="object"&&(B=E,E=null),new Promise(function(j,ue){if(!T.ready)return ue(new Error("socket not ready"));var we=T.generate_request_id(_,x),ze={jsonrpc:"2.0",method:_,params:x||void 0,id:we};T.socket.send(T.dataPack.encode(ze),B,function(De){if(De)return ue(De);T.queue[we]={promise:[j,ue]},E&&(T.queue[we].timeout=setTimeout(function(){delete T.queue[we],ue(new Error("reply timeout"))},E))})})}},{key:"login",value:function(){var b=(0,r.default)(t.default.mark(function x(E){var B;return t.default.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,this.call("rpc.login",E);case 2:if(B=j.sent,B){j.next=5;break}throw new Error("authentication failed");case 5:return j.abrupt("return",B);case 6:case"end":return j.stop()}},x,this)}));function _(x){return b.apply(this,arguments)}return _}()},{key:"listMethods",value:function(){var b=(0,r.default)(t.default.mark(function x(){return t.default.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,this.call("__listMethods");case 2:return B.abrupt("return",B.sent);case 3:case"end":return B.stop()}},x,this)}));function _(){return b.apply(this,arguments)}return _}()},{key:"notify",value:function(_,x){var E=this;return new Promise(function(B,T){if(!E.ready)return T(new Error("socket not ready"));var j={jsonrpc:"2.0",method:_,params:x};E.socket.send(E.dataPack.encode(j),function(ue){if(ue)return T(ue);B()})})}},{key:"subscribe",value:function(){var b=(0,r.default)(t.default.mark(function x(E){var B;return t.default.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return typeof E=="string"&&(E=[E]),j.next=3,this.call("rpc.on",E);case 3:if(B=j.sent,!(typeof E=="string"&&B[E]!=="ok")){j.next=6;break}throw new Error("Failed subscribing to an event '"+E+"' with: "+B[E]);case 6:return j.abrupt("return",B);case 7:case"end":return j.stop()}},x,this)}));function _(x){return b.apply(this,arguments)}return _}()},{key:"unsubscribe",value:function(){var b=(0,r.default)(t.default.mark(function x(E){var B;return t.default.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return typeof E=="string"&&(E=[E]),j.next=3,this.call("rpc.off",E);case 3:if(B=j.sent,!(typeof E=="string"&&B[E]!=="ok")){j.next=6;break}throw new Error("Failed unsubscribing from an event with: "+B);case 6:return j.abrupt("return",B);case 7:case"end":return j.stop()}},x,this)}));function _(x){return b.apply(this,arguments)}return _}()},{key:"close",value:function(_,x){this.socket.close(_||1e3,x)}},{key:"_connect",value:function(_,x){var E=this;clearTimeout(this.reconnect_timer_id),this.socket=this.webSocketFactory(_,x),this.socket.addEventListener("open",function(){E.ready=!0,E.emit("open"),E.current_reconnects=0}),this.socket.addEventListener("message",function(B){var T=B.data;T instanceof ArrayBuffer&&(T=Buffer.from(T).toString());try{T=E.dataPack.decode(T)}catch{return}if(T.notification&&E.listeners(T.notification).length){if(!Object.keys(T.params).length)return E.emit(T.notification);var j=[T.notification];if(T.params.constructor===Object)j.push(T.params);else for(var ue=0;ue<T.params.length;ue++)j.push(T.params[ue]);return Promise.resolve().then(function(){E.emit.apply(E,j)})}if(!E.queue[T.id])return T.method?Promise.resolve().then(function(){E.emit(T.method,T==null?void 0:T.params)}):void 0;"error"in T=="result"in T&&E.queue[T.id].promise[1](new Error('Server response malformed. Response must include either "result" or "error", but not both.')),E.queue[T.id].timeout&&clearTimeout(E.queue[T.id].timeout),T.error?E.queue[T.id].promise[1](T.error):E.queue[T.id].promise[0](T.result),delete E.queue[T.id]}),this.socket.addEventListener("error",function(B){return E.emit("error",B)}),this.socket.addEventListener("close",function(B){var T=B.code,j=B.reason;E.ready&&setTimeout(function(){return E.emit("close",T,j)},0),E.ready=!1,E.socket=void 0,T!==1e3&&(E.current_reconnects++,E.reconnect&&(E.max_reconnects>E.current_reconnects||E.max_reconnects===0)&&(E.reconnect_timer_id=setTimeout(function(){return E._connect(_,x)},E.reconnect_interval)))})}}]),I}(u.EventEmitter);n.default=y})(ia);const Sl=fn(ia);var da={};(function(n){var e=Ds;Object.defineProperty(n,"__esModule",{value:!0}),n.default=h;var t=e(Ms()),r=e(Ws()),s=e(aa()),i=e(ca()),o=e(ua()),a=la();function c(g){var d=l();return function(){var y=(0,o.default)(g),f;if(d){var k=(0,o.default)(this).constructor;f=Reflect.construct(y,arguments,k)}else f=y.apply(this,arguments);return(0,i.default)(this,f)}}function l(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var u=function(g){(0,s.default)(p,g);var d=c(p);function p(y,f,k){var I;return(0,t.default)(this,p),I=d.call(this),I.socket=new window.WebSocket(y,k),I.socket.onopen=function(){return I.emit("open")},I.socket.onmessage=function(b){return I.emit("message",b.data)},I.socket.onerror=function(b){return I.emit("error",b)},I.socket.onclose=function(b){I.emit("close",b.code,b.reason)},I}return(0,r.default)(p,[{key:"send",value:function(f,k,I){var b=I||k;try{this.socket.send(f),b()}catch(_){b(_)}}},{key:"close",value:function(f,k){this.socket.close(f,k)}},{key:"addEventListener",value:function(f,k,I){this.socket.addEventListener(f,k,I)}}]),p}(a.EventEmitter);function h(g,d){return new u(g,d)}})(da);const _l=fn(da),El=Sr.utils.randomPrivateKey,Gi=()=>{const n=Sr.utils.randomPrivateKey(),e=cn(n),t=new Uint8Array(64);return t.set(n),t.set(e,32),{publicKey:e,secretKey:t}},cn=Sr.getPublicKey;function Yi(n){try{return Sr.ExtendedPoint.fromHex(n),!0}catch{return!1}}const qs=(n,e)=>Sr.sign(n,e.slice(0,32)),Il=Sr.verify,X=n=>$.Buffer.isBuffer(n)?n:n instanceof Uint8Array?$.Buffer.from(n.buffer,n.byteOffset,n.byteLength):$.Buffer.from(n);class js{constructor(e){Object.assign(this,e)}encode(){return $.Buffer.from(To(Br,this))}static decode(e){return Co(Br,this,e)}static decodeUnchecked(e){return Ao(Br,this,e)}}class Al extends js{constructor(e){if(super(e),this.enum="",Object.keys(e).length!==1)throw new Error("Enum can only take single value");Object.keys(e).map(t=>{this.enum=t})}}const Br=new Map;var ha;let fa;const pa=32,Xe=32;function xl(n){return n._bn!==void 0}let Ji=1;fa=Symbol.toStringTag;class O extends js{constructor(e){if(super({}),this._bn=void 0,xl(e))this._bn=e._bn;else{if(typeof e=="string"){const t=Te.decode(e);if(t.length!=Xe)throw new Error("Invalid public key input");this._bn=new ki(t)}else this._bn=new ki(e);if(this._bn.byteLength()>Xe)throw new Error("Invalid public key input")}}static unique(){const e=new O(Ji);return Ji+=1,new O(e.toBuffer())}equals(e){return this._bn.eq(e._bn)}toBase58(){return Te.encode(this.toBytes())}toJSON(){return this.toBase58()}toBytes(){const e=this.toBuffer();return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}toBuffer(){const e=this._bn.toArrayLike($.Buffer);if(e.length===Xe)return e;const t=$.Buffer.alloc(32);return e.copy(t,32-e.length),t}get[fa](){return`PublicKey(${this.toString()})`}toString(){return this.toBase58()}static async createWithSeed(e,t,r){const s=$.Buffer.concat([e.toBuffer(),$.Buffer.from(t),r.toBuffer()]),i=Si(s);return new O(i)}static createProgramAddressSync(e,t){let r=$.Buffer.alloc(0);e.forEach(function(i){if(i.length>pa)throw new TypeError("Max seed length exceeded");r=$.Buffer.concat([r,X(i)])}),r=$.Buffer.concat([r,t.toBuffer(),$.Buffer.from("ProgramDerivedAddress")]);const s=Si(r);if(Yi(s))throw new Error("Invalid seeds, address must fall off the curve");return new O(s)}static async createProgramAddress(e,t){return this.createProgramAddressSync(e,t)}static findProgramAddressSync(e,t){let r=255,s;for(;r!=0;){try{const i=e.concat($.Buffer.from([r]));s=this.createProgramAddressSync(i,t)}catch(i){if(i instanceof TypeError)throw i;r--;continue}return[s,r]}throw new Error("Unable to find a viable program address nonce")}static async findProgramAddress(e,t){return this.findProgramAddressSync(e,t)}static isOnCurve(e){const t=new O(e);return Yi(t.toBytes())}}ha=O;O.default=new ha("11111111111111111111111111111111");Br.set(O,{kind:"struct",fields:[["_bn","u256"]]});class Rl{constructor(e){if(this._publicKey=void 0,this._secretKey=void 0,e){const t=X(e);if(e.length!==64)throw new Error("bad secret key size");this._publicKey=t.slice(32,64),this._secretKey=t.slice(0,32)}else this._secretKey=X(El()),this._publicKey=X(cn(this._secretKey))}get publicKey(){return new O(this._publicKey)}get secretKey(){return $.Buffer.concat([this._secretKey,this._publicKey],64)}}const Pl=new O("BPFLoader1111111111111111111111111111111111"),Dt=1280-40-8,vn=127,br=64;class $s extends Error{constructor(e){super(`Signature ${e} has expired: block height exceeded.`),this.signature=void 0,this.signature=e}}Object.defineProperty($s.prototype,"name",{value:"TransactionExpiredBlockheightExceededError"});class Vs extends Error{constructor(e,t){super(`Transaction was not confirmed in ${t.toFixed(2)} seconds. It is unknown if it succeeded or failed. Check signature ${e} using the Solana Explorer or CLI tools.`),this.signature=void 0,this.signature=e}}Object.defineProperty(Vs.prototype,"name",{value:"TransactionExpiredTimeoutError"});class dr extends Error{constructor(e){super(`Signature ${e} has expired: the nonce is no longer valid.`),this.signature=void 0,this.signature=e}}Object.defineProperty(dr.prototype,"name",{value:"TransactionExpiredNonceInvalidError"});class Cr{constructor(e,t){this.staticAccountKeys=void 0,this.accountKeysFromLookups=void 0,this.staticAccountKeys=e,this.accountKeysFromLookups=t}keySegments(){const e=[this.staticAccountKeys];return this.accountKeysFromLookups&&(e.push(this.accountKeysFromLookups.writable),e.push(this.accountKeysFromLookups.readonly)),e}get(e){for(const t of this.keySegments()){if(e<t.length)return t[e];e-=t.length}}get length(){return this.keySegments().flat().length}compileInstructions(e){if(this.length>255+1)throw new Error("Account index overflow encountered during compilation");const r=new Map;this.keySegments().flat().forEach((i,o)=>{r.set(i.toBase58(),o)});const s=i=>{const o=r.get(i.toBase58());if(o===void 0)throw new Error("Encountered an unknown instruction account key during compilation");return o};return e.map(i=>({programIdIndex:s(i.programId),accountKeyIndexes:i.keys.map(o=>s(o.pubkey)),data:i.data}))}}const ee=(n="publicKey")=>he(32,n),Bl=(n="signature")=>he(64,n),Yt=(n="string")=>{const e=M([D("length"),D("lengthPadding"),he(Kt(D(),-8),"chars")],n),t=e.decode.bind(e),r=e.encode.bind(e),s=e;return s.decode=(i,o)=>t(i,o).chars.toString(),s.encode=(i,o,a)=>{const c={chars:$.Buffer.from(i,"utf8")};return r(c,o,a)},s.alloc=i=>D().span+D().span+$.Buffer.from(i,"utf8").length,s},Tl=(n="authorized")=>M([ee("staker"),ee("withdrawer")],n),Cl=(n="lockup")=>M([Je("unixTimestamp"),Je("epoch"),ee("custodian")],n),Ol=(n="voteInit")=>M([ee("nodePubkey"),ee("authorizedVoter"),ee("authorizedWithdrawer"),re("commission")],n),Ll=(n="voteAuthorizeWithSeedArgs")=>M([D("voteAuthorizationType"),ee("currentAuthorityDerivedKeyOwnerPubkey"),Yt("currentAuthorityDerivedKeySeed"),ee("newAuthorized")],n);function ga(n,e){const t=s=>{if(s.span>=0)return s.span;if(typeof s.alloc=="function")return s.alloc(e[s.property]);if("count"in s&&"elementLayout"in s){const i=e[s.property];if(Array.isArray(i))return i.length*t(s.elementLayout)}else if("fields"in s)return ga({layout:s},e[s.property]);return 0};let r=0;return n.layout.fields.forEach(s=>{r+=t(s)}),r}function je(n){let e=0,t=0;for(;;){let r=n.shift();if(e|=(r&127)<<t*7,t+=1,!(r&128))break}return e}function Ze(n,e){let t=e;for(;;){let r=t&127;if(t>>=7,t==0){n.push(r);break}else r|=128,n.push(r)}}function se(n,e){if(!n)throw new Error(e||"Assertion failed")}class kn{constructor(e,t){this.payer=void 0,this.keyMetaMap=void 0,this.payer=e,this.keyMetaMap=t}static compile(e,t){const r=new Map,s=o=>{const a=o.toBase58();let c=r.get(a);return c===void 0&&(c={isSigner:!1,isWritable:!1,isInvoked:!1},r.set(a,c)),c},i=s(t);i.isSigner=!0,i.isWritable=!0;for(const o of e){s(o.programId).isInvoked=!0;for(const a of o.keys){const c=s(a.pubkey);c.isSigner||(c.isSigner=a.isSigner),c.isWritable||(c.isWritable=a.isWritable)}}return new kn(t,r)}getMessageComponents(){const e=[...this.keyMetaMap.entries()];se(e.length<=256,"Max static account keys length exceeded");const t=e.filter(([,c])=>c.isSigner&&c.isWritable),r=e.filter(([,c])=>c.isSigner&&!c.isWritable),s=e.filter(([,c])=>!c.isSigner&&c.isWritable),i=e.filter(([,c])=>!c.isSigner&&!c.isWritable),o={numRequiredSignatures:t.length+r.length,numReadonlySignedAccounts:r.length,numReadonlyUnsignedAccounts:i.length};{se(t.length>0,"Expected at least one writable signer key");const[c]=t[0];se(c===this.payer.toBase58(),"Expected first writable signer key to be the fee payer")}const a=[...t.map(([c])=>new O(c)),...r.map(([c])=>new O(c)),...s.map(([c])=>new O(c)),...i.map(([c])=>new O(c))];return[o,a]}extractTableLookup(e){const[t,r]=this.drainKeysFoundInLookupTable(e.state.addresses,o=>!o.isSigner&&!o.isInvoked&&o.isWritable),[s,i]=this.drainKeysFoundInLookupTable(e.state.addresses,o=>!o.isSigner&&!o.isInvoked&&!o.isWritable);if(!(t.length===0&&s.length===0))return[{accountKey:e.key,writableIndexes:t,readonlyIndexes:s},{writable:r,readonly:i}]}drainKeysFoundInLookupTable(e,t){const r=new Array,s=new Array;for(const[i,o]of this.keyMetaMap.entries())if(t(o)){const a=new O(i),c=e.findIndex(l=>l.equals(a));c>=0&&(se(c<256,"Max lookup table index exceeded"),r.push(c),s.push(a),this.keyMetaMap.delete(i))}return[r,s]}}class ct{constructor(e){this.header=void 0,this.accountKeys=void 0,this.recentBlockhash=void 0,this.instructions=void 0,this.indexToProgramIds=new Map,this.header=e.header,this.accountKeys=e.accountKeys.map(t=>new O(t)),this.recentBlockhash=e.recentBlockhash,this.instructions=e.instructions,this.instructions.forEach(t=>this.indexToProgramIds.set(t.programIdIndex,this.accountKeys[t.programIdIndex]))}get version(){return"legacy"}get staticAccountKeys(){return this.accountKeys}get compiledInstructions(){return this.instructions.map(e=>({programIdIndex:e.programIdIndex,accountKeyIndexes:e.accounts,data:Te.decode(e.data)}))}get addressTableLookups(){return[]}getAccountKeys(){return new Cr(this.staticAccountKeys)}static compile(e){const t=kn.compile(e.instructions,e.payerKey),[r,s]=t.getMessageComponents(),o=new Cr(s).compileInstructions(e.instructions).map(a=>({programIdIndex:a.programIdIndex,accounts:a.accountKeyIndexes,data:Te.encode(a.data)}));return new ct({header:r,accountKeys:s,recentBlockhash:e.recentBlockhash,instructions:o})}isAccountSigner(e){return e<this.header.numRequiredSignatures}isAccountWritable(e){const t=this.header.numRequiredSignatures;if(e>=this.header.numRequiredSignatures){const r=e-t,i=this.accountKeys.length-t-this.header.numReadonlyUnsignedAccounts;return r<i}else{const r=t-this.header.numReadonlySignedAccounts;return e<r}}isProgramId(e){return this.indexToProgramIds.has(e)}programIds(){return[...this.indexToProgramIds.values()]}nonProgramIds(){return this.accountKeys.filter((e,t)=>!this.isProgramId(t))}serialize(){const e=this.accountKeys.length;let t=[];Ze(t,e);const r=this.instructions.map(h=>{const{accounts:g,programIdIndex:d}=h,p=Array.from(Te.decode(h.data));let y=[];Ze(y,g.length);let f=[];return Ze(f,p.length),{programIdIndex:d,keyIndicesCount:$.Buffer.from(y),keyIndices:g,dataLength:$.Buffer.from(f),data:p}});let s=[];Ze(s,r.length);let i=$.Buffer.alloc(Dt);$.Buffer.from(s).copy(i);let o=s.length;r.forEach(h=>{const d=M([re("programIdIndex"),he(h.keyIndicesCount.length,"keyIndicesCount"),Ce(re("keyIndex"),h.keyIndices.length,"keyIndices"),he(h.dataLength.length,"dataLength"),Ce(re("userdatum"),h.data.length,"data")]).encode(h,i,o);o+=d}),i=i.slice(0,o);const a=M([he(1,"numRequiredSignatures"),he(1,"numReadonlySignedAccounts"),he(1,"numReadonlyUnsignedAccounts"),he(t.length,"keyCount"),Ce(ee("key"),e,"keys"),ee("recentBlockhash")]),c={numRequiredSignatures:$.Buffer.from([this.header.numRequiredSignatures]),numReadonlySignedAccounts:$.Buffer.from([this.header.numReadonlySignedAccounts]),numReadonlyUnsignedAccounts:$.Buffer.from([this.header.numReadonlyUnsignedAccounts]),keyCount:$.Buffer.from(t),keys:this.accountKeys.map(h=>X(h.toBytes())),recentBlockhash:Te.decode(this.recentBlockhash)};let l=$.Buffer.alloc(2048);const u=a.encode(c,l);return i.copy(l,u),l.slice(0,u+i.length)}static from(e){let t=[...e];const r=t.shift();if(r!==(r&vn))throw new Error("Versioned messages must be deserialized with VersionedMessage.deserialize()");const s=t.shift(),i=t.shift(),o=je(t);let a=[];for(let g=0;g<o;g++){const d=t.slice(0,Xe);t=t.slice(Xe),a.push(new O($.Buffer.from(d)))}const c=t.slice(0,Xe);t=t.slice(Xe);const l=je(t);let u=[];for(let g=0;g<l;g++){const d=t.shift(),p=je(t),y=t.slice(0,p);t=t.slice(p);const f=je(t),k=t.slice(0,f),I=Te.encode($.Buffer.from(k));t=t.slice(f),u.push({programIdIndex:d,accounts:y,data:I})}const h={header:{numRequiredSignatures:r,numReadonlySignedAccounts:s,numReadonlyUnsignedAccounts:i},recentBlockhash:Te.encode($.Buffer.from(c)),accountKeys:a,instructions:u};return new ct(h)}}class tr{constructor(e){this.header=void 0,this.staticAccountKeys=void 0,this.recentBlockhash=void 0,this.compiledInstructions=void 0,this.addressTableLookups=void 0,this.header=e.header,this.staticAccountKeys=e.staticAccountKeys,this.recentBlockhash=e.recentBlockhash,this.compiledInstructions=e.compiledInstructions,this.addressTableLookups=e.addressTableLookups}get version(){return 0}get numAccountKeysFromLookups(){let e=0;for(const t of this.addressTableLookups)e+=t.readonlyIndexes.length+t.writableIndexes.length;return e}getAccountKeys(e){let t;if(e&&"accountKeysFromLookups"in e&&e.accountKeysFromLookups){if(this.numAccountKeysFromLookups!=e.accountKeysFromLookups.writable.length+e.accountKeysFromLookups.readonly.length)throw new Error("Failed to get account keys because of a mismatch in the number of account keys from lookups");t=e.accountKeysFromLookups}else if(e&&"addressLookupTableAccounts"in e&&e.addressLookupTableAccounts)t=this.resolveAddressTableLookups(e.addressLookupTableAccounts);else if(this.addressTableLookups.length>0)throw new Error("Failed to get account keys because address table lookups were not resolved");return new Cr(this.staticAccountKeys,t)}isAccountSigner(e){return e<this.header.numRequiredSignatures}isAccountWritable(e){const t=this.header.numRequiredSignatures,r=this.staticAccountKeys.length;if(e>=r){const s=e-r,i=this.addressTableLookups.reduce((o,a)=>o+a.writableIndexes.length,0);return s<i}else if(e>=this.header.numRequiredSignatures){const s=e-t,o=r-t-this.header.numReadonlyUnsignedAccounts;return s<o}else{const s=t-this.header.numReadonlySignedAccounts;return e<s}}resolveAddressTableLookups(e){const t={writable:[],readonly:[]};for(const r of this.addressTableLookups){const s=e.find(i=>i.key.equals(r.accountKey));if(!s)throw new Error(`Failed to find address lookup table account for table key ${r.accountKey.toBase58()}`);for(const i of r.writableIndexes)if(i<s.state.addresses.length)t.writable.push(s.state.addresses[i]);else throw new Error(`Failed to find address for index ${i} in address lookup table ${r.accountKey.toBase58()}`);for(const i of r.readonlyIndexes)if(i<s.state.addresses.length)t.readonly.push(s.state.addresses[i]);else throw new Error(`Failed to find address for index ${i} in address lookup table ${r.accountKey.toBase58()}`)}return t}static compile(e){const t=kn.compile(e.instructions,e.payerKey),r=new Array,s={writable:new Array,readonly:new Array},i=e.addressLookupTableAccounts||[];for(const u of i){const h=t.extractTableLookup(u);if(h!==void 0){const[g,{writable:d,readonly:p}]=h;r.push(g),s.writable.push(...d),s.readonly.push(...p)}}const[o,a]=t.getMessageComponents(),l=new Cr(a,s).compileInstructions(e.instructions);return new tr({header:o,staticAccountKeys:a,recentBlockhash:e.recentBlockhash,compiledInstructions:l,addressTableLookups:r})}serialize(){const e=Array();Ze(e,this.staticAccountKeys.length);const t=this.serializeInstructions(),r=Array();Ze(r,this.compiledInstructions.length);const s=this.serializeAddressTableLookups(),i=Array();Ze(i,this.addressTableLookups.length);const o=M([re("prefix"),M([re("numRequiredSignatures"),re("numReadonlySignedAccounts"),re("numReadonlyUnsignedAccounts")],"header"),he(e.length,"staticAccountKeysLength"),Ce(ee(),this.staticAccountKeys.length,"staticAccountKeys"),ee("recentBlockhash"),he(r.length,"instructionsLength"),he(t.length,"serializedInstructions"),he(i.length,"addressTableLookupsLength"),he(s.length,"serializedAddressTableLookups")]),a=new Uint8Array(Dt),c=128,l=o.encode({prefix:c,header:this.header,staticAccountKeysLength:new Uint8Array(e),staticAccountKeys:this.staticAccountKeys.map(u=>u.toBytes()),recentBlockhash:Te.decode(this.recentBlockhash),instructionsLength:new Uint8Array(r),serializedInstructions:t,addressTableLookupsLength:new Uint8Array(i),serializedAddressTableLookups:s},a);return a.slice(0,l)}serializeInstructions(){let e=0;const t=new Uint8Array(Dt);for(const r of this.compiledInstructions){const s=Array();Ze(s,r.accountKeyIndexes.length);const i=Array();Ze(i,r.data.length);const o=M([re("programIdIndex"),he(s.length,"encodedAccountKeyIndexesLength"),Ce(re(),r.accountKeyIndexes.length,"accountKeyIndexes"),he(i.length,"encodedDataLength"),he(r.data.length,"data")]);e+=o.encode({programIdIndex:r.programIdIndex,encodedAccountKeyIndexesLength:new Uint8Array(s),accountKeyIndexes:r.accountKeyIndexes,encodedDataLength:new Uint8Array(i),data:r.data},t,e)}return t.slice(0,e)}serializeAddressTableLookups(){let e=0;const t=new Uint8Array(Dt);for(const r of this.addressTableLookups){const s=Array();Ze(s,r.writableIndexes.length);const i=Array();Ze(i,r.readonlyIndexes.length);const o=M([ee("accountKey"),he(s.length,"encodedWritableIndexesLength"),Ce(re(),r.writableIndexes.length,"writableIndexes"),he(i.length,"encodedReadonlyIndexesLength"),Ce(re(),r.readonlyIndexes.length,"readonlyIndexes")]);e+=o.encode({accountKey:r.accountKey.toBytes(),encodedWritableIndexesLength:new Uint8Array(s),writableIndexes:r.writableIndexes,encodedReadonlyIndexesLength:new Uint8Array(i),readonlyIndexes:r.readonlyIndexes},t,e)}return t.slice(0,e)}static deserialize(e){let t=[...e];const r=t.shift(),s=r&vn;se(r!==s,"Expected versioned message but received legacy message");const i=s;se(i===0,`Expected versioned message with version 0 but found version ${i}`);const o={numRequiredSignatures:t.shift(),numReadonlySignedAccounts:t.shift(),numReadonlyUnsignedAccounts:t.shift()},a=[],c=je(t);for(let p=0;p<c;p++)a.push(new O(t.splice(0,Xe)));const l=Te.encode(t.splice(0,Xe)),u=je(t),h=[];for(let p=0;p<u;p++){const y=t.shift(),f=je(t),k=t.splice(0,f),I=je(t),b=new Uint8Array(t.splice(0,I));h.push({programIdIndex:y,accountKeyIndexes:k,data:b})}const g=je(t),d=[];for(let p=0;p<g;p++){const y=new O(t.splice(0,Xe)),f=je(t),k=t.splice(0,f),I=je(t),b=t.splice(0,I);d.push({accountKey:y,writableIndexes:k,readonlyIndexes:b})}return new tr({header:o,staticAccountKeys:a,recentBlockhash:l,compiledInstructions:h,addressTableLookups:d})}}const Hs={deserializeMessageVersion(n){const e=n[0],t=e&vn;return t===e?"legacy":t},deserialize:n=>{const e=Hs.deserializeMessageVersion(n);if(e==="legacy")return ct.from(n);if(e===0)return tr.deserialize(n);throw new Error(`Transaction message version ${e} deserialization is not supported`)}};let Et=function(n){return n[n.BLOCKHEIGHT_EXCEEDED=0]="BLOCKHEIGHT_EXCEEDED",n[n.PROCESSED=1]="PROCESSED",n[n.TIMED_OUT=2]="TIMED_OUT",n[n.NONCE_INVALID=3]="NONCE_INVALID",n}({});const Nl=$.Buffer.alloc(br).fill(0);class le{constructor(e){this.keys=void 0,this.programId=void 0,this.data=$.Buffer.alloc(0),this.programId=e.programId,this.keys=e.keys,e.data&&(this.data=e.data)}toJSON(){return{keys:this.keys.map(({pubkey:e,isSigner:t,isWritable:r})=>({pubkey:e.toJSON(),isSigner:t,isWritable:r})),programId:this.programId.toJSON(),data:[...this.data]}}}class oe{get signature(){return this.signatures.length>0?this.signatures[0].signature:null}constructor(e){if(this.signatures=[],this.feePayer=void 0,this.instructions=[],this.recentBlockhash=void 0,this.lastValidBlockHeight=void 0,this.nonceInfo=void 0,this.minNonceContextSlot=void 0,this._message=void 0,this._json=void 0,!!e)if(e.feePayer&&(this.feePayer=e.feePayer),e.signatures&&(this.signatures=e.signatures),Object.prototype.hasOwnProperty.call(e,"nonceInfo")){const{minContextSlot:t,nonceInfo:r}=e;this.minNonceContextSlot=t,this.nonceInfo=r}else if(Object.prototype.hasOwnProperty.call(e,"lastValidBlockHeight")){const{blockhash:t,lastValidBlockHeight:r}=e;this.recentBlockhash=t,this.lastValidBlockHeight=r}else{const{recentBlockhash:t,nonceInfo:r}=e;r&&(this.nonceInfo=r),this.recentBlockhash=t}}toJSON(){return{recentBlockhash:this.recentBlockhash||null,feePayer:this.feePayer?this.feePayer.toJSON():null,nonceInfo:this.nonceInfo?{nonce:this.nonceInfo.nonce,nonceInstruction:this.nonceInfo.nonceInstruction.toJSON()}:null,instructions:this.instructions.map(e=>e.toJSON()),signers:this.signatures.map(({publicKey:e})=>e.toJSON())}}add(...e){if(e.length===0)throw new Error("No instructions");return e.forEach(t=>{"instructions"in t?this.instructions=this.instructions.concat(t.instructions):"data"in t&&"programId"in t&&"keys"in t?this.instructions.push(t):this.instructions.push(new le(t))}),this}compileMessage(){if(this._message&&JSON.stringify(this.toJSON())===JSON.stringify(this._json))return this._message;let e,t;if(this.nonceInfo?(e=this.nonceInfo.nonce,this.instructions[0]!=this.nonceInfo.nonceInstruction?t=[this.nonceInfo.nonceInstruction,...this.instructions]:t=this.instructions):(e=this.recentBlockhash,t=this.instructions),!e)throw new Error("Transaction recentBlockhash required");t.length<1&&console.warn("No instructions provided");let r;if(this.feePayer)r=this.feePayer;else if(this.signatures.length>0&&this.signatures[0].publicKey)r=this.signatures[0].publicKey;else throw new Error("Transaction fee payer required");for(let y=0;y<t.length;y++)if(t[y].programId===void 0)throw new Error(`Transaction instruction index ${y} has undefined program id`);const s=[],i=[];t.forEach(y=>{y.keys.forEach(k=>{i.push({...k})});const f=y.programId.toString();s.includes(f)||s.push(f)}),s.forEach(y=>{i.push({pubkey:new O(y),isSigner:!1,isWritable:!1})});const o=[];i.forEach(y=>{const f=y.pubkey.toString(),k=o.findIndex(I=>I.pubkey.toString()===f);k>-1?(o[k].isWritable=o[k].isWritable||y.isWritable,o[k].isSigner=o[k].isSigner||y.isSigner):o.push(y)}),o.sort(function(y,f){if(y.isSigner!==f.isSigner)return y.isSigner?-1:1;if(y.isWritable!==f.isWritable)return y.isWritable?-1:1;const k={localeMatcher:"best fit",usage:"sort",sensitivity:"variant",ignorePunctuation:!1,numeric:!1,caseFirst:"lower"};return y.pubkey.toBase58().localeCompare(f.pubkey.toBase58(),"en",k)});const a=o.findIndex(y=>y.pubkey.equals(r));if(a>-1){const[y]=o.splice(a,1);y.isSigner=!0,y.isWritable=!0,o.unshift(y)}else o.unshift({pubkey:r,isSigner:!0,isWritable:!0});for(const y of this.signatures){const f=o.findIndex(k=>k.pubkey.equals(y.publicKey));if(f>-1)o[f].isSigner||(o[f].isSigner=!0,console.warn("Transaction references a signature that is unnecessary, only the fee payer and instruction signer accounts should sign a transaction. This behavior is deprecated and will throw an error in the next major version release."));else throw new Error(`unknown signer: ${y.publicKey.toString()}`)}let c=0,l=0,u=0;const h=[],g=[];o.forEach(({pubkey:y,isSigner:f,isWritable:k})=>{f?(h.push(y.toString()),c+=1,k||(l+=1)):(g.push(y.toString()),k||(u+=1))});const d=h.concat(g),p=t.map(y=>{const{data:f,programId:k}=y;return{programIdIndex:d.indexOf(k.toString()),accounts:y.keys.map(I=>d.indexOf(I.pubkey.toString())),data:Te.encode(f)}});return p.forEach(y=>{se(y.programIdIndex>=0),y.accounts.forEach(f=>se(f>=0))}),new ct({header:{numRequiredSignatures:c,numReadonlySignedAccounts:l,numReadonlyUnsignedAccounts:u},accountKeys:d,recentBlockhash:e,instructions:p})}_compile(){const e=this.compileMessage(),t=e.accountKeys.slice(0,e.header.numRequiredSignatures);return this.signatures.length===t.length&&this.signatures.every((s,i)=>t[i].equals(s.publicKey))||(this.signatures=t.map(r=>({signature:null,publicKey:r}))),e}serializeMessage(){return this._compile().serialize()}async getEstimatedFee(e){return(await e.getFeeForMessage(this.compileMessage())).value}setSigners(...e){if(e.length===0)throw new Error("No signers");const t=new Set;this.signatures=e.filter(r=>{const s=r.toString();return t.has(s)?!1:(t.add(s),!0)}).map(r=>({signature:null,publicKey:r}))}sign(...e){if(e.length===0)throw new Error("No signers");const t=new Set,r=[];for(const i of e){const o=i.publicKey.toString();t.has(o)||(t.add(o),r.push(i))}this.signatures=r.map(i=>({signature:null,publicKey:i.publicKey}));const s=this._compile();this._partialSign(s,...r)}partialSign(...e){if(e.length===0)throw new Error("No signers");const t=new Set,r=[];for(const i of e){const o=i.publicKey.toString();t.has(o)||(t.add(o),r.push(i))}const s=this._compile();this._partialSign(s,...r)}_partialSign(e,...t){const r=e.serialize();t.forEach(s=>{const i=qs(r,s.secretKey);this._addSignature(s.publicKey,X(i))})}addSignature(e,t){this._compile(),this._addSignature(e,t)}_addSignature(e,t){se(t.length===64);const r=this.signatures.findIndex(s=>e.equals(s.publicKey));if(r<0)throw new Error(`unknown signer: ${e.toString()}`);this.signatures[r].signature=$.Buffer.from(t)}verifySignatures(e=!0){return!this._getMessageSignednessErrors(this.serializeMessage(),e)}_getMessageSignednessErrors(e,t){const r={};for(const{signature:s,publicKey:i}of this.signatures)s===null?t&&(r.missing||(r.missing=[])).push(i):Il(s,e,i.toBytes())||(r.invalid||(r.invalid=[])).push(i);return r.invalid||r.missing?r:void 0}serialize(e){const{requireAllSignatures:t,verifySignatures:r}=Object.assign({requireAllSignatures:!0,verifySignatures:!0},e),s=this.serializeMessage();if(r){const i=this._getMessageSignednessErrors(s,t);if(i){let o="Signature verification failed.";throw i.invalid&&(o+=`
Invalid signature for public key${i.invalid.length===1?"":"(s)"} [\`${i.invalid.map(a=>a.toBase58()).join("`, `")}\`].`),i.missing&&(o+=`
Missing signature for public key${i.missing.length===1?"":"(s)"} [\`${i.missing.map(a=>a.toBase58()).join("`, `")}\`].`),new Error(o)}}return this._serialize(s)}_serialize(e){const{signatures:t}=this,r=[];Ze(r,t.length);const s=r.length+t.length*64+e.length,i=$.Buffer.alloc(s);return se(t.length<256),$.Buffer.from(r).copy(i,0),t.forEach(({signature:o},a)=>{o!==null&&(se(o.length===64,"signature has invalid length"),$.Buffer.from(o).copy(i,r.length+a*64))}),e.copy(i,r.length+t.length*64),se(i.length<=Dt,`Transaction too large: ${i.length} > ${Dt}`),i}get keys(){return se(this.instructions.length===1),this.instructions[0].keys.map(e=>e.pubkey)}get programId(){return se(this.instructions.length===1),this.instructions[0].programId}get data(){return se(this.instructions.length===1),this.instructions[0].data}static from(e){let t=[...e];const r=je(t);let s=[];for(let i=0;i<r;i++){const o=t.slice(0,br);t=t.slice(br),s.push(Te.encode($.Buffer.from(o)))}return oe.populate(ct.from(t),s)}static populate(e,t=[]){const r=new oe;return r.recentBlockhash=e.recentBlockhash,e.header.numRequiredSignatures>0&&(r.feePayer=e.accountKeys[0]),t.forEach((s,i)=>{const o={signature:s==Te.encode(Nl)?null:Te.decode(s),publicKey:e.accountKeys[i]};r.signatures.push(o)}),e.instructions.forEach(s=>{const i=s.accounts.map(o=>{const a=e.accountKeys[o];return{pubkey:a,isSigner:r.signatures.some(c=>c.publicKey.toString()===a.toString())||e.isAccountSigner(o),isWritable:e.isAccountWritable(o)}});r.instructions.push(new le({keys:i,programId:e.accountKeys[s.programIdIndex],data:Te.decode(s.data)}))}),r._message=e,r._json=r.toJSON(),r}}class Gs{constructor(e){this.payerKey=void 0,this.instructions=void 0,this.recentBlockhash=void 0,this.payerKey=e.payerKey,this.instructions=e.instructions,this.recentBlockhash=e.recentBlockhash}static decompile(e,t){const{header:r,compiledInstructions:s,recentBlockhash:i}=e,{numRequiredSignatures:o,numReadonlySignedAccounts:a,numReadonlyUnsignedAccounts:c}=r,l=o-a;se(l>0,"Message header is invalid");const u=e.staticAccountKeys.length-o-c;se(u>=0,"Message header is invalid");const h=e.getAccountKeys(t),g=h.get(0);if(g===void 0)throw new Error("Failed to decompile message because no account keys were found");const d=[];for(const p of s){const y=[];for(const k of p.accountKeyIndexes){const I=h.get(k);if(I===void 0)throw new Error(`Failed to find key for account key index ${k}`);const b=k<o;let _;b?_=k<l:k<h.staticAccountKeys.length?_=k-o<u:_=k-h.staticAccountKeys.length<h.accountKeysFromLookups.writable.length,y.push({pubkey:I,isSigner:k<r.numRequiredSignatures,isWritable:_})}const f=h.get(p.programIdIndex);if(f===void 0)throw new Error(`Failed to find program id for program id index ${p.programIdIndex}`);d.push(new le({programId:f,data:X(p.data),keys:y}))}return new Gs({payerKey:g,instructions:d,recentBlockhash:i})}compileToLegacyMessage(){return ct.compile({payerKey:this.payerKey,recentBlockhash:this.recentBlockhash,instructions:this.instructions})}compileToV0Message(e){return tr.compile({payerKey:this.payerKey,recentBlockhash:this.recentBlockhash,instructions:this.instructions,addressLookupTableAccounts:e})}}class Ys{get version(){return this.message.version}constructor(e,t){if(this.signatures=void 0,this.message=void 0,t!==void 0)se(t.length===e.header.numRequiredSignatures,"Expected signatures length to be equal to the number of required signatures"),this.signatures=t;else{const r=[];for(let s=0;s<e.header.numRequiredSignatures;s++)r.push(new Uint8Array(br));this.signatures=r}this.message=e}serialize(){const e=this.message.serialize(),t=Array();Ze(t,this.signatures.length);const r=M([he(t.length,"encodedSignaturesLength"),Ce(Bl(),this.signatures.length,"signatures"),he(e.length,"serializedMessage")]),s=new Uint8Array(2048),i=r.encode({encodedSignaturesLength:new Uint8Array(t),signatures:this.signatures,serializedMessage:e},s);return s.slice(0,i)}static deserialize(e){let t=[...e];const r=[],s=je(t);for(let o=0;o<s;o++)r.push(new Uint8Array(t.splice(0,br)));const i=Hs.deserialize(new Uint8Array(t));return new Ys(i,r)}sign(e){const t=this.message.serialize(),r=this.message.staticAccountKeys.slice(0,this.message.header.numRequiredSignatures);for(const s of e){const i=r.findIndex(o=>o.equals(s.publicKey));se(i>=0,`Cannot sign with non signer key ${s.publicKey.toBase58()}`),this.signatures[i]=qs(t,s.secretKey)}}addSignature(e,t){se(t.byteLength===64,"Signature must be 64 bytes long");const s=this.message.staticAccountKeys.slice(0,this.message.header.numRequiredSignatures).findIndex(i=>i.equals(e));se(s>=0,`Can not add signature; \`${e.toBase58()}\` is not required to sign this transaction`),this.signatures[s]=t}}const Ul=160,Fl=64,Kl=Ul/Fl,ya=1e3/Kl,lt=new O("SysvarC1ock11111111111111111111111111111111"),zl=new O("SysvarEpochSchedu1e111111111111111111111111"),Dl=new O("Sysvar1nstructions1111111111111111111111111"),Qr=new O("SysvarRecentB1ockHashes11111111111111111111"),wr=new O("SysvarRent111111111111111111111111111111111"),Ml=new O("SysvarRewards111111111111111111111111111111"),Wl=new O("SysvarS1otHashes111111111111111111111111111"),ql=new O("SysvarS1otHistory11111111111111111111111111"),en=new O("SysvarStakeHistory1111111111111111111111111");async function hs(n,e,t,r){const s=r&&{skipPreflight:r.skipPreflight,preflightCommitment:r.preflightCommitment||r.commitment,maxRetries:r.maxRetries,minContextSlot:r.minContextSlot},i=await n.sendTransaction(e,t,s);let o;if(e.recentBlockhash!=null&&e.lastValidBlockHeight!=null)o=(await n.confirmTransaction({abortSignal:r==null?void 0:r.abortSignal,signature:i,blockhash:e.recentBlockhash,lastValidBlockHeight:e.lastValidBlockHeight},r&&r.commitment)).value;else if(e.minNonceContextSlot!=null&&e.nonceInfo!=null){const{nonceInstruction:a}=e.nonceInfo,c=a.keys[0].pubkey;o=(await n.confirmTransaction({abortSignal:r==null?void 0:r.abortSignal,minContextSlot:e.minNonceContextSlot,nonceAccountPubkey:c,nonceValue:e.nonceInfo.nonce,signature:i},r&&r.commitment)).value}else(r==null?void 0:r.abortSignal)!=null&&console.warn("sendAndConfirmTransaction(): A transaction with a deprecated confirmation strategy was supplied along with an `abortSignal`. Only transactions having `lastValidBlockHeight` or a combination of `nonceInfo` and `minNonceContextSlot` are abortable."),o=(await n.confirmTransaction(i,r&&r.commitment)).value;if(o.err)throw new Error(`Transaction ${i} failed (${JSON.stringify(o)})`);return i}function Ht(n){return new Promise(e=>setTimeout(e,n))}function te(n,e){const t=n.layout.span>=0?n.layout.span:ga(n,e),r=$.Buffer.alloc(t),s=Object.assign({instruction:n.index},e);return n.layout.encode(s,r),r}function ae(n,e){let t;try{t=n.layout.decode(e)}catch(r){throw new Error("invalid instruction; "+r)}if(t.instruction!==n.index)throw new Error(`invalid instruction; instruction index mismatch ${t.instruction} != ${n.index}`);return t}const ma=Pe("lamportsPerSignature"),ba=M([D("version"),D("state"),ee("authorizedPubkey"),ee("nonce"),M([ma],"feeCalculator")]),fs=ba.span;class Sn{constructor(e){this.authorizedPubkey=void 0,this.nonce=void 0,this.feeCalculator=void 0,this.authorizedPubkey=e.authorizedPubkey,this.nonce=e.nonce,this.feeCalculator=e.feeCalculator}static fromAccountData(e){const t=ba.decode(X(e),0);return new Sn({authorizedPubkey:new O(t.authorizedPubkey),nonce:new O(t.nonce).toString(),feeCalculator:t.feeCalculator})}}const jl=n=>{const e=n.decode.bind(n),t=n.encode.bind(n);return{decode:e,encode:t}},$l=n=>e=>{const t=he(n,e),{encode:r,decode:s}=jl(t),i=t;return i.decode=(o,a)=>{const c=s(o,a);return Pu($.Buffer.from(c))},i.encode=(o,a,c)=>{const l=Jo(o,n);return r(l,a,c)},i},vr=$l(8);class Vl{constructor(){}static decodeInstructionType(e){this.checkProgramId(e.programId);const r=D("instruction").decode(e.data);let s;for(const[i,o]of Object.entries(de))if(o.index==r){s=i;break}if(!s)throw new Error("Instruction type incorrect; not a SystemInstruction");return s}static decodeCreateAccount(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,2);const{lamports:t,space:r,programId:s}=ae(de.Create,e.data);return{fromPubkey:e.keys[0].pubkey,newAccountPubkey:e.keys[1].pubkey,lamports:t,space:r,programId:new O(s)}}static decodeTransfer(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,2);const{lamports:t}=ae(de.Transfer,e.data);return{fromPubkey:e.keys[0].pubkey,toPubkey:e.keys[1].pubkey,lamports:t}}static decodeTransferWithSeed(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,3);const{lamports:t,seed:r,programId:s}=ae(de.TransferWithSeed,e.data);return{fromPubkey:e.keys[0].pubkey,basePubkey:e.keys[1].pubkey,toPubkey:e.keys[2].pubkey,lamports:t,seed:r,programId:new O(s)}}static decodeAllocate(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,1);const{space:t}=ae(de.Allocate,e.data);return{accountPubkey:e.keys[0].pubkey,space:t}}static decodeAllocateWithSeed(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,1);const{base:t,seed:r,space:s,programId:i}=ae(de.AllocateWithSeed,e.data);return{accountPubkey:e.keys[0].pubkey,basePubkey:new O(t),seed:r,space:s,programId:new O(i)}}static decodeAssign(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,1);const{programId:t}=ae(de.Assign,e.data);return{accountPubkey:e.keys[0].pubkey,programId:new O(t)}}static decodeAssignWithSeed(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,1);const{base:t,seed:r,programId:s}=ae(de.AssignWithSeed,e.data);return{accountPubkey:e.keys[0].pubkey,basePubkey:new O(t),seed:r,programId:new O(s)}}static decodeCreateWithSeed(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,2);const{base:t,seed:r,lamports:s,space:i,programId:o}=ae(de.CreateWithSeed,e.data);return{fromPubkey:e.keys[0].pubkey,newAccountPubkey:e.keys[1].pubkey,basePubkey:new O(t),seed:r,lamports:s,space:i,programId:new O(o)}}static decodeNonceInitialize(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,3);const{authorized:t}=ae(de.InitializeNonceAccount,e.data);return{noncePubkey:e.keys[0].pubkey,authorizedPubkey:new O(t)}}static decodeNonceAdvance(e){return this.checkProgramId(e.programId),this.checkKeyLength(e.keys,3),ae(de.AdvanceNonceAccount,e.data),{noncePubkey:e.keys[0].pubkey,authorizedPubkey:e.keys[2].pubkey}}static decodeNonceWithdraw(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,5);const{lamports:t}=ae(de.WithdrawNonceAccount,e.data);return{noncePubkey:e.keys[0].pubkey,toPubkey:e.keys[1].pubkey,authorizedPubkey:e.keys[4].pubkey,lamports:t}}static decodeNonceAuthorize(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,2);const{authorized:t}=ae(de.AuthorizeNonceAccount,e.data);return{noncePubkey:e.keys[0].pubkey,authorizedPubkey:e.keys[1].pubkey,newAuthorizedPubkey:new O(t)}}static checkProgramId(e){if(!e.equals(Ie.programId))throw new Error("invalid instruction; programId is not SystemProgram")}static checkKeyLength(e,t){if(e.length<t)throw new Error(`invalid instruction; found ${e.length} keys, expected at least ${t}`)}}const de=Object.freeze({Create:{index:0,layout:M([D("instruction"),Je("lamports"),Je("space"),ee("programId")])},Assign:{index:1,layout:M([D("instruction"),ee("programId")])},Transfer:{index:2,layout:M([D("instruction"),vr("lamports")])},CreateWithSeed:{index:3,layout:M([D("instruction"),ee("base"),Yt("seed"),Je("lamports"),Je("space"),ee("programId")])},AdvanceNonceAccount:{index:4,layout:M([D("instruction")])},WithdrawNonceAccount:{index:5,layout:M([D("instruction"),Je("lamports")])},InitializeNonceAccount:{index:6,layout:M([D("instruction"),ee("authorized")])},AuthorizeNonceAccount:{index:7,layout:M([D("instruction"),ee("authorized")])},Allocate:{index:8,layout:M([D("instruction"),Je("space")])},AllocateWithSeed:{index:9,layout:M([D("instruction"),ee("base"),Yt("seed"),Je("space"),ee("programId")])},AssignWithSeed:{index:10,layout:M([D("instruction"),ee("base"),Yt("seed"),ee("programId")])},TransferWithSeed:{index:11,layout:M([D("instruction"),vr("lamports"),Yt("seed"),ee("programId")])},UpgradeNonceAccount:{index:12,layout:M([D("instruction")])}});class Ie{constructor(){}static createAccount(e){const t=de.Create,r=te(t,{lamports:e.lamports,space:e.space,programId:X(e.programId.toBuffer())});return new le({keys:[{pubkey:e.fromPubkey,isSigner:!0,isWritable:!0},{pubkey:e.newAccountPubkey,isSigner:!0,isWritable:!0}],programId:this.programId,data:r})}static transfer(e){let t,r;if("basePubkey"in e){const s=de.TransferWithSeed;t=te(s,{lamports:BigInt(e.lamports),seed:e.seed,programId:X(e.programId.toBuffer())}),r=[{pubkey:e.fromPubkey,isSigner:!1,isWritable:!0},{pubkey:e.basePubkey,isSigner:!0,isWritable:!1},{pubkey:e.toPubkey,isSigner:!1,isWritable:!0}]}else{const s=de.Transfer;t=te(s,{lamports:BigInt(e.lamports)}),r=[{pubkey:e.fromPubkey,isSigner:!0,isWritable:!0},{pubkey:e.toPubkey,isSigner:!1,isWritable:!0}]}return new le({keys:r,programId:this.programId,data:t})}static assign(e){let t,r;if("basePubkey"in e){const s=de.AssignWithSeed;t=te(s,{base:X(e.basePubkey.toBuffer()),seed:e.seed,programId:X(e.programId.toBuffer())}),r=[{pubkey:e.accountPubkey,isSigner:!1,isWritable:!0},{pubkey:e.basePubkey,isSigner:!0,isWritable:!1}]}else{const s=de.Assign;t=te(s,{programId:X(e.programId.toBuffer())}),r=[{pubkey:e.accountPubkey,isSigner:!0,isWritable:!0}]}return new le({keys:r,programId:this.programId,data:t})}static createAccountWithSeed(e){const t=de.CreateWithSeed,r=te(t,{base:X(e.basePubkey.toBuffer()),seed:e.seed,lamports:e.lamports,space:e.space,programId:X(e.programId.toBuffer())});let s=[{pubkey:e.fromPubkey,isSigner:!0,isWritable:!0},{pubkey:e.newAccountPubkey,isSigner:!1,isWritable:!0}];return e.basePubkey!=e.fromPubkey&&s.push({pubkey:e.basePubkey,isSigner:!0,isWritable:!1}),new le({keys:s,programId:this.programId,data:r})}static createNonceAccount(e){const t=new oe;"basePubkey"in e&&"seed"in e?t.add(Ie.createAccountWithSeed({fromPubkey:e.fromPubkey,newAccountPubkey:e.noncePubkey,basePubkey:e.basePubkey,seed:e.seed,lamports:e.lamports,space:fs,programId:this.programId})):t.add(Ie.createAccount({fromPubkey:e.fromPubkey,newAccountPubkey:e.noncePubkey,lamports:e.lamports,space:fs,programId:this.programId}));const r={noncePubkey:e.noncePubkey,authorizedPubkey:e.authorizedPubkey};return t.add(this.nonceInitialize(r)),t}static nonceInitialize(e){const t=de.InitializeNonceAccount,r=te(t,{authorized:X(e.authorizedPubkey.toBuffer())}),s={keys:[{pubkey:e.noncePubkey,isSigner:!1,isWritable:!0},{pubkey:Qr,isSigner:!1,isWritable:!1},{pubkey:wr,isSigner:!1,isWritable:!1}],programId:this.programId,data:r};return new le(s)}static nonceAdvance(e){const t=de.AdvanceNonceAccount,r=te(t),s={keys:[{pubkey:e.noncePubkey,isSigner:!1,isWritable:!0},{pubkey:Qr,isSigner:!1,isWritable:!1},{pubkey:e.authorizedPubkey,isSigner:!0,isWritable:!1}],programId:this.programId,data:r};return new le(s)}static nonceWithdraw(e){const t=de.WithdrawNonceAccount,r=te(t,{lamports:e.lamports});return new le({keys:[{pubkey:e.noncePubkey,isSigner:!1,isWritable:!0},{pubkey:e.toPubkey,isSigner:!1,isWritable:!0},{pubkey:Qr,isSigner:!1,isWritable:!1},{pubkey:wr,isSigner:!1,isWritable:!1},{pubkey:e.authorizedPubkey,isSigner:!0,isWritable:!1}],programId:this.programId,data:r})}static nonceAuthorize(e){const t=de.AuthorizeNonceAccount,r=te(t,{authorized:X(e.newAuthorizedPubkey.toBuffer())});return new le({keys:[{pubkey:e.noncePubkey,isSigner:!1,isWritable:!0},{pubkey:e.authorizedPubkey,isSigner:!0,isWritable:!1}],programId:this.programId,data:r})}static allocate(e){let t,r;if("basePubkey"in e){const s=de.AllocateWithSeed;t=te(s,{base:X(e.basePubkey.toBuffer()),seed:e.seed,space:e.space,programId:X(e.programId.toBuffer())}),r=[{pubkey:e.accountPubkey,isSigner:!1,isWritable:!0},{pubkey:e.basePubkey,isSigner:!0,isWritable:!1}]}else{const s=de.Allocate;t=te(s,{space:e.space}),r=[{pubkey:e.accountPubkey,isSigner:!0,isWritable:!0}]}return new le({keys:r,programId:this.programId,data:t})}}Ie.programId=new O("11111111111111111111111111111111");const Hl=Dt-300;class rr{constructor(){}static getMinNumSignatures(e){return 2*(Math.ceil(e/rr.chunkSize)+1+1)}static async load(e,t,r,s,i){{const h=await e.getMinimumBalanceForRentExemption(i.length),g=await e.getAccountInfo(r.publicKey,"confirmed");let d=null;if(g!==null){if(g.executable)return console.error("Program load failed, account is already executable"),!1;g.data.length!==i.length&&(d=d||new oe,d.add(Ie.allocate({accountPubkey:r.publicKey,space:i.length}))),g.owner.equals(s)||(d=d||new oe,d.add(Ie.assign({accountPubkey:r.publicKey,programId:s}))),g.lamports<h&&(d=d||new oe,d.add(Ie.transfer({fromPubkey:t.publicKey,toPubkey:r.publicKey,lamports:h-g.lamports})))}else d=new oe().add(Ie.createAccount({fromPubkey:t.publicKey,newAccountPubkey:r.publicKey,lamports:h>0?h:1,space:i.length,programId:s}));d!==null&&await hs(e,d,[t,r],{commitment:"confirmed"})}const o=M([D("instruction"),D("offset"),D("bytesLength"),D("bytesLengthPadding"),Ce(re("byte"),Kt(D(),-8),"bytes")]),a=rr.chunkSize;let c=0,l=i,u=[];for(;l.length>0;){const h=l.slice(0,a),g=$.Buffer.alloc(a+16);o.encode({instruction:0,offset:c,bytes:h,bytesLength:0,bytesLengthPadding:0},g);const d=new oe().add({keys:[{pubkey:r.publicKey,isSigner:!0,isWritable:!0}],programId:s,data:g});u.push(hs(e,d,[t,r],{commitment:"confirmed"})),e._rpcEndpoint.includes("solana.com")&&await Ht(1e3/4),c+=a,l=l.slice(a)}await Promise.all(u);{const h=M([D("instruction")]),g=$.Buffer.alloc(h.span);h.encode({instruction:1},g);const d=new oe().add({keys:[{pubkey:r.publicKey,isSigner:!0,isWritable:!0},{pubkey:wr,isSigner:!1,isWritable:!1}],programId:s,data:g}),p="processed",y=await e.sendTransaction(d,[t,r],{preflightCommitment:p}),{context:f,value:k}=await e.confirmTransaction({signature:y,lastValidBlockHeight:d.lastValidBlockHeight,blockhash:d.recentBlockhash},p);if(k.err)throw new Error(`Transaction ${y} failed (${JSON.stringify(k)})`);for(;;){try{if(await e.getSlot({commitment:p})>f.slot)break}catch{}await new Promise(I=>setTimeout(I,Math.round(ya/2)))}}return!0}}rr.chunkSize=Hl;const Gl=new O("BPFLoader2111111111111111111111111111111111");class Yl{static getMinNumSignatures(e){return rr.getMinNumSignatures(e)}static load(e,t,r,s,i){return rr.load(e,t,r,i,s)}}function Jl(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Zl=Object.prototype.toString,Xl=Object.keys||function(n){var e=[];for(var t in n)e.push(t);return e};function Pr(n,e){var t,r,s,i,o,a,c;if(n===!0)return"true";if(n===!1)return"false";switch(typeof n){case"object":if(n===null)return null;if(n.toJSON&&typeof n.toJSON=="function")return Pr(n.toJSON(),e);if(c=Zl.call(n),c==="[object Array]"){for(s="[",r=n.length-1,t=0;t<r;t++)s+=Pr(n[t],!0)+",";return r>-1&&(s+=Pr(n[t],!0)),s+"]"}else if(c==="[object Object]"){for(i=Xl(n).sort(),r=i.length,s="",t=0;t<r;)o=i[t],a=Pr(n[o],!1),a!==void 0&&(s&&(s+=","),s+=JSON.stringify(o)+":"+a),t++;return"{"+s+"}"}else return JSON.stringify(n);case"function":case"undefined":return e?null:void 0;case"string":return JSON.stringify(n);default:return isFinite(n)?n:null}}var Ql=function(n){var e=Pr(n,!1);if(e!==void 0)return""+e},Zi=Jl(Ql);const xr=32;function ss(n){let e=0;for(;n>1;)n/=2,e++;return e}function ed(n){return n===0?1:(n--,n|=n>>1,n|=n>>2,n|=n>>4,n|=n>>8,n|=n>>16,n|=n>>32,n+1)}class wa{constructor(e,t,r,s,i){this.slotsPerEpoch=void 0,this.leaderScheduleSlotOffset=void 0,this.warmup=void 0,this.firstNormalEpoch=void 0,this.firstNormalSlot=void 0,this.slotsPerEpoch=e,this.leaderScheduleSlotOffset=t,this.warmup=r,this.firstNormalEpoch=s,this.firstNormalSlot=i}getEpoch(e){return this.getEpochAndSlotIndex(e)[0]}getEpochAndSlotIndex(e){if(e<this.firstNormalSlot){const t=ss(ed(e+xr+1))-ss(xr)-1,r=this.getSlotsInEpoch(t),s=e-(r-xr);return[t,s]}else{const t=e-this.firstNormalSlot,r=Math.floor(t/this.slotsPerEpoch),s=this.firstNormalEpoch+r,i=t%this.slotsPerEpoch;return[s,i]}}getFirstSlotInEpoch(e){return e<=this.firstNormalEpoch?(Math.pow(2,e)-1)*xr:(e-this.firstNormalEpoch)*this.slotsPerEpoch+this.firstNormalSlot}getLastSlotInEpoch(e){return this.getFirstSlotInEpoch(e)+this.getSlotsInEpoch(e)-1}getSlotsInEpoch(e){return e<this.firstNormalEpoch?Math.pow(2,e+ss(xr)):this.slotsPerEpoch}}class ps extends Error{constructor(e,t){super(e),this.logs=void 0,this.logs=t}}const td={JSON_RPC_SERVER_ERROR_BLOCK_CLEANED_UP:-32001,JSON_RPC_SERVER_ERROR_SEND_TRANSACTION_PREFLIGHT_FAILURE:-32002,JSON_RPC_SERVER_ERROR_TRANSACTION_SIGNATURE_VERIFICATION_FAILURE:-32003,JSON_RPC_SERVER_ERROR_BLOCK_NOT_AVAILABLE:-32004,JSON_RPC_SERVER_ERROR_NODE_UNHEALTHY:-32005,JSON_RPC_SERVER_ERROR_TRANSACTION_PRECOMPILE_VERIFICATION_FAILURE:-32006,JSON_RPC_SERVER_ERROR_SLOT_SKIPPED:-32007,JSON_RPC_SERVER_ERROR_NO_SNAPSHOT:-32008,JSON_RPC_SERVER_ERROR_LONG_TERM_STORAGE_SLOT_SKIPPED:-32009,JSON_RPC_SERVER_ERROR_KEY_EXCLUDED_FROM_SECONDARY_INDEX:-32010,JSON_RPC_SERVER_ERROR_TRANSACTION_HISTORY_NOT_AVAILABLE:-32011,JSON_RPC_SCAN_ERROR:-32012,JSON_RPC_SERVER_ERROR_TRANSACTION_SIGNATURE_LEN_MISMATCH:-32013,JSON_RPC_SERVER_ERROR_BLOCK_STATUS_NOT_AVAILABLE_YET:-32014,JSON_RPC_SERVER_ERROR_UNSUPPORTED_TRANSACTION_VERSION:-32015,JSON_RPC_SERVER_ERROR_MIN_CONTEXT_SLOT_NOT_REACHED:-32016};class W extends Error{constructor({code:e,message:t,data:r},s){super(s!=null?`${s}: ${t}`:t),this.code=void 0,this.data=void 0,this.code=e,this.data=r,this.name="SolanaJSONRPCError"}}var rd=globalThis.fetch;class nd extends Sl{constructor(e,t,r){const s=i=>{const o=_l(i,{autoconnect:!0,max_reconnects:5,reconnect:!0,reconnect_interval:1e3,...t});return"socket"in o?this.underlyingSocket=o.socket:this.underlyingSocket=o,o};super(s,e,t,r),this.underlyingSocket=void 0}call(...e){var r;const t=(r=this.underlyingSocket)==null?void 0:r.readyState;return t===1?super.call(...e):Promise.reject(new Error("Tried to call a JSON-RPC method `"+e[0]+"` but the socket was not `CONNECTING` or `OPEN` (`readyState` was "+t+")"))}notify(...e){var r;const t=(r=this.underlyingSocket)==null?void 0:r.readyState;return t===1?super.notify(...e):Promise.reject(new Error("Tried to send a JSON-RPC notification `"+e[0]+"` but the socket was not `CONNECTING` or `OPEN` (`readyState` was "+t+")"))}}function sd(n,e){let t;try{t=n.layout.decode(e)}catch(r){throw new Error("invalid instruction; "+r)}if(t.typeIndex!==n.index)throw new Error(`invalid account data; account type mismatch ${t.typeIndex} != ${n.index}`);return t}const Xi=56;class gs{constructor(e){this.key=void 0,this.state=void 0,this.key=e.key,this.state=e.state}isActive(){const e=BigInt("0xffffffffffffffff");return this.state.deactivationSlot===e}static deserialize(e){const t=sd(id,e),r=e.length-Xi;se(r>=0,"lookup table is invalid"),se(r%32===0,"lookup table is invalid");const s=r/32,{addresses:i}=M([Ce(ee(),s,"addresses")]).decode(e.slice(Xi));return{deactivationSlot:t.deactivationSlot,lastExtendedSlot:t.lastExtendedSlot,lastExtendedSlotStartIndex:t.lastExtendedStartIndex,authority:t.authority.length!==0?new O(t.authority[0]):void 0,addresses:i.map(o=>new O(o))}}}const id={index:1,layout:M([D("typeIndex"),vr("deactivationSlot"),Pe("lastExtendedSlot"),re("lastExtendedStartIndex"),re(),Ce(ee(),Kt(re(),-1),"authority")])},od=/^[^:]+:\/\/([^:[]+|\[[^\]]+\])(:\d+)?(.*)/i;function ad(n){const e=n.match(od);if(e==null)throw TypeError(`Failed to validate endpoint URL \`${n}\``);const[t,r,s,i]=e,o=n.startsWith("https:")?"wss:":"ws:",a=s==null?null:parseInt(s.slice(1),10),c=a==null?"":`:${a+1}`;return`${o}//${r}${c}${i}`}const ve=Mr(Ks(O),C(),n=>new O(n)),va=zs([C(),ye("base64")]),Js=Mr(Ks($.Buffer),va,n=>$.Buffer.from(n[0],"base64")),ka=30*1e3;function cd(n){if(/^https?:/.test(n)===!1)throw new TypeError("Endpoint URL must start with `http:` or `https:`.");return n}function pe(n){let e,t;if(typeof n=="string")e=n;else if(n){const{commitment:r,...s}=n;e=r,t=s}return{commitment:e,config:t}}function Sa(n){return He([P({jsonrpc:ye("2.0"),id:C(),result:n}),P({jsonrpc:ye("2.0"),id:C(),error:P({code:Dr(),message:C(),data:V(Ku())})})])}const ud=Sa(Dr());function Z(n){return Mr(Sa(n),ud,e=>"error"in e?e:{...e,result:L(e.result,n)})}function be(n){return Z(P({context:P({slot:m()}),value:n}))}function _n(n){return P({context:P({slot:m()}),value:n})}function is(n,e){return n===0?new tr({header:e.header,staticAccountKeys:e.accountKeys.map(t=>new O(t)),recentBlockhash:e.recentBlockhash,compiledInstructions:e.instructions.map(t=>({programIdIndex:t.programIdIndex,accountKeyIndexes:t.accounts,data:Te.decode(t.data)})),addressTableLookups:e.addressTableLookups}):new ct(e)}const ld=P({foundation:m(),foundationTerm:m(),initial:m(),taper:m(),terminal:m()}),dd=Z(z(F(P({epoch:m(),effectiveSlot:m(),amount:m(),postBalance:m(),commission:V(F(m()))})))),hd=z(P({slot:m(),prioritizationFee:m()})),fd=P({total:m(),validator:m(),foundation:m(),epoch:m()}),pd=P({epoch:m(),slotIndex:m(),slotsInEpoch:m(),absoluteSlot:m(),blockHeight:V(m()),transactionCount:V(m())}),gd=P({slotsPerEpoch:m(),leaderScheduleSlotOffset:m(),warmup:yt(),firstNormalEpoch:m(),firstNormalSlot:m()}),yd=Qo(C(),z(m())),or=F(He([P({}),C()])),md=P({err:or}),bd=ye("receivedSignature"),wd=P({"solana-core":C(),"feature-set":V(m())}),Qi=be(P({err:F(He([P({}),C()])),logs:F(z(C())),accounts:V(F(z(F(P({executable:yt(),owner:C(),lamports:m(),data:z(C()),rentEpoch:V(m())}))))),unitsConsumed:V(m()),returnData:V(F(P({programId:C(),data:zs([C(),ye("base64")])})))})),vd=be(P({byIdentity:Qo(C(),z(m())),range:P({firstSlot:m(),lastSlot:m()})}));function kd(n,e,t,r,s,i){const o=t||rd;let a;i!=null&&console.warn("You have supplied an `httpAgent` when creating a `Connection` in a browser environment.It has been ignored; `httpAgent` is only used in Node environments.");let c;return r&&(c=async(u,h)=>{const g=await new Promise((d,p)=>{try{r(u,h,(y,f)=>d([y,f]))}catch(y){p(y)}});return await o(...g)}),new fl(async(u,h)=>{const g={method:"POST",body:u,agent:a,headers:Object.assign({"Content-Type":"application/json"},e||{},Sh)};try{let d=5,p,y=500;for(;c?p=await c(n,g):p=await o(n,g),!(p.status!==429||s===!0||(d-=1,d===0));)console.error(`Server responded with ${p.status} ${p.statusText}.  Retrying after ${y}ms delay...`),await Ht(y),y*=2;const f=await p.text();p.ok?h(null,f):h(new Error(`${p.status} ${p.statusText}: ${f}`))}catch(d){d instanceof Error&&h(d)}},{})}function Sd(n){return(e,t)=>new Promise((r,s)=>{n.request(e,t,(i,o)=>{if(i){s(i);return}r(o)})})}function _d(n){return e=>new Promise((t,r)=>{e.length===0&&t([]);const s=e.map(i=>n.request(i.methodName,i.args));n.request(s,(i,o)=>{if(i){r(i);return}t(o)})})}const Ed=Z(ld),Id=Z(fd),Ad=Z(hd),xd=Z(pd),Rd=Z(gd),Pd=Z(yd),Bd=Z(m()),Td=be(P({total:m(),circulating:m(),nonCirculating:m(),nonCirculatingAccounts:z(ve)})),ys=P({amount:C(),uiAmount:F(m()),decimals:m(),uiAmountString:V(C())}),Cd=be(z(P({address:ve,amount:C(),uiAmount:F(m()),decimals:m(),uiAmountString:V(C())}))),Od=be(z(P({pubkey:ve,account:P({executable:yt(),owner:ve,lamports:m(),data:Js,rentEpoch:m()})}))),ms=P({program:C(),parsed:Dr(),space:m()}),Ld=be(z(P({pubkey:ve,account:P({executable:yt(),owner:ve,lamports:m(),data:ms,rentEpoch:m()})}))),Nd=be(z(P({lamports:m(),address:ve}))),Or=P({executable:yt(),owner:ve,lamports:m(),data:Js,rentEpoch:m()}),Ud=P({pubkey:ve,account:Or}),Fd=Mr(He([Ks($.Buffer),ms]),He([va,ms]),n=>Array.isArray(n)?L(n,Js):n),bs=P({executable:yt(),owner:ve,lamports:m(),data:Fd,rentEpoch:m()}),Kd=P({pubkey:ve,account:bs}),zd=P({state:He([ye("active"),ye("inactive"),ye("activating"),ye("deactivating")]),active:m(),inactive:m()}),Dd=Z(z(P({signature:C(),slot:m(),err:or,memo:F(C()),blockTime:V(F(m()))}))),Md=Z(z(P({signature:C(),slot:m(),err:or,memo:F(C()),blockTime:V(F(m()))}))),Wd=P({subscription:m(),result:_n(Or)}),qd=P({pubkey:ve,account:Or}),jd=P({subscription:m(),result:_n(qd)}),$d=P({parent:m(),slot:m(),root:m()}),Vd=P({subscription:m(),result:$d}),Hd=He([P({type:He([ye("firstShredReceived"),ye("completed"),ye("optimisticConfirmation"),ye("root")]),slot:m(),timestamp:m()}),P({type:ye("createdBank"),parent:m(),slot:m(),timestamp:m()}),P({type:ye("frozen"),slot:m(),timestamp:m(),stats:P({numTransactionEntries:m(),numSuccessfulTransactions:m(),numFailedTransactions:m(),maxTransactionsPerEntry:m()})}),P({type:ye("dead"),slot:m(),timestamp:m(),err:C()})]),Gd=P({subscription:m(),result:Hd}),Yd=P({subscription:m(),result:_n(He([md,bd]))}),Jd=P({subscription:m(),result:m()}),Zd=P({pubkey:C(),gossip:F(C()),tpu:F(C()),rpc:F(C()),version:F(C())}),eo=P({votePubkey:C(),nodePubkey:C(),activatedStake:m(),epochVoteAccount:yt(),epochCredits:z(zs([m(),m(),m()])),commission:m(),lastVote:m(),rootSlot:F(m())}),Xd=Z(P({current:z(eo),delinquent:z(eo)})),Qd=He([ye("processed"),ye("confirmed"),ye("finalized")]),eh=P({slot:m(),confirmations:F(m()),err:or,confirmationStatus:V(Qd)}),th=be(z(F(eh))),rh=Z(m()),_a=P({accountKey:ve,writableIndexes:z(m()),readonlyIndexes:z(m())}),Zs=P({signatures:z(C()),message:P({accountKeys:z(C()),header:P({numRequiredSignatures:m(),numReadonlySignedAccounts:m(),numReadonlyUnsignedAccounts:m()}),instructions:z(P({accounts:z(m()),data:C(),programIdIndex:m()})),recentBlockhash:C(),addressTableLookups:V(z(_a))})}),Ea=P({pubkey:ve,signer:yt(),writable:yt(),source:V(He([ye("transaction"),ye("lookupTable")]))}),Ia=P({accountKeys:z(Ea),signatures:z(C())}),Aa=P({parsed:Dr(),program:C(),programId:ve}),xa=P({accounts:z(ve),data:C(),programId:ve}),nh=He([xa,Aa]),sh=He([P({parsed:Dr(),program:C(),programId:C()}),P({accounts:z(C()),data:C(),programId:C()})]),Ra=Mr(nh,sh,n=>"accounts"in n?L(n,xa):L(n,Aa)),Pa=P({signatures:z(C()),message:P({accountKeys:z(Ea),instructions:z(Ra),recentBlockhash:C(),addressTableLookups:V(F(z(_a)))})}),un=P({accountIndex:m(),mint:C(),owner:V(C()),uiTokenAmount:ys}),Ba=P({writable:z(ve),readonly:z(ve)}),En=P({err:or,fee:m(),innerInstructions:V(F(z(P({index:m(),instructions:z(P({accounts:z(m()),data:C(),programIdIndex:m()}))})))),preBalances:z(m()),postBalances:z(m()),logMessages:V(F(z(C()))),preTokenBalances:V(F(z(un))),postTokenBalances:V(F(z(un))),loadedAddresses:V(Ba),computeUnitsConsumed:V(m())}),Xs=P({err:or,fee:m(),innerInstructions:V(F(z(P({index:m(),instructions:z(Ra)})))),preBalances:z(m()),postBalances:z(m()),logMessages:V(F(z(C()))),preTokenBalances:V(F(z(un))),postTokenBalances:V(F(z(un))),loadedAddresses:V(Ba),computeUnitsConsumed:V(m())}),Ir=He([ye(0),ye("legacy")]),ar=P({pubkey:C(),lamports:m(),postBalance:F(m()),rewardType:F(C()),commission:V(F(m()))}),ih=Z(F(P({blockhash:C(),previousBlockhash:C(),parentSlot:m(),transactions:z(P({transaction:Zs,meta:F(En),version:V(Ir)})),rewards:V(z(ar)),blockTime:F(m()),blockHeight:F(m())}))),oh=Z(F(P({blockhash:C(),previousBlockhash:C(),parentSlot:m(),rewards:V(z(ar)),blockTime:F(m()),blockHeight:F(m())}))),ah=Z(F(P({blockhash:C(),previousBlockhash:C(),parentSlot:m(),transactions:z(P({transaction:Ia,meta:F(En),version:V(Ir)})),rewards:V(z(ar)),blockTime:F(m()),blockHeight:F(m())}))),ch=Z(F(P({blockhash:C(),previousBlockhash:C(),parentSlot:m(),transactions:z(P({transaction:Pa,meta:F(Xs),version:V(Ir)})),rewards:V(z(ar)),blockTime:F(m()),blockHeight:F(m())}))),uh=Z(F(P({blockhash:C(),previousBlockhash:C(),parentSlot:m(),transactions:z(P({transaction:Ia,meta:F(Xs),version:V(Ir)})),rewards:V(z(ar)),blockTime:F(m()),blockHeight:F(m())}))),lh=Z(F(P({blockhash:C(),previousBlockhash:C(),parentSlot:m(),rewards:V(z(ar)),blockTime:F(m()),blockHeight:F(m())}))),dh=Z(F(P({blockhash:C(),previousBlockhash:C(),parentSlot:m(),transactions:z(P({transaction:Zs,meta:F(En)})),rewards:V(z(ar)),blockTime:F(m())}))),to=Z(F(P({blockhash:C(),previousBlockhash:C(),parentSlot:m(),signatures:z(C()),blockTime:F(m())}))),os=Z(F(P({slot:m(),meta:F(En),blockTime:V(F(m())),transaction:Zs,version:V(Ir)}))),Xr=Z(F(P({slot:m(),transaction:Pa,meta:F(Xs),blockTime:V(F(m())),version:V(Ir)}))),hh=be(P({blockhash:C(),feeCalculator:P({lamportsPerSignature:m()})})),fh=be(P({blockhash:C(),lastValidBlockHeight:m()})),ph=be(yt()),gh=P({slot:m(),numTransactions:m(),numSlots:m(),samplePeriodSecs:m()}),yh=Z(z(gh)),mh=be(F(P({feeCalculator:P({lamportsPerSignature:m()})}))),bh=Z(C()),wh=Z(C()),vh=P({err:or,logs:z(C()),signature:C()}),kh=P({result:_n(vh),subscription:m()}),Sh={"solana-client":"js/0.0.0-development"};class _h{constructor(e,t){this._commitment=void 0,this._confirmTransactionInitialTimeout=void 0,this._rpcEndpoint=void 0,this._rpcWsEndpoint=void 0,this._rpcClient=void 0,this._rpcRequest=void 0,this._rpcBatchRequest=void 0,this._rpcWebSocket=void 0,this._rpcWebSocketConnected=!1,this._rpcWebSocketHeartbeat=null,this._rpcWebSocketIdleTimeout=null,this._rpcWebSocketGeneration=0,this._disableBlockhashCaching=!1,this._pollingBlockhash=!1,this._blockhashInfo={latestBlockhash:null,lastFetch:0,transactionSignatures:[],simulatedSignatures:[]},this._nextClientSubscriptionId=0,this._subscriptionDisposeFunctionsByClientSubscriptionId={},this._subscriptionHashByClientSubscriptionId={},this._subscriptionStateChangeCallbacksByHash={},this._subscriptionCallbacksByServerSubscriptionId={},this._subscriptionsByHash={},this._subscriptionsAutoDisposedByRpc=new Set,this.getBlockHeight=(()=>{const l={};return async u=>{const{commitment:h,config:g}=pe(u),d=this._buildArgs([],h,void 0,g),p=Zi(d);return l[p]=l[p]??(async()=>{try{const y=await this._rpcRequest("getBlockHeight",d),f=L(y,Z(m()));if("error"in f)throw new W(f.error,"failed to get block height information");return f.result}finally{delete l[p]}})(),await l[p]}})();let r,s,i,o,a,c;t&&typeof t=="string"?this._commitment=t:t&&(this._commitment=t.commitment,this._confirmTransactionInitialTimeout=t.confirmTransactionInitialTimeout,r=t.wsEndpoint,s=t.httpHeaders,i=t.fetch,o=t.fetchMiddleware,a=t.disableRetryOnRateLimit,c=t.httpAgent),this._rpcEndpoint=cd(e),this._rpcWsEndpoint=r||ad(e),this._rpcClient=kd(e,s,i,o,a,c),this._rpcRequest=Sd(this._rpcClient),this._rpcBatchRequest=_d(this._rpcClient),this._rpcWebSocket=new nd(this._rpcWsEndpoint,{autoconnect:!1,max_reconnects:1/0}),this._rpcWebSocket.on("open",this._wsOnOpen.bind(this)),this._rpcWebSocket.on("error",this._wsOnError.bind(this)),this._rpcWebSocket.on("close",this._wsOnClose.bind(this)),this._rpcWebSocket.on("accountNotification",this._wsOnAccountNotification.bind(this)),this._rpcWebSocket.on("programNotification",this._wsOnProgramAccountNotification.bind(this)),this._rpcWebSocket.on("slotNotification",this._wsOnSlotNotification.bind(this)),this._rpcWebSocket.on("slotsUpdatesNotification",this._wsOnSlotUpdatesNotification.bind(this)),this._rpcWebSocket.on("signatureNotification",this._wsOnSignatureNotification.bind(this)),this._rpcWebSocket.on("rootNotification",this._wsOnRootNotification.bind(this)),this._rpcWebSocket.on("logsNotification",this._wsOnLogsNotification.bind(this))}get commitment(){return this._commitment}get rpcEndpoint(){return this._rpcEndpoint}async getBalanceAndContext(e,t){const{commitment:r,config:s}=pe(t),i=this._buildArgs([e.toBase58()],r,void 0,s),o=await this._rpcRequest("getBalance",i),a=L(o,be(m()));if("error"in a)throw new W(a.error,`failed to get balance for ${e.toBase58()}`);return a.result}async getBalance(e,t){return await this.getBalanceAndContext(e,t).then(r=>r.value).catch(r=>{throw new Error("failed to get balance of account "+e.toBase58()+": "+r)})}async getBlockTime(e){const t=await this._rpcRequest("getBlockTime",[e]),r=L(t,Z(F(m())));if("error"in r)throw new W(r.error,`failed to get block time for slot ${e}`);return r.result}async getMinimumLedgerSlot(){const e=await this._rpcRequest("minimumLedgerSlot",[]),t=L(e,Z(m()));if("error"in t)throw new W(t.error,"failed to get minimum ledger slot");return t.result}async getFirstAvailableBlock(){const e=await this._rpcRequest("getFirstAvailableBlock",[]),t=L(e,Bd);if("error"in t)throw new W(t.error,"failed to get first available block");return t.result}async getSupply(e){let t={};typeof e=="string"?t={commitment:e}:e?t={...e,commitment:e&&e.commitment||this.commitment}:t={commitment:this.commitment};const r=await this._rpcRequest("getSupply",[t]),s=L(r,Td);if("error"in s)throw new W(s.error,"failed to get supply");return s.result}async getTokenSupply(e,t){const r=this._buildArgs([e.toBase58()],t),s=await this._rpcRequest("getTokenSupply",r),i=L(s,be(ys));if("error"in i)throw new W(i.error,"failed to get token supply");return i.result}async getTokenAccountBalance(e,t){const r=this._buildArgs([e.toBase58()],t),s=await this._rpcRequest("getTokenAccountBalance",r),i=L(s,be(ys));if("error"in i)throw new W(i.error,"failed to get token account balance");return i.result}async getTokenAccountsByOwner(e,t,r){const{commitment:s,config:i}=pe(r);let o=[e.toBase58()];"mint"in t?o.push({mint:t.mint.toBase58()}):o.push({programId:t.programId.toBase58()});const a=this._buildArgs(o,s,"base64",i),c=await this._rpcRequest("getTokenAccountsByOwner",a),l=L(c,Od);if("error"in l)throw new W(l.error,`failed to get token accounts owned by account ${e.toBase58()}`);return l.result}async getParsedTokenAccountsByOwner(e,t,r){let s=[e.toBase58()];"mint"in t?s.push({mint:t.mint.toBase58()}):s.push({programId:t.programId.toBase58()});const i=this._buildArgs(s,r,"jsonParsed"),o=await this._rpcRequest("getTokenAccountsByOwner",i),a=L(o,Ld);if("error"in a)throw new W(a.error,`failed to get token accounts owned by account ${e.toBase58()}`);return a.result}async getLargestAccounts(e){const t={...e,commitment:e&&e.commitment||this.commitment},r=t.filter||t.commitment?[t]:[],s=await this._rpcRequest("getLargestAccounts",r),i=L(s,Nd);if("error"in i)throw new W(i.error,"failed to get largest accounts");return i.result}async getTokenLargestAccounts(e,t){const r=this._buildArgs([e.toBase58()],t),s=await this._rpcRequest("getTokenLargestAccounts",r),i=L(s,Cd);if("error"in i)throw new W(i.error,"failed to get token largest accounts");return i.result}async getAccountInfoAndContext(e,t){const{commitment:r,config:s}=pe(t),i=this._buildArgs([e.toBase58()],r,"base64",s),o=await this._rpcRequest("getAccountInfo",i),a=L(o,be(F(Or)));if("error"in a)throw new W(a.error,`failed to get info about account ${e.toBase58()}`);return a.result}async getParsedAccountInfo(e,t){const{commitment:r,config:s}=pe(t),i=this._buildArgs([e.toBase58()],r,"jsonParsed",s),o=await this._rpcRequest("getAccountInfo",i),a=L(o,be(F(bs)));if("error"in a)throw new W(a.error,`failed to get info about account ${e.toBase58()}`);return a.result}async getAccountInfo(e,t){try{return(await this.getAccountInfoAndContext(e,t)).value}catch(r){throw new Error("failed to get info about account "+e.toBase58()+": "+r)}}async getMultipleParsedAccounts(e,t){const{commitment:r,config:s}=pe(t),i=e.map(l=>l.toBase58()),o=this._buildArgs([i],r,"jsonParsed",s),a=await this._rpcRequest("getMultipleAccounts",o),c=L(a,be(z(F(bs))));if("error"in c)throw new W(c.error,`failed to get info for accounts ${i}`);return c.result}async getMultipleAccountsInfoAndContext(e,t){const{commitment:r,config:s}=pe(t),i=e.map(l=>l.toBase58()),o=this._buildArgs([i],r,"base64",s),a=await this._rpcRequest("getMultipleAccounts",o),c=L(a,be(z(F(Or))));if("error"in c)throw new W(c.error,`failed to get info for accounts ${i}`);return c.result}async getMultipleAccountsInfo(e,t){return(await this.getMultipleAccountsInfoAndContext(e,t)).value}async getStakeActivation(e,t,r){const{commitment:s,config:i}=pe(t),o=this._buildArgs([e.toBase58()],s,void 0,{...i,epoch:r??(i==null?void 0:i.epoch)}),a=await this._rpcRequest("getStakeActivation",o),c=L(a,Z(zd));if("error"in c)throw new W(c.error,`failed to get Stake Activation ${e.toBase58()}`);return c.result}async getProgramAccounts(e,t){const{commitment:r,config:s}=pe(t),{encoding:i,...o}=s||{},a=this._buildArgs([e.toBase58()],r,i||"base64",o),c=await this._rpcRequest("getProgramAccounts",a),l=z(Ud),u=o.withContext===!0?L(c,be(l)):L(c,Z(l));if("error"in u)throw new W(u.error,`failed to get accounts owned by program ${e.toBase58()}`);return u.result}async getParsedProgramAccounts(e,t){const{commitment:r,config:s}=pe(t),i=this._buildArgs([e.toBase58()],r,"jsonParsed",s),o=await this._rpcRequest("getProgramAccounts",i),a=L(o,Z(z(Kd)));if("error"in a)throw new W(a.error,`failed to get accounts owned by program ${e.toBase58()}`);return a.result}async confirmTransaction(e,t){var i;let r;if(typeof e=="string")r=e;else{const o=e;if((i=o.abortSignal)!=null&&i.aborted)return Promise.reject(o.abortSignal.reason);r=o.signature}let s;try{s=Te.decode(r)}catch{throw new Error("signature must be base58 encoded: "+r)}return se(s.length===64,"signature has invalid length"),typeof e=="string"?await this.confirmTransactionUsingLegacyTimeoutStrategy({commitment:t||this.commitment,signature:r}):"lastValidBlockHeight"in e?await this.confirmTransactionUsingBlockHeightExceedanceStrategy({commitment:t||this.commitment,strategy:e}):await this.confirmTransactionUsingDurableNonceStrategy({commitment:t||this.commitment,strategy:e})}getCancellationPromise(e){return new Promise((t,r)=>{e!=null&&(e.aborted?r(e.reason):e.addEventListener("abort",()=>{r(e.reason)}))})}getTransactionConfirmationPromise({commitment:e,signature:t}){let r,s,i=!1;const o=new Promise((c,l)=>{try{r=this.onSignature(t,(h,g)=>{r=void 0;const d={context:g,value:h};c({__type:Et.PROCESSED,response:d})},e);const u=new Promise(h=>{r==null?h():s=this._onSubscriptionStateChange(r,g=>{g==="subscribed"&&h()})});(async()=>{if(await u,i)return;const h=await this.getSignatureStatus(t);if(i||h==null)return;const{context:g,value:d}=h;if(d!=null)if(d!=null&&d.err)l(d.err);else{switch(e){case"confirmed":case"single":case"singleGossip":{if(d.confirmationStatus==="processed")return;break}case"finalized":case"max":case"root":{if(d.confirmationStatus==="processed"||d.confirmationStatus==="confirmed")return;break}case"processed":case"recent":}i=!0,c({__type:Et.PROCESSED,response:{context:g,value:d}})}})()}catch(u){l(u)}});return{abortConfirmation:()=>{s&&(s(),s=void 0),r!=null&&(this.removeSignatureListener(r),r=void 0)},confirmationPromise:o}}async confirmTransactionUsingBlockHeightExceedanceStrategy({commitment:e,strategy:{abortSignal:t,lastValidBlockHeight:r,signature:s}}){let i=!1;const o=new Promise(h=>{const g=async()=>{try{return await this.getBlockHeight(e)}catch{return-1}};(async()=>{let d=await g();if(!i){for(;d<=r;)if(await Ht(1e3),i||(d=await g(),i))return;h({__type:Et.BLOCKHEIGHT_EXCEEDED})}})()}),{abortConfirmation:a,confirmationPromise:c}=this.getTransactionConfirmationPromise({commitment:e,signature:s}),l=this.getCancellationPromise(t);let u;try{const h=await Promise.race([l,c,o]);if(h.__type===Et.PROCESSED)u=h.response;else throw new $s(s)}finally{i=!0,a()}return u}async confirmTransactionUsingDurableNonceStrategy({commitment:e,strategy:{abortSignal:t,minContextSlot:r,nonceAccountPubkey:s,nonceValue:i,signature:o}}){let a=!1;const c=new Promise(d=>{let p=i,y=null;const f=async()=>{try{const{context:k,value:I}=await this.getNonceAndContext(s,{commitment:e,minContextSlot:r});return y=k.slot,I==null?void 0:I.nonce}catch{return p}};(async()=>{if(p=await f(),!a)for(;;){if(i!==p){d({__type:Et.NONCE_INVALID,slotInWhichNonceDidAdvance:y});return}if(await Ht(2e3),a||(p=await f(),a))return}})()}),{abortConfirmation:l,confirmationPromise:u}=this.getTransactionConfirmationPromise({commitment:e,signature:o}),h=this.getCancellationPromise(t);let g;try{const d=await Promise.race([h,u,c]);if(d.__type===Et.PROCESSED)g=d.response;else{let p;for(;;){const y=await this.getSignatureStatus(o);if(y==null)break;if(y.context.slot<(d.slotInWhichNonceDidAdvance??r)){await Ht(400);continue}p=y;break}if(p!=null&&p.value){const y=e||"finalized",{confirmationStatus:f}=p.value;switch(y){case"processed":case"recent":if(f!=="processed"&&f!=="confirmed"&&f!=="finalized")throw new dr(o);break;case"confirmed":case"single":case"singleGossip":if(f!=="confirmed"&&f!=="finalized")throw new dr(o);break;case"finalized":case"max":case"root":if(f!=="finalized")throw new dr(o);break;default:}g={context:p.context,value:{err:p.value.err}}}else throw new dr(o)}}finally{a=!0,l()}return g}async confirmTransactionUsingLegacyTimeoutStrategy({commitment:e,signature:t}){let r;const s=new Promise(c=>{let l=this._confirmTransactionInitialTimeout||6e4;switch(e){case"processed":case"recent":case"single":case"confirmed":case"singleGossip":{l=this._confirmTransactionInitialTimeout||3e4;break}}r=setTimeout(()=>c({__type:Et.TIMED_OUT,timeoutMs:l}),l)}),{abortConfirmation:i,confirmationPromise:o}=this.getTransactionConfirmationPromise({commitment:e,signature:t});let a;try{const c=await Promise.race([o,s]);if(c.__type===Et.PROCESSED)a=c.response;else throw new Vs(t,c.timeoutMs/1e3)}finally{clearTimeout(r),i()}return a}async getClusterNodes(){const e=await this._rpcRequest("getClusterNodes",[]),t=L(e,Z(z(Zd)));if("error"in t)throw new W(t.error,"failed to get cluster nodes");return t.result}async getVoteAccounts(e){const t=this._buildArgs([],e),r=await this._rpcRequest("getVoteAccounts",t),s=L(r,Xd);if("error"in s)throw new W(s.error,"failed to get vote accounts");return s.result}async getSlot(e){const{commitment:t,config:r}=pe(e),s=this._buildArgs([],t,void 0,r),i=await this._rpcRequest("getSlot",s),o=L(i,Z(m()));if("error"in o)throw new W(o.error,"failed to get slot");return o.result}async getSlotLeader(e){const{commitment:t,config:r}=pe(e),s=this._buildArgs([],t,void 0,r),i=await this._rpcRequest("getSlotLeader",s),o=L(i,Z(C()));if("error"in o)throw new W(o.error,"failed to get slot leader");return o.result}async getSlotLeaders(e,t){const r=[e,t],s=await this._rpcRequest("getSlotLeaders",r),i=L(s,Z(z(ve)));if("error"in i)throw new W(i.error,"failed to get slot leaders");return i.result}async getSignatureStatus(e,t){const{context:r,value:s}=await this.getSignatureStatuses([e],t);se(s.length===1);const i=s[0];return{context:r,value:i}}async getSignatureStatuses(e,t){const r=[e];t&&r.push(t);const s=await this._rpcRequest("getSignatureStatuses",r),i=L(s,th);if("error"in i)throw new W(i.error,"failed to get signature status");return i.result}async getTransactionCount(e){const{commitment:t,config:r}=pe(e),s=this._buildArgs([],t,void 0,r),i=await this._rpcRequest("getTransactionCount",s),o=L(i,Z(m()));if("error"in o)throw new W(o.error,"failed to get transaction count");return o.result}async getTotalSupply(e){return(await this.getSupply({commitment:e,excludeNonCirculatingAccountsList:!0})).value.total}async getInflationGovernor(e){const t=this._buildArgs([],e),r=await this._rpcRequest("getInflationGovernor",t),s=L(r,Ed);if("error"in s)throw new W(s.error,"failed to get inflation");return s.result}async getInflationReward(e,t,r){const{commitment:s,config:i}=pe(r),o=this._buildArgs([e.map(l=>l.toBase58())],s,void 0,{...i,epoch:t??(i==null?void 0:i.epoch)}),a=await this._rpcRequest("getInflationReward",o),c=L(a,dd);if("error"in c)throw new W(c.error,"failed to get inflation reward");return c.result}async getInflationRate(){const e=await this._rpcRequest("getInflationRate",[]),t=L(e,Id);if("error"in t)throw new W(t.error,"failed to get inflation rate");return t.result}async getEpochInfo(e){const{commitment:t,config:r}=pe(e),s=this._buildArgs([],t,void 0,r),i=await this._rpcRequest("getEpochInfo",s),o=L(i,xd);if("error"in o)throw new W(o.error,"failed to get epoch info");return o.result}async getEpochSchedule(){const e=await this._rpcRequest("getEpochSchedule",[]),t=L(e,Rd);if("error"in t)throw new W(t.error,"failed to get epoch schedule");const r=t.result;return new wa(r.slotsPerEpoch,r.leaderScheduleSlotOffset,r.warmup,r.firstNormalEpoch,r.firstNormalSlot)}async getLeaderSchedule(){const e=await this._rpcRequest("getLeaderSchedule",[]),t=L(e,Pd);if("error"in t)throw new W(t.error,"failed to get leader schedule");return t.result}async getMinimumBalanceForRentExemption(e,t){const r=this._buildArgs([e],t),s=await this._rpcRequest("getMinimumBalanceForRentExemption",r),i=L(s,rh);return"error"in i?(console.warn("Unable to fetch minimum balance for rent exemption"),0):i.result}async getRecentBlockhashAndContext(e){const t=this._buildArgs([],e),r=await this._rpcRequest("getRecentBlockhash",t),s=L(r,hh);if("error"in s)throw new W(s.error,"failed to get recent blockhash");return s.result}async getRecentPerformanceSamples(e){const t=await this._rpcRequest("getRecentPerformanceSamples",e?[e]:[]),r=L(t,yh);if("error"in r)throw new W(r.error,"failed to get recent performance samples");return r.result}async getFeeCalculatorForBlockhash(e,t){const r=this._buildArgs([e],t),s=await this._rpcRequest("getFeeCalculatorForBlockhash",r),i=L(s,mh);if("error"in i)throw new W(i.error,"failed to get fee calculator");const{context:o,value:a}=i.result;return{context:o,value:a!==null?a.feeCalculator:null}}async getFeeForMessage(e,t){const r=X(e.serialize()).toString("base64"),s=this._buildArgs([r],t),i=await this._rpcRequest("getFeeForMessage",s),o=L(i,be(F(m())));if("error"in o)throw new W(o.error,"failed to get fee for message");if(o.result===null)throw new Error("invalid blockhash");return o.result}async getRecentPrioritizationFees(e){var o;const t=(o=e==null?void 0:e.lockedWritableAccounts)==null?void 0:o.map(a=>a.toBase58()),r=t!=null&&t.length?[t]:[],s=await this._rpcRequest("getRecentPrioritizationFees",r),i=L(s,Ad);if("error"in i)throw new W(i.error,"failed to get recent prioritization fees");return i.result}async getRecentBlockhash(e){try{return(await this.getRecentBlockhashAndContext(e)).value}catch(t){throw new Error("failed to get recent blockhash: "+t)}}async getLatestBlockhash(e){try{return(await this.getLatestBlockhashAndContext(e)).value}catch(t){throw new Error("failed to get recent blockhash: "+t)}}async getLatestBlockhashAndContext(e){const{commitment:t,config:r}=pe(e),s=this._buildArgs([],t,void 0,r),i=await this._rpcRequest("getLatestBlockhash",s),o=L(i,fh);if("error"in o)throw new W(o.error,"failed to get latest blockhash");return o.result}async isBlockhashValid(e,t){const{commitment:r,config:s}=pe(t),i=this._buildArgs([e],r,void 0,s),o=await this._rpcRequest("isBlockhashValid",i),a=L(o,ph);if("error"in a)throw new W(a.error,"failed to determine if the blockhash `"+e+"`is valid");return a.result}async getVersion(){const e=await this._rpcRequest("getVersion",[]),t=L(e,Z(wd));if("error"in t)throw new W(t.error,"failed to get version");return t.result}async getGenesisHash(){const e=await this._rpcRequest("getGenesisHash",[]),t=L(e,Z(C()));if("error"in t)throw new W(t.error,"failed to get genesis hash");return t.result}async getBlock(e,t){const{commitment:r,config:s}=pe(t),i=this._buildArgsAtLeastConfirmed([e],r,void 0,s),o=await this._rpcRequest("getBlock",i);try{switch(s==null?void 0:s.transactionDetails){case"accounts":{const a=L(o,ah);if("error"in a)throw a.error;return a.result}case"none":{const a=L(o,oh);if("error"in a)throw a.error;return a.result}default:{const a=L(o,ih);if("error"in a)throw a.error;const{result:c}=a;return c?{...c,transactions:c.transactions.map(({transaction:l,meta:u,version:h})=>({meta:u,transaction:{...l,message:is(h,l.message)},version:h}))}:null}}}catch(a){throw new W(a,"failed to get confirmed block")}}async getParsedBlock(e,t){const{commitment:r,config:s}=pe(t),i=this._buildArgsAtLeastConfirmed([e],r,"jsonParsed",s),o=await this._rpcRequest("getBlock",i);try{switch(s==null?void 0:s.transactionDetails){case"accounts":{const a=L(o,uh);if("error"in a)throw a.error;return a.result}case"none":{const a=L(o,lh);if("error"in a)throw a.error;return a.result}default:{const a=L(o,ch);if("error"in a)throw a.error;return a.result}}}catch(a){throw new W(a,"failed to get block")}}async getBlockProduction(e){let t,r;if(typeof e=="string")r=e;else if(e){const{commitment:a,...c}=e;r=a,t=c}const s=this._buildArgs([],r,"base64",t),i=await this._rpcRequest("getBlockProduction",s),o=L(i,vd);if("error"in o)throw new W(o.error,"failed to get block production information");return o.result}async getTransaction(e,t){const{commitment:r,config:s}=pe(t),i=this._buildArgsAtLeastConfirmed([e],r,void 0,s),o=await this._rpcRequest("getTransaction",i),a=L(o,os);if("error"in a)throw new W(a.error,"failed to get transaction");const c=a.result;return c&&{...c,transaction:{...c.transaction,message:is(c.version,c.transaction.message)}}}async getParsedTransaction(e,t){const{commitment:r,config:s}=pe(t),i=this._buildArgsAtLeastConfirmed([e],r,"jsonParsed",s),o=await this._rpcRequest("getTransaction",i),a=L(o,Xr);if("error"in a)throw new W(a.error,"failed to get transaction");return a.result}async getParsedTransactions(e,t){const{commitment:r,config:s}=pe(t),i=e.map(c=>({methodName:"getTransaction",args:this._buildArgsAtLeastConfirmed([c],r,"jsonParsed",s)}));return(await this._rpcBatchRequest(i)).map(c=>{const l=L(c,Xr);if("error"in l)throw new W(l.error,"failed to get transactions");return l.result})}async getTransactions(e,t){const{commitment:r,config:s}=pe(t),i=e.map(c=>({methodName:"getTransaction",args:this._buildArgsAtLeastConfirmed([c],r,void 0,s)}));return(await this._rpcBatchRequest(i)).map(c=>{const l=L(c,os);if("error"in l)throw new W(l.error,"failed to get transactions");const u=l.result;return u&&{...u,transaction:{...u.transaction,message:is(u.version,u.transaction.message)}}})}async getConfirmedBlock(e,t){const r=this._buildArgsAtLeastConfirmed([e],t),s=await this._rpcRequest("getConfirmedBlock",r),i=L(s,dh);if("error"in i)throw new W(i.error,"failed to get confirmed block");const o=i.result;if(!o)throw new Error("Confirmed block "+e+" not found");const a={...o,transactions:o.transactions.map(({transaction:c,meta:l})=>{const u=new ct(c.message);return{meta:l,transaction:{...c,message:u}}})};return{...a,transactions:a.transactions.map(({transaction:c,meta:l})=>({meta:l,transaction:oe.populate(c.message,c.signatures)}))}}async getBlocks(e,t,r){const s=this._buildArgsAtLeastConfirmed(t!==void 0?[e,t]:[e],r),i=await this._rpcRequest("getBlocks",s),o=L(i,Z(z(m())));if("error"in o)throw new W(o.error,"failed to get blocks");return o.result}async getBlockSignatures(e,t){const r=this._buildArgsAtLeastConfirmed([e],t,void 0,{transactionDetails:"signatures",rewards:!1}),s=await this._rpcRequest("getBlock",r),i=L(s,to);if("error"in i)throw new W(i.error,"failed to get block");const o=i.result;if(!o)throw new Error("Block "+e+" not found");return o}async getConfirmedBlockSignatures(e,t){const r=this._buildArgsAtLeastConfirmed([e],t,void 0,{transactionDetails:"signatures",rewards:!1}),s=await this._rpcRequest("getConfirmedBlock",r),i=L(s,to);if("error"in i)throw new W(i.error,"failed to get confirmed block");const o=i.result;if(!o)throw new Error("Confirmed block "+e+" not found");return o}async getConfirmedTransaction(e,t){const r=this._buildArgsAtLeastConfirmed([e],t),s=await this._rpcRequest("getConfirmedTransaction",r),i=L(s,os);if("error"in i)throw new W(i.error,"failed to get transaction");const o=i.result;if(!o)return o;const a=new ct(o.transaction.message),c=o.transaction.signatures;return{...o,transaction:oe.populate(a,c)}}async getParsedConfirmedTransaction(e,t){const r=this._buildArgsAtLeastConfirmed([e],t,"jsonParsed"),s=await this._rpcRequest("getConfirmedTransaction",r),i=L(s,Xr);if("error"in i)throw new W(i.error,"failed to get confirmed transaction");return i.result}async getParsedConfirmedTransactions(e,t){const r=e.map(o=>({methodName:"getConfirmedTransaction",args:this._buildArgsAtLeastConfirmed([o],t,"jsonParsed")}));return(await this._rpcBatchRequest(r)).map(o=>{const a=L(o,Xr);if("error"in a)throw new W(a.error,"failed to get confirmed transactions");return a.result})}async getConfirmedSignaturesForAddress(e,t,r){let s={},i=await this.getFirstAvailableBlock();for(;!("until"in s)&&(t--,!(t<=0||t<i));)try{const c=await this.getConfirmedBlockSignatures(t,"finalized");c.signatures.length>0&&(s.until=c.signatures[c.signatures.length-1].toString())}catch(c){if(c instanceof Error&&c.message.includes("skipped"))continue;throw c}let o=await this.getSlot("finalized");for(;!("before"in s)&&(r++,!(r>o));)try{const c=await this.getConfirmedBlockSignatures(r);c.signatures.length>0&&(s.before=c.signatures[c.signatures.length-1].toString())}catch(c){if(c instanceof Error&&c.message.includes("skipped"))continue;throw c}return(await this.getConfirmedSignaturesForAddress2(e,s)).map(c=>c.signature)}async getConfirmedSignaturesForAddress2(e,t,r){const s=this._buildArgsAtLeastConfirmed([e.toBase58()],r,void 0,t),i=await this._rpcRequest("getConfirmedSignaturesForAddress2",s),o=L(i,Dd);if("error"in o)throw new W(o.error,"failed to get confirmed signatures for address");return o.result}async getSignaturesForAddress(e,t,r){const s=this._buildArgsAtLeastConfirmed([e.toBase58()],r,void 0,t),i=await this._rpcRequest("getSignaturesForAddress",s),o=L(i,Md);if("error"in o)throw new W(o.error,"failed to get signatures for address");return o.result}async getAddressLookupTable(e,t){const{context:r,value:s}=await this.getAccountInfoAndContext(e,t);let i=null;return s!==null&&(i=new gs({key:e,state:gs.deserialize(s.data)})),{context:r,value:i}}async getNonceAndContext(e,t){const{context:r,value:s}=await this.getAccountInfoAndContext(e,t);let i=null;return s!==null&&(i=Sn.fromAccountData(s.data)),{context:r,value:i}}async getNonce(e,t){return await this.getNonceAndContext(e,t).then(r=>r.value).catch(r=>{throw new Error("failed to get nonce for account "+e.toBase58()+": "+r)})}async requestAirdrop(e,t){const r=await this._rpcRequest("requestAirdrop",[e.toBase58(),t]),s=L(r,bh);if("error"in s)throw new W(s.error,`airdrop to ${e.toBase58()} failed`);return s.result}async _blockhashWithExpiryBlockHeight(e){if(!e){for(;this._pollingBlockhash;)await Ht(100);const r=Date.now()-this._blockhashInfo.lastFetch>=ka;if(this._blockhashInfo.latestBlockhash!==null&&!r)return this._blockhashInfo.latestBlockhash}return await this._pollNewBlockhash()}async _pollNewBlockhash(){this._pollingBlockhash=!0;try{const e=Date.now(),t=this._blockhashInfo.latestBlockhash,r=t?t.blockhash:null;for(let s=0;s<50;s++){const i=await this.getLatestBlockhash("finalized");if(r!==i.blockhash)return this._blockhashInfo={latestBlockhash:i,lastFetch:Date.now(),transactionSignatures:[],simulatedSignatures:[]},i;await Ht(ya/2)}throw new Error(`Unable to obtain a new blockhash after ${Date.now()-e}ms`)}finally{this._pollingBlockhash=!1}}async getStakeMinimumDelegation(e){const{commitment:t,config:r}=pe(e),s=this._buildArgs([],t,"base64",r),i=await this._rpcRequest("getStakeMinimumDelegation",s),o=L(i,be(m()));if("error"in o)throw new W(o.error,"failed to get stake minimum delegation");return o.result}async simulateTransaction(e,t,r){if("message"in e){const y=e.serialize(),f=$.Buffer.from(y).toString("base64");if(Array.isArray(t)||r!==void 0)throw new Error("Invalid arguments");const k=t||{};k.encoding="base64","commitment"in k||(k.commitment=this.commitment);const I=[f,k],b=await this._rpcRequest("simulateTransaction",I),_=L(b,Qi);if("error"in _)throw new Error("failed to simulate transaction: "+_.error.message);return _.result}let s;if(e instanceof oe){let p=e;s=new oe,s.feePayer=p.feePayer,s.instructions=e.instructions,s.nonceInfo=p.nonceInfo,s.signatures=p.signatures}else s=oe.populate(e),s._message=s._json=void 0;if(t!==void 0&&!Array.isArray(t))throw new Error("Invalid arguments");const i=t;if(s.nonceInfo&&i)s.sign(...i);else{let p=this._disableBlockhashCaching;for(;;){const y=await this._blockhashWithExpiryBlockHeight(p);if(s.lastValidBlockHeight=y.lastValidBlockHeight,s.recentBlockhash=y.blockhash,!i)break;if(s.sign(...i),!s.signature)throw new Error("!signature");const f=s.signature.toString("base64");if(!this._blockhashInfo.simulatedSignatures.includes(f)&&!this._blockhashInfo.transactionSignatures.includes(f)){this._blockhashInfo.simulatedSignatures.push(f);break}else p=!0}}const o=s._compile(),a=o.serialize(),l=s._serialize(a).toString("base64"),u={encoding:"base64",commitment:this.commitment};if(r){const p=(Array.isArray(r)?r:o.nonProgramIds()).map(y=>y.toBase58());u.accounts={encoding:"base64",addresses:p}}i&&(u.sigVerify=!0);const h=[l,u],g=await this._rpcRequest("simulateTransaction",h),d=L(g,Qi);if("error"in d){let p;if("data"in d.error&&(p=d.error.data.logs,p&&Array.isArray(p))){const y=`
    `,f=y+p.join(y);console.error(d.error.message,f)}throw new ps("failed to simulate transaction: "+d.error.message,p)}return d.result}async sendTransaction(e,t,r){if("version"in e){if(t&&Array.isArray(t))throw new Error("Invalid arguments");const o=e.serialize();return await this.sendRawTransaction(o,t)}if(t===void 0||!Array.isArray(t))throw new Error("Invalid arguments");const s=t;if(e.nonceInfo)e.sign(...s);else{let o=this._disableBlockhashCaching;for(;;){const a=await this._blockhashWithExpiryBlockHeight(o);if(e.lastValidBlockHeight=a.lastValidBlockHeight,e.recentBlockhash=a.blockhash,e.sign(...s),!e.signature)throw new Error("!signature");const c=e.signature.toString("base64");if(this._blockhashInfo.transactionSignatures.includes(c))o=!0;else{this._blockhashInfo.transactionSignatures.push(c);break}}}const i=e.serialize();return await this.sendRawTransaction(i,r)}async sendRawTransaction(e,t){const r=X(e).toString("base64");return await this.sendEncodedTransaction(r,t)}async sendEncodedTransaction(e,t){const r={encoding:"base64"},s=t&&t.skipPreflight,i=t&&t.preflightCommitment||this.commitment;t&&t.maxRetries!=null&&(r.maxRetries=t.maxRetries),t&&t.minContextSlot!=null&&(r.minContextSlot=t.minContextSlot),s&&(r.skipPreflight=s),i&&(r.preflightCommitment=i);const o=[e,r],a=await this._rpcRequest("sendTransaction",o),c=L(a,wh);if("error"in c){let l;throw"data"in c.error&&(l=c.error.data.logs),new ps("failed to send transaction: "+c.error.message,l)}return c.result}_wsOnOpen(){this._rpcWebSocketConnected=!0,this._rpcWebSocketHeartbeat=setInterval(()=>{(async()=>{try{await this._rpcWebSocket.notify("ping")}catch{}})()},5e3),this._updateSubscriptions()}_wsOnError(e){this._rpcWebSocketConnected=!1,console.error("ws error:",e.message)}_wsOnClose(e){if(this._rpcWebSocketConnected=!1,this._rpcWebSocketGeneration=(this._rpcWebSocketGeneration+1)%Number.MAX_SAFE_INTEGER,this._rpcWebSocketIdleTimeout&&(clearTimeout(this._rpcWebSocketIdleTimeout),this._rpcWebSocketIdleTimeout=null),this._rpcWebSocketHeartbeat&&(clearInterval(this._rpcWebSocketHeartbeat),this._rpcWebSocketHeartbeat=null),e===1e3){this._updateSubscriptions();return}this._subscriptionCallbacksByServerSubscriptionId={},Object.entries(this._subscriptionsByHash).forEach(([t,r])=>{this._setSubscription(t,{...r,state:"pending"})})}_setSubscription(e,t){var s;const r=(s=this._subscriptionsByHash[e])==null?void 0:s.state;if(this._subscriptionsByHash[e]=t,r!==t.state){const i=this._subscriptionStateChangeCallbacksByHash[e];i&&i.forEach(o=>{try{o(t.state)}catch{}})}}_onSubscriptionStateChange(e,t){var i;const r=this._subscriptionHashByClientSubscriptionId[e];if(r==null)return()=>{};const s=(i=this._subscriptionStateChangeCallbacksByHash)[r]||(i[r]=new Set);return s.add(t),()=>{s.delete(t),s.size===0&&delete this._subscriptionStateChangeCallbacksByHash[r]}}async _updateSubscriptions(){if(Object.keys(this._subscriptionsByHash).length===0){this._rpcWebSocketConnected&&(this._rpcWebSocketConnected=!1,this._rpcWebSocketIdleTimeout=setTimeout(()=>{this._rpcWebSocketIdleTimeout=null;try{this._rpcWebSocket.close()}catch(r){r instanceof Error&&console.log(`Error when closing socket connection: ${r.message}`)}},500));return}if(this._rpcWebSocketIdleTimeout!==null&&(clearTimeout(this._rpcWebSocketIdleTimeout),this._rpcWebSocketIdleTimeout=null,this._rpcWebSocketConnected=!0),!this._rpcWebSocketConnected){this._rpcWebSocket.connect();return}const e=this._rpcWebSocketGeneration,t=()=>e===this._rpcWebSocketGeneration;await Promise.all(Object.keys(this._subscriptionsByHash).map(async r=>{const s=this._subscriptionsByHash[r];if(s!==void 0)switch(s.state){case"pending":case"unsubscribed":if(s.callbacks.size===0){delete this._subscriptionsByHash[r],s.state==="unsubscribed"&&delete this._subscriptionCallbacksByServerSubscriptionId[s.serverSubscriptionId],await this._updateSubscriptions();return}await(async()=>{const{args:i,method:o}=s;try{this._setSubscription(r,{...s,state:"subscribing"});const a=await this._rpcWebSocket.call(o,i);this._setSubscription(r,{...s,serverSubscriptionId:a,state:"subscribed"}),this._subscriptionCallbacksByServerSubscriptionId[a]=s.callbacks,await this._updateSubscriptions()}catch(a){if(a instanceof Error&&console.error(`${o} error for argument`,i,a.message),!t())return;this._setSubscription(r,{...s,state:"pending"}),await this._updateSubscriptions()}})();break;case"subscribed":s.callbacks.size===0&&await(async()=>{const{serverSubscriptionId:i,unsubscribeMethod:o}=s;if(this._subscriptionsAutoDisposedByRpc.has(i))this._subscriptionsAutoDisposedByRpc.delete(i);else{this._setSubscription(r,{...s,state:"unsubscribing"}),this._setSubscription(r,{...s,state:"unsubscribing"});try{await this._rpcWebSocket.call(o,[i])}catch(a){if(a instanceof Error&&console.error(`${o} error:`,a.message),!t())return;this._setSubscription(r,{...s,state:"subscribed"}),await this._updateSubscriptions();return}}this._setSubscription(r,{...s,state:"unsubscribed"}),await this._updateSubscriptions()})();break}}))}_handleServerNotification(e,t){const r=this._subscriptionCallbacksByServerSubscriptionId[e];r!==void 0&&r.forEach(s=>{try{s(...t)}catch(i){console.error(i)}})}_wsOnAccountNotification(e){const{result:t,subscription:r}=L(e,Wd);this._handleServerNotification(r,[t.value,t.context])}_makeSubscription(e,t){const r=this._nextClientSubscriptionId++,s=Zi([e.method,t],!0),i=this._subscriptionsByHash[s];return i===void 0?this._subscriptionsByHash[s]={...e,args:t,callbacks:new Set([e.callback]),state:"pending"}:i.callbacks.add(e.callback),this._subscriptionHashByClientSubscriptionId[r]=s,this._subscriptionDisposeFunctionsByClientSubscriptionId[r]=async()=>{delete this._subscriptionDisposeFunctionsByClientSubscriptionId[r],delete this._subscriptionHashByClientSubscriptionId[r];const o=this._subscriptionsByHash[s];se(o!==void 0,`Could not find a \`Subscription\` when tearing down client subscription #${r}`),o.callbacks.delete(e.callback),await this._updateSubscriptions()},this._updateSubscriptions(),r}onAccountChange(e,t,r){const s=this._buildArgs([e.toBase58()],r||this._commitment||"finalized","base64");return this._makeSubscription({callback:t,method:"accountSubscribe",unsubscribeMethod:"accountUnsubscribe"},s)}async removeAccountChangeListener(e){await this._unsubscribeClientSubscription(e,"account change")}_wsOnProgramAccountNotification(e){const{result:t,subscription:r}=L(e,jd);this._handleServerNotification(r,[{accountId:t.value.pubkey,accountInfo:t.value.account},t.context])}onProgramAccountChange(e,t,r,s){const i=this._buildArgs([e.toBase58()],r||this._commitment||"finalized","base64",s?{filters:s}:void 0);return this._makeSubscription({callback:t,method:"programSubscribe",unsubscribeMethod:"programUnsubscribe"},i)}async removeProgramAccountChangeListener(e){await this._unsubscribeClientSubscription(e,"program account change")}onLogs(e,t,r){const s=this._buildArgs([typeof e=="object"?{mentions:[e.toString()]}:e],r||this._commitment||"finalized");return this._makeSubscription({callback:t,method:"logsSubscribe",unsubscribeMethod:"logsUnsubscribe"},s)}async removeOnLogsListener(e){await this._unsubscribeClientSubscription(e,"logs")}_wsOnLogsNotification(e){const{result:t,subscription:r}=L(e,kh);this._handleServerNotification(r,[t.value,t.context])}_wsOnSlotNotification(e){const{result:t,subscription:r}=L(e,Vd);this._handleServerNotification(r,[t])}onSlotChange(e){return this._makeSubscription({callback:e,method:"slotSubscribe",unsubscribeMethod:"slotUnsubscribe"},[])}async removeSlotChangeListener(e){await this._unsubscribeClientSubscription(e,"slot change")}_wsOnSlotUpdatesNotification(e){const{result:t,subscription:r}=L(e,Gd);this._handleServerNotification(r,[t])}onSlotUpdate(e){return this._makeSubscription({callback:e,method:"slotsUpdatesSubscribe",unsubscribeMethod:"slotsUpdatesUnsubscribe"},[])}async removeSlotUpdateListener(e){await this._unsubscribeClientSubscription(e,"slot update")}async _unsubscribeClientSubscription(e,t){const r=this._subscriptionDisposeFunctionsByClientSubscriptionId[e];r?await r():console.warn(`Ignored unsubscribe request because an active subscription with id \`${e}\` for '${t}' events could not be found.`)}_buildArgs(e,t,r,s){const i=t||this._commitment;if(i||r||s){let o={};r&&(o.encoding=r),i&&(o.commitment=i),s&&(o=Object.assign(o,s)),e.push(o)}return e}_buildArgsAtLeastConfirmed(e,t,r,s){const i=t||this._commitment;if(i&&!["confirmed","finalized"].includes(i))throw new Error("Using Connection with default commitment: `"+this._commitment+"`, but method requires at least `confirmed`");return this._buildArgs(e,t,r,s)}_wsOnSignatureNotification(e){const{result:t,subscription:r}=L(e,Yd);t.value!=="receivedSignature"&&this._subscriptionsAutoDisposedByRpc.add(r),this._handleServerNotification(r,t.value==="receivedSignature"?[{type:"received"},t.context]:[{type:"status",result:t.value},t.context])}onSignature(e,t,r){const s=this._buildArgs([e],r||this._commitment||"finalized"),i=this._makeSubscription({callback:(o,a)=>{if(o.type==="status"){t(o.result,a);try{this.removeSignatureListener(i)}catch{}}},method:"signatureSubscribe",unsubscribeMethod:"signatureUnsubscribe"},s);return i}onSignatureWithOptions(e,t,r){const{commitment:s,...i}={...r,commitment:r&&r.commitment||this._commitment||"finalized"},o=this._buildArgs([e],s,void 0,i),a=this._makeSubscription({callback:(c,l)=>{t(c,l);try{this.removeSignatureListener(a)}catch{}},method:"signatureSubscribe",unsubscribeMethod:"signatureUnsubscribe"},o);return a}async removeSignatureListener(e){await this._unsubscribeClientSubscription(e,"signature result")}_wsOnRootNotification(e){const{result:t,subscription:r}=L(e,Jd);this._handleServerNotification(r,[t])}onRootChange(e){return this._makeSubscription({callback:e,method:"rootSubscribe",unsubscribeMethod:"rootUnsubscribe"},[])}async removeRootChangeListener(e){await this._unsubscribeClientSubscription(e,"root change")}}class hr{constructor(e){this._keypair=void 0,this._keypair=e??Gi()}static generate(){return new hr(Gi())}static fromSecretKey(e,t){if(e.byteLength!==64)throw new Error("bad secret key size");const r=e.slice(32,64);if(!t||!t.skipValidation){const s=e.slice(0,32),i=cn(s);for(let o=0;o<32;o++)if(r[o]!==i[o])throw new Error("provided secretKey is invalid")}return new hr({publicKey:r,secretKey:e})}static fromSeed(e){const t=cn(e),r=new Uint8Array(64);return r.set(e),r.set(t,32),new hr({publicKey:t,secretKey:r})}get publicKey(){return new O(this._keypair.publicKey)}get secretKey(){return new Uint8Array(this._keypair.secretKey)}}const xt=Object.freeze({CreateLookupTable:{index:0,layout:M([D("instruction"),vr("recentSlot"),re("bumpSeed")])},FreezeLookupTable:{index:1,layout:M([D("instruction")])},ExtendLookupTable:{index:2,layout:M([D("instruction"),vr(),Ce(ee(),Kt(D(),-8),"addresses")])},DeactivateLookupTable:{index:3,layout:M([D("instruction")])},CloseLookupTable:{index:4,layout:M([D("instruction")])}});class Eh{constructor(){}static decodeInstructionType(e){this.checkProgramId(e.programId);const r=D("instruction").decode(e.data);let s;for(const[i,o]of Object.entries(xt))if(o.index==r){s=i;break}if(!s)throw new Error("Invalid Instruction. Should be a LookupTable Instruction");return s}static decodeCreateLookupTable(e){this.checkProgramId(e.programId),this.checkKeysLength(e.keys,4);const{recentSlot:t}=ae(xt.CreateLookupTable,e.data);return{authority:e.keys[1].pubkey,payer:e.keys[2].pubkey,recentSlot:Number(t)}}static decodeExtendLookupTable(e){if(this.checkProgramId(e.programId),e.keys.length<2)throw new Error(`invalid instruction; found ${e.keys.length} keys, expected at least 2`);const{addresses:t}=ae(xt.ExtendLookupTable,e.data);return{lookupTable:e.keys[0].pubkey,authority:e.keys[1].pubkey,payer:e.keys.length>2?e.keys[2].pubkey:void 0,addresses:t.map(r=>new O(r))}}static decodeCloseLookupTable(e){return this.checkProgramId(e.programId),this.checkKeysLength(e.keys,3),{lookupTable:e.keys[0].pubkey,authority:e.keys[1].pubkey,recipient:e.keys[2].pubkey}}static decodeFreezeLookupTable(e){return this.checkProgramId(e.programId),this.checkKeysLength(e.keys,2),{lookupTable:e.keys[0].pubkey,authority:e.keys[1].pubkey}}static decodeDeactivateLookupTable(e){return this.checkProgramId(e.programId),this.checkKeysLength(e.keys,2),{lookupTable:e.keys[0].pubkey,authority:e.keys[1].pubkey}}static checkProgramId(e){if(!e.equals(Qs.programId))throw new Error("invalid instruction; programId is not AddressLookupTable Program")}static checkKeysLength(e,t){if(e.length<t)throw new Error(`invalid instruction; found ${e.length} keys, expected at least ${t}`)}}class Qs{constructor(){}static createLookupTable(e){const[t,r]=O.findProgramAddressSync([e.authority.toBuffer(),Jo(BigInt(e.recentSlot),8)],this.programId),s=xt.CreateLookupTable,i=te(s,{recentSlot:BigInt(e.recentSlot),bumpSeed:r}),o=[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:e.authority,isSigner:!0,isWritable:!1},{pubkey:e.payer,isSigner:!0,isWritable:!0},{pubkey:Ie.programId,isSigner:!1,isWritable:!1}];return[new le({programId:this.programId,keys:o,data:i}),t]}static freezeLookupTable(e){const t=xt.FreezeLookupTable,r=te(t),s=[{pubkey:e.lookupTable,isSigner:!1,isWritable:!0},{pubkey:e.authority,isSigner:!0,isWritable:!1}];return new le({programId:this.programId,keys:s,data:r})}static extendLookupTable(e){const t=xt.ExtendLookupTable,r=te(t,{addresses:e.addresses.map(i=>i.toBytes())}),s=[{pubkey:e.lookupTable,isSigner:!1,isWritable:!0},{pubkey:e.authority,isSigner:!0,isWritable:!1}];return e.payer&&s.push({pubkey:e.payer,isSigner:!0,isWritable:!0},{pubkey:Ie.programId,isSigner:!1,isWritable:!1}),new le({programId:this.programId,keys:s,data:r})}static deactivateLookupTable(e){const t=xt.DeactivateLookupTable,r=te(t),s=[{pubkey:e.lookupTable,isSigner:!1,isWritable:!0},{pubkey:e.authority,isSigner:!0,isWritable:!1}];return new le({programId:this.programId,keys:s,data:r})}static closeLookupTable(e){const t=xt.CloseLookupTable,r=te(t),s=[{pubkey:e.lookupTable,isSigner:!1,isWritable:!0},{pubkey:e.authority,isSigner:!0,isWritable:!1},{pubkey:e.recipient,isSigner:!1,isWritable:!0}];return new le({programId:this.programId,keys:s,data:r})}}Qs.programId=new O("AddressLookupTab1e1111111111111111111111111");class Ih{constructor(){}static decodeInstructionType(e){this.checkProgramId(e.programId);const r=re("instruction").decode(e.data);let s;for(const[i,o]of Object.entries(dt))if(o.index==r){s=i;break}if(!s)throw new Error("Instruction type incorrect; not a ComputeBudgetInstruction");return s}static decodeRequestUnits(e){this.checkProgramId(e.programId);const{units:t,additionalFee:r}=ae(dt.RequestUnits,e.data);return{units:t,additionalFee:r}}static decodeRequestHeapFrame(e){this.checkProgramId(e.programId);const{bytes:t}=ae(dt.RequestHeapFrame,e.data);return{bytes:t}}static decodeSetComputeUnitLimit(e){this.checkProgramId(e.programId);const{units:t}=ae(dt.SetComputeUnitLimit,e.data);return{units:t}}static decodeSetComputeUnitPrice(e){this.checkProgramId(e.programId);const{microLamports:t}=ae(dt.SetComputeUnitPrice,e.data);return{microLamports:t}}static checkProgramId(e){if(!e.equals(ei.programId))throw new Error("invalid instruction; programId is not ComputeBudgetProgram")}}const dt=Object.freeze({RequestUnits:{index:0,layout:M([re("instruction"),D("units"),D("additionalFee")])},RequestHeapFrame:{index:1,layout:M([re("instruction"),D("bytes")])},SetComputeUnitLimit:{index:2,layout:M([re("instruction"),D("units")])},SetComputeUnitPrice:{index:3,layout:M([re("instruction"),vr("microLamports")])}});class ei{constructor(){}static requestUnits(e){const t=dt.RequestUnits,r=te(t,e);return new le({keys:[],programId:this.programId,data:r})}static requestHeapFrame(e){const t=dt.RequestHeapFrame,r=te(t,e);return new le({keys:[],programId:this.programId,data:r})}static setComputeUnitLimit(e){const t=dt.SetComputeUnitLimit,r=te(t,e);return new le({keys:[],programId:this.programId,data:r})}static setComputeUnitPrice(e){const t=dt.SetComputeUnitPrice,r=te(t,{microLamports:BigInt(e.microLamports)});return new le({keys:[],programId:this.programId,data:r})}}ei.programId=new O("ComputeBudget111111111111111111111111111111");const ro=64,no=32,so=64,io=M([re("numSignatures"),re("padding"),nt("signatureOffset"),nt("signatureInstructionIndex"),nt("publicKeyOffset"),nt("publicKeyInstructionIndex"),nt("messageDataOffset"),nt("messageDataSize"),nt("messageInstructionIndex")]);class In{constructor(){}static createInstructionWithPublicKey(e){const{publicKey:t,message:r,signature:s,instructionIndex:i}=e;se(t.length===no,`Public Key must be ${no} bytes but received ${t.length} bytes`),se(s.length===so,`Signature must be ${so} bytes but received ${s.length} bytes`);const o=io.span,a=o+t.length,c=a+s.length,l=1,u=$.Buffer.alloc(c+r.length),h=i??65535;return io.encode({numSignatures:l,padding:0,signatureOffset:a,signatureInstructionIndex:h,publicKeyOffset:o,publicKeyInstructionIndex:h,messageDataOffset:c,messageDataSize:r.length,messageInstructionIndex:h},u),u.fill(t,o),u.fill(s,a),u.fill(r,c),new le({keys:[],programId:In.programId,data:u})}static createInstructionWithPrivateKey(e){const{privateKey:t,message:r,instructionIndex:s}=e;se(t.length===ro,`Private key must be ${ro} bytes but received ${t.length} bytes`);try{const i=hr.fromSecretKey(t),o=i.publicKey.toBytes(),a=qs(r,i.secretKey);return this.createInstructionWithPublicKey({publicKey:o,message:r,signature:a,instructionIndex:s})}catch(i){throw new Error(`Error creating instruction; ${i}`)}}}In.programId=new O("Ed25519SigVerify111111111111111111111111111");const Ah=(n,e)=>{const t=Es.sign(n,e);return[t.toCompactRawBytes(),t.recovery]};Es.utils.isValidPrivateKey;const xh=Es.getPublicKey,oo=32,as=20,ao=64,Rh=11,cs=M([re("numSignatures"),nt("signatureOffset"),re("signatureInstructionIndex"),nt("ethAddressOffset"),re("ethAddressInstructionIndex"),nt("messageDataOffset"),nt("messageDataSize"),re("messageInstructionIndex"),he(20,"ethAddress"),he(64,"signature"),re("recoveryId")]);class fr{constructor(){}static publicKeyToEthAddress(e){se(e.length===ao,`Public key must be ${ao} bytes but received ${e.length} bytes`);try{return $.Buffer.from(xi(X(e))).slice(-as)}catch(t){throw new Error(`Error constructing Ethereum address: ${t}`)}}static createInstructionWithPublicKey(e){const{publicKey:t,message:r,signature:s,recoveryId:i,instructionIndex:o}=e;return fr.createInstructionWithEthAddress({ethAddress:fr.publicKeyToEthAddress(t),message:r,signature:s,recoveryId:i,instructionIndex:o})}static createInstructionWithEthAddress(e){const{ethAddress:t,message:r,signature:s,recoveryId:i,instructionIndex:o=0}=e;let a;typeof t=="string"?t.startsWith("0x")?a=$.Buffer.from(t.substr(2),"hex"):a=$.Buffer.from(t,"hex"):a=t,se(a.length===as,`Address must be ${as} bytes but received ${a.length} bytes`);const c=1+Rh,l=c,u=c+a.length,h=u+s.length+1,g=1,d=$.Buffer.alloc(cs.span+r.length);return cs.encode({numSignatures:g,signatureOffset:u,signatureInstructionIndex:o,ethAddressOffset:l,ethAddressInstructionIndex:o,messageDataOffset:h,messageDataSize:r.length,messageInstructionIndex:o,signature:X(s),ethAddress:X(a),recoveryId:i},d),d.fill(X(r),cs.span),new le({keys:[],programId:fr.programId,data:d})}static createInstructionWithPrivateKey(e){const{privateKey:t,message:r,instructionIndex:s}=e;se(t.length===oo,`Private key must be ${oo} bytes but received ${t.length} bytes`);try{const i=X(t),o=xh(i,!1).slice(1),a=$.Buffer.from(xi(X(r))),[c,l]=Ah(a,i);return this.createInstructionWithPublicKey({publicKey:o,message:r,signature:c,recoveryId:l,instructionIndex:s})}catch(i){throw new Error(`Error creating instruction; ${i}`)}}}fr.programId=new O("KeccakSecp256k11111111111111111111111111111");var Ta;const Ca=new O("StakeConfig11111111111111111111111111111111");class Oa{constructor(e,t){this.staker=void 0,this.withdrawer=void 0,this.staker=e,this.withdrawer=t}}class qr{constructor(e,t,r){this.unixTimestamp=void 0,this.epoch=void 0,this.custodian=void 0,this.unixTimestamp=e,this.epoch=t,this.custodian=r}}Ta=qr;qr.default=new Ta(0,0,O.default);class Ph{constructor(){}static decodeInstructionType(e){this.checkProgramId(e.programId);const r=D("instruction").decode(e.data);let s;for(const[i,o]of Object.entries(Ee))if(o.index==r){s=i;break}if(!s)throw new Error("Instruction type incorrect; not a StakeInstruction");return s}static decodeInitialize(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,2);const{authorized:t,lockup:r}=ae(Ee.Initialize,e.data);return{stakePubkey:e.keys[0].pubkey,authorized:new Oa(new O(t.staker),new O(t.withdrawer)),lockup:new qr(r.unixTimestamp,r.epoch,new O(r.custodian))}}static decodeDelegate(e){return this.checkProgramId(e.programId),this.checkKeyLength(e.keys,6),ae(Ee.Delegate,e.data),{stakePubkey:e.keys[0].pubkey,votePubkey:e.keys[1].pubkey,authorizedPubkey:e.keys[5].pubkey}}static decodeAuthorize(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,3);const{newAuthorized:t,stakeAuthorizationType:r}=ae(Ee.Authorize,e.data),s={stakePubkey:e.keys[0].pubkey,authorizedPubkey:e.keys[2].pubkey,newAuthorizedPubkey:new O(t),stakeAuthorizationType:{index:r}};return e.keys.length>3&&(s.custodianPubkey=e.keys[3].pubkey),s}static decodeAuthorizeWithSeed(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,2);const{newAuthorized:t,stakeAuthorizationType:r,authoritySeed:s,authorityOwner:i}=ae(Ee.AuthorizeWithSeed,e.data),o={stakePubkey:e.keys[0].pubkey,authorityBase:e.keys[1].pubkey,authoritySeed:s,authorityOwner:new O(i),newAuthorizedPubkey:new O(t),stakeAuthorizationType:{index:r}};return e.keys.length>3&&(o.custodianPubkey=e.keys[3].pubkey),o}static decodeSplit(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,3);const{lamports:t}=ae(Ee.Split,e.data);return{stakePubkey:e.keys[0].pubkey,splitStakePubkey:e.keys[1].pubkey,authorizedPubkey:e.keys[2].pubkey,lamports:t}}static decodeMerge(e){return this.checkProgramId(e.programId),this.checkKeyLength(e.keys,3),ae(Ee.Merge,e.data),{stakePubkey:e.keys[0].pubkey,sourceStakePubKey:e.keys[1].pubkey,authorizedPubkey:e.keys[4].pubkey}}static decodeWithdraw(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,5);const{lamports:t}=ae(Ee.Withdraw,e.data),r={stakePubkey:e.keys[0].pubkey,toPubkey:e.keys[1].pubkey,authorizedPubkey:e.keys[4].pubkey,lamports:t};return e.keys.length>5&&(r.custodianPubkey=e.keys[5].pubkey),r}static decodeDeactivate(e){return this.checkProgramId(e.programId),this.checkKeyLength(e.keys,3),ae(Ee.Deactivate,e.data),{stakePubkey:e.keys[0].pubkey,authorizedPubkey:e.keys[2].pubkey}}static checkProgramId(e){if(!e.equals(An.programId))throw new Error("invalid instruction; programId is not StakeProgram")}static checkKeyLength(e,t){if(e.length<t)throw new Error(`invalid instruction; found ${e.length} keys, expected at least ${t}`)}}const Ee=Object.freeze({Initialize:{index:0,layout:M([D("instruction"),Tl(),Cl()])},Authorize:{index:1,layout:M([D("instruction"),ee("newAuthorized"),D("stakeAuthorizationType")])},Delegate:{index:2,layout:M([D("instruction")])},Split:{index:3,layout:M([D("instruction"),Je("lamports")])},Withdraw:{index:4,layout:M([D("instruction"),Je("lamports")])},Deactivate:{index:5,layout:M([D("instruction")])},Merge:{index:7,layout:M([D("instruction")])},AuthorizeWithSeed:{index:8,layout:M([D("instruction"),ee("newAuthorized"),D("stakeAuthorizationType"),Yt("authoritySeed"),ee("authorityOwner")])}}),Bh=Object.freeze({Staker:{index:0},Withdrawer:{index:1}});class An{constructor(){}static initialize(e){const{stakePubkey:t,authorized:r,lockup:s}=e,i=s||qr.default,o=Ee.Initialize,a=te(o,{authorized:{staker:X(r.staker.toBuffer()),withdrawer:X(r.withdrawer.toBuffer())},lockup:{unixTimestamp:i.unixTimestamp,epoch:i.epoch,custodian:X(i.custodian.toBuffer())}}),c={keys:[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:wr,isSigner:!1,isWritable:!1}],programId:this.programId,data:a};return new le(c)}static createAccountWithSeed(e){const t=new oe;t.add(Ie.createAccountWithSeed({fromPubkey:e.fromPubkey,newAccountPubkey:e.stakePubkey,basePubkey:e.basePubkey,seed:e.seed,lamports:e.lamports,space:this.space,programId:this.programId}));const{stakePubkey:r,authorized:s,lockup:i}=e;return t.add(this.initialize({stakePubkey:r,authorized:s,lockup:i}))}static createAccount(e){const t=new oe;t.add(Ie.createAccount({fromPubkey:e.fromPubkey,newAccountPubkey:e.stakePubkey,lamports:e.lamports,space:this.space,programId:this.programId}));const{stakePubkey:r,authorized:s,lockup:i}=e;return t.add(this.initialize({stakePubkey:r,authorized:s,lockup:i}))}static delegate(e){const{stakePubkey:t,authorizedPubkey:r,votePubkey:s}=e,i=Ee.Delegate,o=te(i);return new oe().add({keys:[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:en,isSigner:!1,isWritable:!1},{pubkey:Ca,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1}],programId:this.programId,data:o})}static authorize(e){const{stakePubkey:t,authorizedPubkey:r,newAuthorizedPubkey:s,stakeAuthorizationType:i,custodianPubkey:o}=e,a=Ee.Authorize,c=te(a,{newAuthorized:X(s.toBuffer()),stakeAuthorizationType:i.index}),l=[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:lt,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!1}];return o&&l.push({pubkey:o,isSigner:!0,isWritable:!1}),new oe().add({keys:l,programId:this.programId,data:c})}static authorizeWithSeed(e){const{stakePubkey:t,authorityBase:r,authoritySeed:s,authorityOwner:i,newAuthorizedPubkey:o,stakeAuthorizationType:a,custodianPubkey:c}=e,l=Ee.AuthorizeWithSeed,u=te(l,{newAuthorized:X(o.toBuffer()),stakeAuthorizationType:a.index,authoritySeed:s,authorityOwner:X(i.toBuffer())}),h=[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1}];return c&&h.push({pubkey:c,isSigner:!0,isWritable:!1}),new oe().add({keys:h,programId:this.programId,data:u})}static splitInstruction(e){const{stakePubkey:t,authorizedPubkey:r,splitStakePubkey:s,lamports:i}=e,o=Ee.Split,a=te(o,{lamports:i});return new le({keys:[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!1}],programId:this.programId,data:a})}static split(e,t){const r=new oe;return r.add(Ie.createAccount({fromPubkey:e.authorizedPubkey,newAccountPubkey:e.splitStakePubkey,lamports:t,space:this.space,programId:this.programId})),r.add(this.splitInstruction(e))}static splitWithSeed(e,t){const{stakePubkey:r,authorizedPubkey:s,splitStakePubkey:i,basePubkey:o,seed:a,lamports:c}=e,l=new oe;return l.add(Ie.allocate({accountPubkey:i,basePubkey:o,seed:a,space:this.space,programId:this.programId})),t&&t>0&&l.add(Ie.transfer({fromPubkey:e.authorizedPubkey,toPubkey:i,lamports:t})),l.add(this.splitInstruction({stakePubkey:r,authorizedPubkey:s,splitStakePubkey:i,lamports:c}))}static merge(e){const{stakePubkey:t,sourceStakePubKey:r,authorizedPubkey:s}=e,i=Ee.Merge,o=te(i);return new oe().add({keys:[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:en,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!0,isWritable:!1}],programId:this.programId,data:o})}static withdraw(e){const{stakePubkey:t,authorizedPubkey:r,toPubkey:s,lamports:i,custodianPubkey:o}=e,a=Ee.Withdraw,c=te(a,{lamports:i}),l=[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:en,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1}];return o&&l.push({pubkey:o,isSigner:!0,isWritable:!1}),new oe().add({keys:l,programId:this.programId,data:c})}static deactivate(e){const{stakePubkey:t,authorizedPubkey:r}=e,s=Ee.Deactivate,i=te(s);return new oe().add({keys:[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1}],programId:this.programId,data:i})}}An.programId=new O("Stake11111111111111111111111111111111111111");An.space=200;class La{constructor(e,t,r,s){this.nodePubkey=void 0,this.authorizedVoter=void 0,this.authorizedWithdrawer=void 0,this.commission=void 0,this.nodePubkey=e,this.authorizedVoter=t,this.authorizedWithdrawer=r,this.commission=s}}class Th{constructor(){}static decodeInstructionType(e){this.checkProgramId(e.programId);const r=D("instruction").decode(e.data);let s;for(const[i,o]of Object.entries(ht))if(o.index==r){s=i;break}if(!s)throw new Error("Instruction type incorrect; not a VoteInstruction");return s}static decodeInitializeAccount(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,4);const{voteInit:t}=ae(ht.InitializeAccount,e.data);return{votePubkey:e.keys[0].pubkey,nodePubkey:e.keys[3].pubkey,voteInit:new La(new O(t.nodePubkey),new O(t.authorizedVoter),new O(t.authorizedWithdrawer),t.commission)}}static decodeAuthorize(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,3);const{newAuthorized:t,voteAuthorizationType:r}=ae(ht.Authorize,e.data);return{votePubkey:e.keys[0].pubkey,authorizedPubkey:e.keys[2].pubkey,newAuthorizedPubkey:new O(t),voteAuthorizationType:{index:r}}}static decodeAuthorizeWithSeed(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,3);const{voteAuthorizeWithSeedArgs:{currentAuthorityDerivedKeyOwnerPubkey:t,currentAuthorityDerivedKeySeed:r,newAuthorized:s,voteAuthorizationType:i}}=ae(ht.AuthorizeWithSeed,e.data);return{currentAuthorityDerivedKeyBasePubkey:e.keys[2].pubkey,currentAuthorityDerivedKeyOwnerPubkey:new O(t),currentAuthorityDerivedKeySeed:r,newAuthorizedPubkey:new O(s),voteAuthorizationType:{index:i},votePubkey:e.keys[0].pubkey}}static decodeWithdraw(e){this.checkProgramId(e.programId),this.checkKeyLength(e.keys,3);const{lamports:t}=ae(ht.Withdraw,e.data);return{votePubkey:e.keys[0].pubkey,authorizedWithdrawerPubkey:e.keys[2].pubkey,lamports:t,toPubkey:e.keys[1].pubkey}}static checkProgramId(e){if(!e.equals(Ar.programId))throw new Error("invalid instruction; programId is not VoteProgram")}static checkKeyLength(e,t){if(e.length<t)throw new Error(`invalid instruction; found ${e.length} keys, expected at least ${t}`)}}const ht=Object.freeze({InitializeAccount:{index:0,layout:M([D("instruction"),Ol()])},Authorize:{index:1,layout:M([D("instruction"),ee("newAuthorized"),D("voteAuthorizationType")])},Withdraw:{index:3,layout:M([D("instruction"),Je("lamports")])},UpdateValidatorIdentity:{index:4,layout:M([D("instruction")])},AuthorizeWithSeed:{index:10,layout:M([D("instruction"),Ll()])}}),Ch=Object.freeze({Voter:{index:0},Withdrawer:{index:1}});class Ar{constructor(){}static initializeAccount(e){const{votePubkey:t,nodePubkey:r,voteInit:s}=e,i=ht.InitializeAccount,o=te(i,{voteInit:{nodePubkey:X(s.nodePubkey.toBuffer()),authorizedVoter:X(s.authorizedVoter.toBuffer()),authorizedWithdrawer:X(s.authorizedWithdrawer.toBuffer()),commission:s.commission}}),a={keys:[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:wr,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1}],programId:this.programId,data:o};return new le(a)}static createAccount(e){const t=new oe;return t.add(Ie.createAccount({fromPubkey:e.fromPubkey,newAccountPubkey:e.votePubkey,lamports:e.lamports,space:this.space,programId:this.programId})),t.add(this.initializeAccount({votePubkey:e.votePubkey,nodePubkey:e.voteInit.nodePubkey,voteInit:e.voteInit}))}static authorize(e){const{votePubkey:t,authorizedPubkey:r,newAuthorizedPubkey:s,voteAuthorizationType:i}=e,o=ht.Authorize,a=te(o,{newAuthorized:X(s.toBuffer()),voteAuthorizationType:i.index}),c=[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1}];return new oe().add({keys:c,programId:this.programId,data:a})}static authorizeWithSeed(e){const{currentAuthorityDerivedKeyBasePubkey:t,currentAuthorityDerivedKeyOwnerPubkey:r,currentAuthorityDerivedKeySeed:s,newAuthorizedPubkey:i,voteAuthorizationType:o,votePubkey:a}=e,c=ht.AuthorizeWithSeed,l=te(c,{voteAuthorizeWithSeedArgs:{currentAuthorityDerivedKeyOwnerPubkey:X(r.toBuffer()),currentAuthorityDerivedKeySeed:s,newAuthorized:X(i.toBuffer()),voteAuthorizationType:o.index}}),u=[{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!0,isWritable:!1}];return new oe().add({keys:u,programId:this.programId,data:l})}static withdraw(e){const{votePubkey:t,authorizedWithdrawerPubkey:r,lamports:s,toPubkey:i}=e,o=ht.Withdraw,a=te(o,{lamports:s}),c=[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!1}];return new oe().add({keys:c,programId:this.programId,data:a})}static safeWithdraw(e,t,r){if(e.lamports>t-r)throw new Error("Withdraw will leave vote account with insufficient funds.");return Ar.withdraw(e)}static updateValidatorIdentity(e){const{votePubkey:t,authorizedWithdrawerPubkey:r,nodePubkey:s}=e,i=ht.UpdateValidatorIdentity,o=te(i),a=[{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1}];return new oe().add({keys:a,programId:this.programId,data:o})}}Ar.programId=new O("Vote111111111111111111111111111111111111111");Ar.space=3762;const Na=new O("Va1idator1nfo111111111111111111111111111111"),Oh=P({name:C(),website:V(C()),details:V(C()),keybaseUsername:V(C())});class ti{constructor(e,t){this.key=void 0,this.info=void 0,this.key=e,this.info=t}static fromConfigData(e){let t=[...e];if(je(t)!==2)return null;const s=[];for(let i=0;i<2;i++){const o=new O(t.slice(0,Xe));t=t.slice(Xe);const a=t.slice(0,1)[0]===1;t=t.slice(1),s.push({publicKey:o,isSigner:a})}if(s[0].publicKey.equals(Na)&&s[1].isSigner){const i=Yt().decode($.Buffer.from(t)),o=JSON.parse(i);return Zo(o,Oh),new ti(s[1].publicKey,o)}return null}}const Lh=new O("Vote111111111111111111111111111111111111111"),Nh=M([ee("nodePubkey"),ee("authorizedWithdrawer"),re("commission"),Pe(),Ce(M([Pe("slot"),D("confirmationCount")]),Kt(D(),-8),"votes"),re("rootSlotValid"),Pe("rootSlot"),Pe(),Ce(M([Pe("epoch"),ee("authorizedVoter")]),Kt(D(),-8),"authorizedVoters"),M([Ce(M([ee("authorizedPubkey"),Pe("epochOfLastAuthorizedSwitch"),Pe("targetEpoch")]),32,"buf"),Pe("idx"),re("isEmpty")],"priorVoters"),Pe(),Ce(M([Pe("epoch"),Pe("credits"),Pe("prevCredits")]),Kt(D(),-8),"epochCredits"),M([Pe("slot"),Pe("timestamp")],"lastTimestamp")]);class ri{constructor(e){this.nodePubkey=void 0,this.authorizedWithdrawer=void 0,this.commission=void 0,this.rootSlot=void 0,this.votes=void 0,this.authorizedVoters=void 0,this.priorVoters=void 0,this.epochCredits=void 0,this.lastTimestamp=void 0,this.nodePubkey=e.nodePubkey,this.authorizedWithdrawer=e.authorizedWithdrawer,this.commission=e.commission,this.rootSlot=e.rootSlot,this.votes=e.votes,this.authorizedVoters=e.authorizedVoters,this.priorVoters=e.priorVoters,this.epochCredits=e.epochCredits,this.lastTimestamp=e.lastTimestamp}static fromAccountData(e){const r=Nh.decode(X(e),4);let s=r.rootSlot;return r.rootSlotValid||(s=null),new ri({nodePubkey:new O(r.nodePubkey),authorizedWithdrawer:new O(r.authorizedWithdrawer),commission:r.commission,votes:r.votes,rootSlot:s,authorizedVoters:r.authorizedVoters.map(Uh),priorVoters:Fh(r.priorVoters),epochCredits:r.epochCredits,lastTimestamp:r.lastTimestamp})}}function Uh({authorizedVoter:n,epoch:e}){return{epoch:e,authorizedVoter:new O(n)}}function co({authorizedPubkey:n,epochOfLastAuthorizedSwitch:e,targetEpoch:t}){return{authorizedPubkey:new O(n),epochOfLastAuthorizedSwitch:e,targetEpoch:t}}function Fh({buf:n,idx:e,isEmpty:t}){return t?[]:[...n.slice(e+1).map(co),...n.slice(0,e).map(co)]}const uo={http:{devnet:"http://api.devnet.solana.com",testnet:"http://api.testnet.solana.com","mainnet-beta":"http://api.mainnet-beta.solana.com/"},https:{devnet:"https://api.devnet.solana.com",testnet:"https://api.testnet.solana.com","mainnet-beta":"https://api.mainnet-beta.solana.com/"}};function Kh(n,e){const t=e===!1?"http":"https";if(!n)return uo[t].devnet;const r=uo[t][n];if(!r)throw new Error(`Unknown ${t} cluster: ${n}`);return r}async function zh(n,e,t,r){let s,i;t&&Object.prototype.hasOwnProperty.call(t,"lastValidBlockHeight")||t&&Object.prototype.hasOwnProperty.call(t,"nonceValue")?(s=t,i=r):i=t;const o=i&&{skipPreflight:i.skipPreflight,preflightCommitment:i.preflightCommitment||i.commitment,minContextSlot:i.minContextSlot},a=await n.sendRawTransaction(e,o),c=i&&i.commitment,u=(await(s?n.confirmTransaction(s,c):n.confirmTransaction(a,c))).value;if(u.err)throw new Error(`Raw transaction ${a} failed (${JSON.stringify(u)})`);return a}const Dh=1e9,Mh=Object.freeze(Object.defineProperty({__proto__:null,Account:Rl,AddressLookupTableAccount:gs,AddressLookupTableInstruction:Eh,AddressLookupTableProgram:Qs,Authorized:Oa,BLOCKHASH_CACHE_TIMEOUT_MS:ka,BPF_LOADER_DEPRECATED_PROGRAM_ID:Pl,BPF_LOADER_PROGRAM_ID:Gl,BpfLoader:Yl,COMPUTE_BUDGET_INSTRUCTION_LAYOUTS:dt,ComputeBudgetInstruction:Ih,ComputeBudgetProgram:ei,Connection:_h,Ed25519Program:In,Enum:Al,EpochSchedule:wa,FeeCalculatorLayout:ma,Keypair:hr,LAMPORTS_PER_SOL:Dh,LOOKUP_TABLE_INSTRUCTION_LAYOUTS:xt,Loader:rr,Lockup:qr,MAX_SEED_LENGTH:pa,Message:ct,MessageAccountKeys:Cr,MessageV0:tr,NONCE_ACCOUNT_LENGTH:fs,NonceAccount:Sn,PACKET_DATA_SIZE:Dt,PUBLIC_KEY_LENGTH:Xe,PublicKey:O,SIGNATURE_LENGTH_IN_BYTES:br,SOLANA_SCHEMA:Br,STAKE_CONFIG_ID:Ca,STAKE_INSTRUCTION_LAYOUTS:Ee,SYSTEM_INSTRUCTION_LAYOUTS:de,SYSVAR_CLOCK_PUBKEY:lt,SYSVAR_EPOCH_SCHEDULE_PUBKEY:zl,SYSVAR_INSTRUCTIONS_PUBKEY:Dl,SYSVAR_RECENT_BLOCKHASHES_PUBKEY:Qr,SYSVAR_RENT_PUBKEY:wr,SYSVAR_REWARDS_PUBKEY:Ml,SYSVAR_SLOT_HASHES_PUBKEY:Wl,SYSVAR_SLOT_HISTORY_PUBKEY:ql,SYSVAR_STAKE_HISTORY_PUBKEY:en,Secp256k1Program:fr,SendTransactionError:ps,SolanaJSONRPCError:W,SolanaJSONRPCErrorCode:td,StakeAuthorizationLayout:Bh,StakeInstruction:Ph,StakeProgram:An,Struct:js,SystemInstruction:Vl,SystemProgram:Ie,Transaction:oe,TransactionExpiredBlockheightExceededError:$s,TransactionExpiredNonceInvalidError:dr,TransactionExpiredTimeoutError:Vs,TransactionInstruction:le,TransactionMessage:Gs,TransactionStatus:Et,VALIDATOR_INFO_KEY:Na,VERSION_PREFIX_MASK:vn,VOTE_PROGRAM_ID:Lh,ValidatorInfo:ti,VersionedMessage:Hs,VersionedTransaction:Ys,VoteAccount:ri,VoteAuthorizationLayout:Ch,VoteInit:La,VoteInstruction:Th,VoteProgram:Ar,clusterApiUrl:Kh,sendAndConfirmRawTransaction:zh,sendAndConfirmTransaction:hs},Symbol.toStringTag,{value:"Module"})),Wh=_s(Mh);function Y(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(r.next(u))}catch(h){o(h)}}function c(u){try{l(r.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((r=r.apply(n,e||[])).next())})}function Ke(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)}function kr(n,e){if(!n)throw new Error(e)}var Ve;(function(n){n.prod="BLOCTO_SDK",n.dev="BLOCTO_SDK_DEV",n.staging="BLOCTO_SDK_STAGING"})(Ve||(Ve={}));var me;(function(n){n.ETHEREUM="ethereum",n.SOLANA="solana",n.APTOS="aptos"})(me||(me={}));class qh{constructor(){this.storage={}}getItem(e){return this[e]||null}setItem(e,t){this.storage[e]=t}removeItem(e){delete this.storage[e]}}const jh=typeof window<"u"?window.memoryStorage:new qh,$h=()=>{if(typeof window>"u")return!1;try{window.sessionStorage.setItem("local_storage_supported","1");const n=window.sessionStorage.getItem("local_storage_supported");return window.sessionStorage.removeItem("local_storage_supported"),n==="1"}catch{return!1}},ni=$h()?window.sessionStorage:jh,Ua=(n,e=null)=>{const t=ni.getItem(n);try{return t&&JSON.parse(t)||e}catch{return t||e}},Fa=(n,e)=>ni.setItem(n,typeof e=="string"?e:JSON.stringify(e)),si=n=>{Fa(n,""),ni.removeItem(n)},pt=n=>{const e=Ua(n,null);return e?new Date().getTime()>e.expiry||e.v!==$r?(si(n),null):e==null?void 0:e.data:null},jr=(n,e,t)=>{var r,s,i;const o=Ua(n),a={data:{code:(e==null?void 0:e.code)||((r=o==null?void 0:o.data)===null||r===void 0?void 0:r.code),connected:!!(e!=null&&e.code||!((s=o==null?void 0:o.data)===null||s===void 0)&&s.code),accounts:Object.assign(Object.assign({},(i=o==null?void 0:o.data)===null||i===void 0?void 0:i.accounts),e==null?void 0:e.accounts)},expiry:t||(o==null?void 0:o.expiry)||new Date().getTime()+ef,v:$r};Fa(n,a)},ke=(n,e)=>{var t,r;return!((t=pt(n))===null||t===void 0)&&t.code?((r=pt(n))===null||r===void 0?void 0:r.accounts[e])||null:(si(n),null)},Lr=(n,e,t)=>{jr(n,{accounts:{[e]:t}})},ii=(n,e)=>{jr(n,{accounts:{[e]:void 0}})},Vh={56:"https://bsc-dataseed1.binance.org",97:"https://data-seed-prebsc-1-s1.binance.org:8545",137:"https://rpc-mainnet.maticvigil.com/",80001:"https://rpc-mumbai.matic.today/",43114:"https://api.avax.network/ext/bc/C/rpc",43113:"https://api.avax-test.network/ext/bc/C/rpc",42161:"https://arb1.arbitrum.io/rpc",421613:"https://endpoints.omniatech.io/v1/arbitrum/goerli/public",10:"https://mainnet.optimism.io",420:"https://goerli.optimism.io"},lo={prod:"https://wallet-v2.blocto.app",staging:"https://wallet-v2-staging.blocto.app",dev:"https://wallet-v2-dev.blocto.app"},Hh={prod:Ve.prod,staging:Ve.staging,dev:Ve.dev},Xt={MainnetBeta:"mainnet-beta",Testnet:"testnet",Devnet:"devnet"},Gh={[Xt.MainnetBeta]:"https://wallet-v2.blocto.app",[Xt.Devnet]:"https://wallet-v2-dev.blocto.app",[Xt.Testnet]:"https://wallet-v2-dev.blocto.app"},Yh={[Xt.MainnetBeta]:Ve.prod,[Xt.Devnet]:Ve.dev,[Xt.Testnet]:Ve.dev},Jh={1:Ve.prod,2:Ve.dev,3:Ve.dev,4:Ve.dev,5:Ve.staging},Zh={1:"https://wallet-v2.blocto.app",2:"https://wallet-v2-dev.blocto.app",3:"https://wallet-v2-dev.blocto.app",4:"https://wallet-v2-dev.blocto.app",5:"https://wallet-v2-staging.blocto.app"};var Gt;(function(n){n.Mainnet="mainnet",n.Testnet="testnet",n.Devnet="devnet",n.Testing="testing",n.Premainnet="premainnet"})(Gt||(Gt={}));const Xh={1:Gt.Mainnet,2:Gt.Testnet,3:Gt.Devnet,4:Gt.Testing,5:Gt.Premainnet},Qh={1:"https://fullnode.mainnet.aptoslabs.com/v1",2:"https://fullnode.testnet.aptoslabs.com/v1",3:"https://fullnode.devnet.aptoslabs.com/v1",4:"",5:"https://premainnet.aptosdev.com/v1"},ho=["connect","disconnect","message","chainChanged","accountsChanged"],ef=86400*1e3,xn="00000000-0000-0000-0000-000000000000",$r="0.5.5";class oi{constructor(){this.isBlocto=!0,this.isConnecting=!1,this.eventListeners={},this.off=this.removeListener,ho.forEach(e=>{this.eventListeners[e]=[]}),this.appId=xn}request(e){return Y(this,void 0,void 0,function*(){})}on(e,t){ho.includes(e)&&this.eventListeners[e].push(t)}once(){}removeListener(e,t){const s=this.eventListeners[e].findIndex(i=>i===t);s!==-1&&this.eventListeners[e].splice(s,1)}}const tf="width:100vw;height:100%;position:fixed;top:0;left:0;z-index:2147483646;border:none;box-sizing:border-box;color-scheme:light;inset:0px;display:block;pointer-events:auto;";function pr(n){const e=document.createElement("iframe");return e.setAttribute("src",n),e.setAttribute("style",tf),e}function gr(n){document.body.appendChild(n)}function Me(n){const e=n&&n.parentNode;e&&e.removeChild instanceof Function&&e.removeChild(n)}var Qt=(n,e,t=window)=>{function r(s){e(s,()=>t.removeEventListener(n,r))}t.addEventListener(n,r)};function er(n,e,t){return Y(this,void 0,void 0,function*(){if((n.status===403||n.status===401)&&(t&&t(),si(e)),!n.ok){const r=yield n.json(),s=new Error((r==null?void 0:r.message)||"unknown error");throw s.error_code=r==null?void 0:r.error_code,s}return n.json()})}const fo=n=>/\S+@\S+\.\S+/.test(n),Ka=n=>typeof n=="object"&&n!==null&&"from"in n,rf=n=>Array.isArray(n)&&n.every(e=>Ka(e));function nf(){return Y(this,void 0,void 0,function*(){const{networks:n}=yield fetch("https://api.blocto.app/networks/evm").then(t=>t.json());return n.reduce((t,r)=>Object.assign(Object.assign({},t),{[r.chain_id]:r}),{})})}function sf(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ne={};function za(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Qe(n){"@babel/helpers - typeof";return Qe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qe(n)}function of(n,e){if(Qe(n)!=="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(Qe(r)!=="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function af(n){var e=of(n,"string");return Qe(e)==="symbol"?e:String(e)}function po(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,af(r.key),r)}}function Da(n,e,t){return e&&po(n.prototype,e),t&&po(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function Nr(n,e){return Nr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},Nr(n,e)}function Ma(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&Nr(n,e)}function cf(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function uf(n,e){if(e&&(Qe(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return cf(n)}function Ur(n){return Ur=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ur(n)}function lf(n){return Function.toString.call(n).indexOf("[native code]")!==-1}function df(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function tn(n,e,t){return df()?tn=Reflect.construct.bind():tn=function(s,i,o){var a=[null];a.push.apply(a,i);var c=Function.bind.apply(s,a),l=new c;return o&&Nr(l,o.prototype),l},tn.apply(null,arguments)}function ws(n){var e=typeof Map=="function"?new Map:void 0;return ws=function(r){if(r===null||!lf(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(r))return e.get(r);e.set(r,s)}function s(){return tn(r,arguments,Ur(this).constructor)}return s.prototype=Object.create(r.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),Nr(s,r)},ws(n)}var Mt={},hf=Fr;Fr.default=Fr;Fr.stable=ja;Fr.stableStringify=ja;var ln="[...]",Wa="[Circular]",nr=[],Jt=[];function qa(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Fr(n,e,t,r){typeof r>"u"&&(r=qa()),vs(n,"",0,[],void 0,0,r);var s;try{Jt.length===0?s=JSON.stringify(n,e,t):s=JSON.stringify(n,$a(e),t)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;nr.length!==0;){var i=nr.pop();i.length===4?Object.defineProperty(i[0],i[1],i[3]):i[0][i[1]]=i[2]}}return s}function yr(n,e,t,r){var s=Object.getOwnPropertyDescriptor(r,t);s.get!==void 0?s.configurable?(Object.defineProperty(r,t,{value:n}),nr.push([r,t,e,s])):Jt.push([e,t,n]):(r[t]=n,nr.push([r,t,e]))}function vs(n,e,t,r,s,i,o){i+=1;var a;if(Qe(n)==="object"&&n!==null){for(a=0;a<r.length;a++)if(r[a]===n){yr(Wa,n,e,s);return}if(typeof o.depthLimit<"u"&&i>o.depthLimit){yr(ln,n,e,s);return}if(typeof o.edgesLimit<"u"&&t+1>o.edgesLimit){yr(ln,n,e,s);return}if(r.push(n),Array.isArray(n))for(a=0;a<n.length;a++)vs(n[a],a,a,r,n,i,o);else{var c=Object.keys(n);for(a=0;a<c.length;a++){var l=c[a];vs(n[l],l,a,r,n,i,o)}}r.pop()}}function ff(n,e){return n<e?-1:n>e?1:0}function ja(n,e,t,r){typeof r>"u"&&(r=qa());var s=ks(n,"",0,[],void 0,0,r)||n,i;try{Jt.length===0?i=JSON.stringify(s,e,t):i=JSON.stringify(s,$a(e),t)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;nr.length!==0;){var o=nr.pop();o.length===4?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}}return i}function ks(n,e,t,r,s,i,o){i+=1;var a;if(Qe(n)==="object"&&n!==null){for(a=0;a<r.length;a++)if(r[a]===n){yr(Wa,n,e,s);return}try{if(typeof n.toJSON=="function")return}catch{return}if(typeof o.depthLimit<"u"&&i>o.depthLimit){yr(ln,n,e,s);return}if(typeof o.edgesLimit<"u"&&t+1>o.edgesLimit){yr(ln,n,e,s);return}if(r.push(n),Array.isArray(n))for(a=0;a<n.length;a++)ks(n[a],a,a,r,n,i,o);else{var c={},l=Object.keys(n).sort(ff);for(a=0;a<l.length;a++){var u=l[a];ks(n[u],u,a,r,n,i,o),c[u]=n[u]}if(typeof s<"u")nr.push([s,e,n]),s[e]=c;else return c}r.pop()}}function $a(n){return n=typeof n<"u"?n:function(e,t){return t},function(e,t){if(Jt.length>0)for(var r=0;r<Jt.length;r++){var s=Jt[r];if(s[1]===e&&s[0]===t){t=s[2],Jt.splice(r,1);break}}return n.call(this,e,t)}}function Va(n){var e=pf();return function(){var r=Ur(n),s;if(e){var i=Ur(this).constructor;s=Reflect.construct(r,arguments,i)}else s=r.apply(this,arguments);return uf(this,s)}}function pf(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}Object.defineProperty(Mt,"__esModule",{value:!0});Mt.EthereumProviderError=Mt.EthereumRpcError=void 0;var gf=hf,Ha=function(n){Ma(t,n);var e=Va(t);function t(r,s,i){var o;if(za(this,t),!Number.isInteger(r))throw new Error('"code" must be an integer.');if(!s||typeof s!="string")throw new Error('"message" must be a nonempty string.');return o=e.call(this,s),o.code=r,i!==void 0&&(o.data=i),o}return Da(t,[{key:"serialize",value:function(){var s={code:this.code,message:this.message};return this.data!==void 0&&(s.data=this.data),this.stack&&(s.stack=this.stack),s}},{key:"toString",value:function(){return gf.default(this.serialize(),bf,2)}}]),t}(ws(Error));Mt.EthereumRpcError=Ha;var yf=function(n){Ma(t,n);var e=Va(t);function t(r,s,i){if(za(this,t),!mf(r))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');return e.call(this,r,s,i)}return Da(t)}(Ha);Mt.EthereumProviderError=yf;function mf(n){return Number.isInteger(n)&&n>=1e3&&n<=4999}function bf(n,e){if(e!=="[Circular]")return e}var ai={},Wt={};Object.defineProperty(Wt,"__esModule",{value:!0});Wt.errorValues=Wt.errorCodes=void 0;Wt.errorCodes={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},provider:{userRejectedRequest:4001,unauthorized:4100,unsupportedMethod:4200,disconnected:4900,chainDisconnected:4901}};Wt.errorValues={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.serializeError=n.isValidCode=n.getMessageFromCode=n.JSON_RPC_SERVER_ERROR_MESSAGE=void 0;var e=Wt,t=Mt,r=e.errorCodes.rpc.internal,s="Unspecified error message. This is a bug, please report it.",i={code:r,message:o(r)};n.JSON_RPC_SERVER_ERROR_MESSAGE="Unspecified server error.";function o(g){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:s;if(Number.isInteger(g)){var p=g.toString();if(h(e.errorValues,p))return e.errorValues[p].message;if(l(g))return n.JSON_RPC_SERVER_ERROR_MESSAGE}return d}n.getMessageFromCode=o;function a(g){if(!Number.isInteger(g))return!1;var d=g.toString();return!!(e.errorValues[d]||l(g))}n.isValidCode=a;function c(g){var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=d.fallbackError,y=p===void 0?i:p,f=d.shouldIncludeStack,k=f===void 0?!1:f,I,b;if(!y||!Number.isInteger(y.code)||typeof y.message!="string")throw new Error("Must provide fallback error with integer number code and string message.");if(g instanceof t.EthereumRpcError)return g.serialize();var _={};if(g&&Qe(g)==="object"&&!Array.isArray(g)&&h(g,"code")&&a(g.code)){var x=g;_.code=x.code,x.message&&typeof x.message=="string"?(_.message=x.message,h(x,"data")&&(_.data=x.data)):(_.message=o(_.code),_.data={originalError:u(g)})}else{_.code=y.code;var E=(I=g)===null||I===void 0?void 0:I.message;_.message=E&&typeof E=="string"?E:y.message,_.data={originalError:u(g)}}var B=(b=g)===null||b===void 0?void 0:b.stack;return k&&g&&B&&typeof B=="string"&&(_.stack=B),_}n.serializeError=c;function l(g){return g>=-32099&&g<=-32e3}function u(g){return g&&Qe(g)==="object"&&!Array.isArray(g)?Object.assign({},g):g}function h(g,d){return Object.prototype.hasOwnProperty.call(g,d)}})(ai);function wf(n){if(Array.isArray(n))return n}function vf(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,s,i,o,a=[],c=!0,l=!1;try{if(i=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=i.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(u){l=!0,s=u}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(l)throw s}}return a}}function go(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function kf(n,e){if(n){if(typeof n=="string")return go(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return go(n,e)}}function Sf(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ga(n,e){return wf(n)||vf(n,e)||kf(n,e)||Sf()}var Rn={};Object.defineProperty(Rn,"__esModule",{value:!0});Rn.ethErrors=void 0;var ci=Mt,Ya=ai,Fe=Wt;Rn.ethErrors={rpc:{parse:function(e){return tt(Fe.errorCodes.rpc.parse,e)},invalidRequest:function(e){return tt(Fe.errorCodes.rpc.invalidRequest,e)},invalidParams:function(e){return tt(Fe.errorCodes.rpc.invalidParams,e)},methodNotFound:function(e){return tt(Fe.errorCodes.rpc.methodNotFound,e)},internal:function(e){return tt(Fe.errorCodes.rpc.internal,e)},server:function(e){if(!e||Qe(e)!=="object"||Array.isArray(e))throw new Error("Ethereum RPC Server errors must provide single object argument.");var t=e.code;if(!Number.isInteger(t)||t>-32005||t<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return tt(t,e)},invalidInput:function(e){return tt(Fe.errorCodes.rpc.invalidInput,e)},resourceNotFound:function(e){return tt(Fe.errorCodes.rpc.resourceNotFound,e)},resourceUnavailable:function(e){return tt(Fe.errorCodes.rpc.resourceUnavailable,e)},transactionRejected:function(e){return tt(Fe.errorCodes.rpc.transactionRejected,e)},methodNotSupported:function(e){return tt(Fe.errorCodes.rpc.methodNotSupported,e)},limitExceeded:function(e){return tt(Fe.errorCodes.rpc.limitExceeded,e)}},provider:{userRejectedRequest:function(e){return Rr(Fe.errorCodes.provider.userRejectedRequest,e)},unauthorized:function(e){return Rr(Fe.errorCodes.provider.unauthorized,e)},unsupportedMethod:function(e){return Rr(Fe.errorCodes.provider.unsupportedMethod,e)},disconnected:function(e){return Rr(Fe.errorCodes.provider.disconnected,e)},chainDisconnected:function(e){return Rr(Fe.errorCodes.provider.chainDisconnected,e)},custom:function(e){if(!e||Qe(e)!=="object"||Array.isArray(e))throw new Error("Ethereum Provider custom errors must provide single object argument.");var t=e.code,r=e.message,s=e.data;if(!r||typeof r!="string")throw new Error('"message" must be a nonempty string');return new ci.EthereumProviderError(t,r,s)}}};function tt(n,e){var t=Ja(e),r=Ga(t,2),s=r[0],i=r[1];return new ci.EthereumRpcError(n,s||Ya.getMessageFromCode(n),i)}function Rr(n,e){var t=Ja(e),r=Ga(t,2),s=r[0],i=r[1];return new ci.EthereumProviderError(n,s||Ya.getMessageFromCode(n),i)}function Ja(n){if(n){if(typeof n=="string")return[n];if(Qe(n)==="object"&&!Array.isArray(n)){var e=n.message,t=n.data;if(e&&typeof e!="string")throw new Error("Must specify string message.");return[e||void 0,t]}}return[]}(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.getMessageFromCode=n.serializeError=n.EthereumProviderError=n.EthereumRpcError=n.ethErrors=n.errorCodes=void 0;var e=Mt;Object.defineProperty(n,"EthereumRpcError",{enumerable:!0,get:function(){return e.EthereumRpcError}}),Object.defineProperty(n,"EthereumProviderError",{enumerable:!0,get:function(){return e.EthereumProviderError}});var t=ai;Object.defineProperty(n,"serializeError",{enumerable:!0,get:function(){return t.serializeError}}),Object.defineProperty(n,"getMessageFromCode",{enumerable:!0,get:function(){return t.getMessageFromCode}});var r=Rn;Object.defineProperty(n,"ethErrors",{enumerable:!0,get:function(){return r.ethErrors}});var s=Wt;Object.defineProperty(n,"errorCodes",{enumerable:!0,get:function(){return s.errorCodes}})})(ne);var yo=typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{},ft=[],rt=[],_f=typeof Uint8Array<"u"?Uint8Array:Array,ui=!1;function Za(){ui=!0;for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,t=n.length;e<t;++e)ft[e]=n[e],rt[n.charCodeAt(e)]=e;rt["-".charCodeAt(0)]=62,rt["_".charCodeAt(0)]=63}function Ef(n){ui||Za();var e,t,r,s,i,o,a=n.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");i=n[a-2]==="="?2:n[a-1]==="="?1:0,o=new _f(a*3/4-i),r=i>0?a-4:a;var c=0;for(e=0,t=0;e<r;e+=4,t+=3)s=rt[n.charCodeAt(e)]<<18|rt[n.charCodeAt(e+1)]<<12|rt[n.charCodeAt(e+2)]<<6|rt[n.charCodeAt(e+3)],o[c++]=s>>16&255,o[c++]=s>>8&255,o[c++]=s&255;return i===2?(s=rt[n.charCodeAt(e)]<<2|rt[n.charCodeAt(e+1)]>>4,o[c++]=s&255):i===1&&(s=rt[n.charCodeAt(e)]<<10|rt[n.charCodeAt(e+1)]<<4|rt[n.charCodeAt(e+2)]>>2,o[c++]=s>>8&255,o[c++]=s&255),o}function If(n){return ft[n>>18&63]+ft[n>>12&63]+ft[n>>6&63]+ft[n&63]}function Af(n,e,t){for(var r,s=[],i=e;i<t;i+=3)r=(n[i]<<16)+(n[i+1]<<8)+n[i+2],s.push(If(r));return s.join("")}function mo(n){ui||Za();for(var e,t=n.length,r=t%3,s="",i=[],o=16383,a=0,c=t-r;a<c;a+=o)i.push(Af(n,a,a+o>c?c:a+o));return r===1?(e=n[t-1],s+=ft[e>>2],s+=ft[e<<4&63],s+="=="):r===2&&(e=(n[t-2]<<8)+n[t-1],s+=ft[e>>10],s+=ft[e>>4&63],s+=ft[e<<2&63],s+="="),i.push(s),i.join("")}function Pn(n,e,t,r,s){var i,o,a=s*8-r-1,c=(1<<a)-1,l=c>>1,u=-7,h=t?s-1:0,g=t?-1:1,d=n[e+h];for(h+=g,i=d&(1<<-u)-1,d>>=-u,u+=a;u>0;i=i*256+n[e+h],h+=g,u-=8);for(o=i&(1<<-u)-1,i>>=-u,u+=r;u>0;o=o*256+n[e+h],h+=g,u-=8);if(i===0)i=1-l;else{if(i===c)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,r),i=i-l}return(d?-1:1)*o*Math.pow(2,i-r)}function Xa(n,e,t,r,s,i){var o,a,c,l=i*8-s-1,u=(1<<l)-1,h=u>>1,g=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:i-1,p=r?1:-1,y=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+h>=1?e+=g/c:e+=g*Math.pow(2,1-h),e*c>=2&&(o++,c/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(e*c-1)*Math.pow(2,s),o=o+h):(a=e*Math.pow(2,h-1)*Math.pow(2,s),o=0));s>=8;n[t+d]=a&255,d+=p,a/=256,s-=8);for(o=o<<s|a,l+=s;l>0;n[t+d]=o&255,d+=p,o/=256,l-=8);n[t+d-p]|=y*128}var xf={}.toString,Qa=Array.isArray||function(n){return xf.call(n)=="[object Array]"};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */var Rf=50;R.TYPED_ARRAY_SUPPORT=yo.TYPED_ARRAY_SUPPORT!==void 0?yo.TYPED_ARRAY_SUPPORT:!0;dn();function dn(){return R.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function Rt(n,e){if(dn()<e)throw new RangeError("Invalid typed array length");return R.TYPED_ARRAY_SUPPORT?(n=new Uint8Array(e),n.__proto__=R.prototype):(n===null&&(n=new R(e)),n.length=e),n}function R(n,e,t){if(!R.TYPED_ARRAY_SUPPORT&&!(this instanceof R))return new R(n,e,t);if(typeof n=="number"){if(typeof e=="string")throw new Error("If encoding is specified then the first argument must be a string");return li(this,n)}return ec(this,n,e,t)}R.poolSize=8192;R._augment=function(n){return n.__proto__=R.prototype,n};function ec(n,e,t,r){if(typeof e=="number")throw new TypeError('"value" argument must not be a number');return typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer?Tf(n,e,t,r):typeof e=="string"?Bf(n,e,t):Cf(n,e)}R.from=function(n,e,t){return ec(null,n,e,t)};R.TYPED_ARRAY_SUPPORT&&(R.prototype.__proto__=Uint8Array.prototype,R.__proto__=Uint8Array,typeof Symbol<"u"&&Symbol.species&&R[Symbol.species]);function tc(n){if(typeof n!="number")throw new TypeError('"size" argument must be a number');if(n<0)throw new RangeError('"size" argument must not be negative')}function Pf(n,e,t,r){return tc(e),e<=0?Rt(n,e):t!==void 0?typeof r=="string"?Rt(n,e).fill(t,r):Rt(n,e).fill(t):Rt(n,e)}R.alloc=function(n,e,t){return Pf(null,n,e,t)};function li(n,e){if(tc(e),n=Rt(n,e<0?0:di(e)|0),!R.TYPED_ARRAY_SUPPORT)for(var t=0;t<e;++t)n[t]=0;return n}R.allocUnsafe=function(n){return li(null,n)};R.allocUnsafeSlow=function(n){return li(null,n)};function Bf(n,e,t){if((typeof t!="string"||t==="")&&(t="utf8"),!R.isEncoding(t))throw new TypeError('"encoding" must be a valid string encoding');var r=rc(e,t)|0;n=Rt(n,r);var s=n.write(e,t);return s!==r&&(n=n.slice(0,s)),n}function Ss(n,e){var t=e.length<0?0:di(e.length)|0;n=Rt(n,t);for(var r=0;r<t;r+=1)n[r]=e[r]&255;return n}function Tf(n,e,t,r){if(e.byteLength,t<0||e.byteLength<t)throw new RangeError("'offset' is out of bounds");if(e.byteLength<t+(r||0))throw new RangeError("'length' is out of bounds");return t===void 0&&r===void 0?e=new Uint8Array(e):r===void 0?e=new Uint8Array(e,t):e=new Uint8Array(e,t,r),R.TYPED_ARRAY_SUPPORT?(n=e,n.__proto__=R.prototype):n=Ss(n,e),n}function Cf(n,e){if(mt(e)){var t=di(e.length)|0;return n=Rt(n,t),n.length===0||e.copy(n,0,0,t),n}if(e){if(typeof ArrayBuffer<"u"&&e.buffer instanceof ArrayBuffer||"length"in e)return typeof e.length!="number"||Zf(e.length)?Rt(n,0):Ss(n,e);if(e.type==="Buffer"&&Qa(e.data))return Ss(n,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function di(n){if(n>=dn())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+dn().toString(16)+" bytes");return n|0}R.isBuffer=Xf;function mt(n){return!!(n!=null&&n._isBuffer)}R.compare=function(e,t){if(!mt(e)||!mt(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,s=t.length,i=0,o=Math.min(r,s);i<o;++i)if(e[i]!==t[i]){r=e[i],s=t[i];break}return r<s?-1:s<r?1:0};R.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};R.concat=function(e,t){if(!Qa(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return R.alloc(0);var r;if(t===void 0)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var s=R.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(!mt(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(s,i),i+=o.length}return s};function rc(n,e){if(mt(n))return n.length;if(typeof ArrayBuffer<"u"&&typeof ArrayBuffer.isView=="function"&&(ArrayBuffer.isView(n)||n instanceof ArrayBuffer))return n.byteLength;typeof n!="string"&&(n=""+n);var t=n.length;if(t===0)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":case void 0:return hn(n).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return uc(n).length;default:if(r)return hn(n).length;e=(""+e).toLowerCase(),r=!0}}R.byteLength=rc;function Of(n,e,t){var r=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(n||(n="utf8");;)switch(n){case"hex":return qf(this,e,t);case"utf8":case"utf-8":return ic(this,e,t);case"ascii":return Mf(this,e,t);case"latin1":case"binary":return Wf(this,e,t);case"base64":return zf(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return jf(this,e,t);default:if(r)throw new TypeError("Unknown encoding: "+n);n=(n+"").toLowerCase(),r=!0}}R.prototype._isBuffer=!0;function Zt(n,e,t){var r=n[e];n[e]=n[t],n[t]=r}R.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)Zt(this,t,t+1);return this};R.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)Zt(this,t,t+3),Zt(this,t+1,t+2);return this};R.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)Zt(this,t,t+7),Zt(this,t+1,t+6),Zt(this,t+2,t+5),Zt(this,t+3,t+4);return this};R.prototype.toString=function(){var e=this.length|0;return e===0?"":arguments.length===0?ic(this,0,e):Of.apply(this,arguments)};R.prototype.equals=function(e){if(!mt(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:R.compare(this,e)===0};R.prototype.inspect=function(){var e="",t=Rf;return this.length>0&&(e=this.toString("hex",0,t).match(/.{2}/g).join(" "),this.length>t&&(e+=" ... ")),"<Buffer "+e+">"};R.prototype.compare=function(e,t,r,s,i){if(!mt(e))throw new TypeError("Argument must be a Buffer");if(t===void 0&&(t=0),r===void 0&&(r=e?e.length:0),s===void 0&&(s=0),i===void 0&&(i=this.length),t<0||r>e.length||s<0||i>this.length)throw new RangeError("out of range index");if(s>=i&&t>=r)return 0;if(s>=i)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,s>>>=0,i>>>=0,this===e)return 0;for(var o=i-s,a=r-t,c=Math.min(o,a),l=this.slice(s,i),u=e.slice(t,r),h=0;h<c;++h)if(l[h]!==u[h]){o=l[h],a=u[h];break}return o<a?-1:a<o?1:0};function nc(n,e,t,r,s){if(n.length===0)return-1;if(typeof t=="string"?(r=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,isNaN(t)&&(t=s?0:n.length-1),t<0&&(t=n.length+t),t>=n.length){if(s)return-1;t=n.length-1}else if(t<0)if(s)t=0;else return-1;if(typeof e=="string"&&(e=R.from(e,r)),mt(e))return e.length===0?-1:bo(n,e,t,r,s);if(typeof e=="number")return e=e&255,R.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf=="function"?s?Uint8Array.prototype.indexOf.call(n,e,t):Uint8Array.prototype.lastIndexOf.call(n,e,t):bo(n,[e],t,r,s);throw new TypeError("val must be string, number or Buffer")}function bo(n,e,t,r,s){var i=1,o=n.length,a=e.length;if(r!==void 0&&(r=String(r).toLowerCase(),r==="ucs2"||r==="ucs-2"||r==="utf16le"||r==="utf-16le")){if(n.length<2||e.length<2)return-1;i=2,o/=2,a/=2,t/=2}function c(d,p){return i===1?d[p]:d.readUInt16BE(p*i)}var l;if(s){var u=-1;for(l=t;l<o;l++)if(c(n,l)===c(e,u===-1?0:l-u)){if(u===-1&&(u=l),l-u+1===a)return u*i}else u!==-1&&(l-=l-u),u=-1}else for(t+a>o&&(t=o-a),l=t;l>=0;l--){for(var h=!0,g=0;g<a;g++)if(c(n,l+g)!==c(e,g)){h=!1;break}if(h)return l}return-1}R.prototype.includes=function(e,t,r){return this.indexOf(e,t,r)!==-1};R.prototype.indexOf=function(e,t,r){return nc(this,e,t,r,!0)};R.prototype.lastIndexOf=function(e,t,r){return nc(this,e,t,r,!1)};function Lf(n,e,t,r){t=Number(t)||0;var s=n.length-t;r?(r=Number(r),r>s&&(r=s)):r=s;var i=e.length;if(i%2!==0)throw new TypeError("Invalid hex string");r>i/2&&(r=i/2);for(var o=0;o<r;++o){var a=parseInt(e.substr(o*2,2),16);if(isNaN(a))return o;n[t+o]=a}return o}function Nf(n,e,t,r){return Cn(hn(e,n.length-t),n,t,r)}function sc(n,e,t,r){return Cn(Yf(e),n,t,r)}function Uf(n,e,t,r){return sc(n,e,t,r)}function Ff(n,e,t,r){return Cn(uc(e),n,t,r)}function Kf(n,e,t,r){return Cn(Jf(e,n.length-t),n,t,r)}R.prototype.write=function(e,t,r,s){if(t===void 0)s="utf8",r=this.length,t=0;else if(r===void 0&&typeof t=="string")s=t,r=this.length,t=0;else if(isFinite(t))t=t|0,isFinite(r)?(r=r|0,s===void 0&&(s="utf8")):(s=r,r=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var i=this.length-t;if((r===void 0||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");s||(s="utf8");for(var o=!1;;)switch(s){case"hex":return Lf(this,e,t,r);case"utf8":case"utf-8":return Nf(this,e,t,r);case"ascii":return sc(this,e,t,r);case"latin1":case"binary":return Uf(this,e,t,r);case"base64":return Ff(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Kf(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+s);s=(""+s).toLowerCase(),o=!0}};R.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function zf(n,e,t){return e===0&&t===n.length?mo(n):mo(n.slice(e,t))}function ic(n,e,t){t=Math.min(n.length,t);for(var r=[],s=e;s<t;){var i=n[s],o=null,a=i>239?4:i>223?3:i>191?2:1;if(s+a<=t){var c,l,u,h;switch(a){case 1:i<128&&(o=i);break;case 2:c=n[s+1],(c&192)===128&&(h=(i&31)<<6|c&63,h>127&&(o=h));break;case 3:c=n[s+1],l=n[s+2],(c&192)===128&&(l&192)===128&&(h=(i&15)<<12|(c&63)<<6|l&63,h>2047&&(h<55296||h>57343)&&(o=h));break;case 4:c=n[s+1],l=n[s+2],u=n[s+3],(c&192)===128&&(l&192)===128&&(u&192)===128&&(h=(i&15)<<18|(c&63)<<12|(l&63)<<6|u&63,h>65535&&h<1114112&&(o=h))}}o===null?(o=65533,a=1):o>65535&&(o-=65536,r.push(o>>>10&1023|55296),o=56320|o&1023),r.push(o),s+=a}return Df(r)}var wo=4096;function Df(n){var e=n.length;if(e<=wo)return String.fromCharCode.apply(String,n);for(var t="",r=0;r<e;)t+=String.fromCharCode.apply(String,n.slice(r,r+=wo));return t}function Mf(n,e,t){var r="";t=Math.min(n.length,t);for(var s=e;s<t;++s)r+=String.fromCharCode(n[s]&127);return r}function Wf(n,e,t){var r="";t=Math.min(n.length,t);for(var s=e;s<t;++s)r+=String.fromCharCode(n[s]);return r}function qf(n,e,t){var r=n.length;(!e||e<0)&&(e=0),(!t||t<0||t>r)&&(t=r);for(var s="",i=e;i<t;++i)s+=Gf(n[i]);return s}function jf(n,e,t){for(var r=n.slice(e,t),s="",i=0;i<r.length;i+=2)s+=String.fromCharCode(r[i]+r[i+1]*256);return s}R.prototype.slice=function(e,t){var r=this.length;e=~~e,t=t===void 0?r:~~t,e<0?(e+=r,e<0&&(e=0)):e>r&&(e=r),t<0?(t+=r,t<0&&(t=0)):t>r&&(t=r),t<e&&(t=e);var s;if(R.TYPED_ARRAY_SUPPORT)s=this.subarray(e,t),s.__proto__=R.prototype;else{var i=t-e;s=new R(i,void 0);for(var o=0;o<i;++o)s[o]=this[o+e]}return s};function Ae(n,e,t){if(n%1!==0||n<0)throw new RangeError("offset is not uint");if(n+e>t)throw new RangeError("Trying to access beyond buffer length")}R.prototype.readUIntLE=function(e,t,r){e=e|0,t=t|0,r||Ae(e,t,this.length);for(var s=this[e],i=1,o=0;++o<t&&(i*=256);)s+=this[e+o]*i;return s};R.prototype.readUIntBE=function(e,t,r){e=e|0,t=t|0,r||Ae(e,t,this.length);for(var s=this[e+--t],i=1;t>0&&(i*=256);)s+=this[e+--t]*i;return s};R.prototype.readUInt8=function(e,t){return t||Ae(e,1,this.length),this[e]};R.prototype.readUInt16LE=function(e,t){return t||Ae(e,2,this.length),this[e]|this[e+1]<<8};R.prototype.readUInt16BE=function(e,t){return t||Ae(e,2,this.length),this[e]<<8|this[e+1]};R.prototype.readUInt32LE=function(e,t){return t||Ae(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};R.prototype.readUInt32BE=function(e,t){return t||Ae(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};R.prototype.readIntLE=function(e,t,r){e=e|0,t=t|0,r||Ae(e,t,this.length);for(var s=this[e],i=1,o=0;++o<t&&(i*=256);)s+=this[e+o]*i;return i*=128,s>=i&&(s-=Math.pow(2,8*t)),s};R.prototype.readIntBE=function(e,t,r){e=e|0,t=t|0,r||Ae(e,t,this.length);for(var s=t,i=1,o=this[e+--s];s>0&&(i*=256);)o+=this[e+--s]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o};R.prototype.readInt8=function(e,t){return t||Ae(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};R.prototype.readInt16LE=function(e,t){t||Ae(e,2,this.length);var r=this[e]|this[e+1]<<8;return r&32768?r|4294901760:r};R.prototype.readInt16BE=function(e,t){t||Ae(e,2,this.length);var r=this[e+1]|this[e]<<8;return r&32768?r|4294901760:r};R.prototype.readInt32LE=function(e,t){return t||Ae(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};R.prototype.readInt32BE=function(e,t){return t||Ae(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};R.prototype.readFloatLE=function(e,t){return t||Ae(e,4,this.length),Pn(this,e,!0,23,4)};R.prototype.readFloatBE=function(e,t){return t||Ae(e,4,this.length),Pn(this,e,!1,23,4)};R.prototype.readDoubleLE=function(e,t){return t||Ae(e,8,this.length),Pn(this,e,!0,52,8)};R.prototype.readDoubleBE=function(e,t){return t||Ae(e,8,this.length),Pn(this,e,!1,52,8)};function Ge(n,e,t,r,s,i){if(!mt(n))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>s||e<i)throw new RangeError('"value" argument is out of bounds');if(t+r>n.length)throw new RangeError("Index out of range")}R.prototype.writeUIntLE=function(e,t,r,s){if(e=+e,t=t|0,r=r|0,!s){var i=Math.pow(2,8*r)-1;Ge(this,e,t,r,i,0)}var o=1,a=0;for(this[t]=e&255;++a<r&&(o*=256);)this[t+a]=e/o&255;return t+r};R.prototype.writeUIntBE=function(e,t,r,s){if(e=+e,t=t|0,r=r|0,!s){var i=Math.pow(2,8*r)-1;Ge(this,e,t,r,i,0)}var o=r-1,a=1;for(this[t+o]=e&255;--o>=0&&(a*=256);)this[t+o]=e/a&255;return t+r};R.prototype.writeUInt8=function(e,t,r){return e=+e,t=t|0,r||Ge(this,e,t,1,255,0),R.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=e&255,t+1};function Bn(n,e,t,r){e<0&&(e=65535+e+1);for(var s=0,i=Math.min(n.length-t,2);s<i;++s)n[t+s]=(e&255<<8*(r?s:1-s))>>>(r?s:1-s)*8}R.prototype.writeUInt16LE=function(e,t,r){return e=+e,t=t|0,r||Ge(this,e,t,2,65535,0),R.TYPED_ARRAY_SUPPORT?(this[t]=e&255,this[t+1]=e>>>8):Bn(this,e,t,!0),t+2};R.prototype.writeUInt16BE=function(e,t,r){return e=+e,t=t|0,r||Ge(this,e,t,2,65535,0),R.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e&255):Bn(this,e,t,!1),t+2};function Tn(n,e,t,r){e<0&&(e=4294967295+e+1);for(var s=0,i=Math.min(n.length-t,4);s<i;++s)n[t+s]=e>>>(r?s:3-s)*8&255}R.prototype.writeUInt32LE=function(e,t,r){return e=+e,t=t|0,r||Ge(this,e,t,4,4294967295,0),R.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255):Tn(this,e,t,!0),t+4};R.prototype.writeUInt32BE=function(e,t,r){return e=+e,t=t|0,r||Ge(this,e,t,4,4294967295,0),R.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255):Tn(this,e,t,!1),t+4};R.prototype.writeIntLE=function(e,t,r,s){if(e=+e,t=t|0,!s){var i=Math.pow(2,8*r-1);Ge(this,e,t,r,i-1,-i)}var o=0,a=1,c=0;for(this[t]=e&255;++o<r&&(a*=256);)e<0&&c===0&&this[t+o-1]!==0&&(c=1),this[t+o]=(e/a>>0)-c&255;return t+r};R.prototype.writeIntBE=function(e,t,r,s){if(e=+e,t=t|0,!s){var i=Math.pow(2,8*r-1);Ge(this,e,t,r,i-1,-i)}var o=r-1,a=1,c=0;for(this[t+o]=e&255;--o>=0&&(a*=256);)e<0&&c===0&&this[t+o+1]!==0&&(c=1),this[t+o]=(e/a>>0)-c&255;return t+r};R.prototype.writeInt8=function(e,t,r){return e=+e,t=t|0,r||Ge(this,e,t,1,127,-128),R.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=e&255,t+1};R.prototype.writeInt16LE=function(e,t,r){return e=+e,t=t|0,r||Ge(this,e,t,2,32767,-32768),R.TYPED_ARRAY_SUPPORT?(this[t]=e&255,this[t+1]=e>>>8):Bn(this,e,t,!0),t+2};R.prototype.writeInt16BE=function(e,t,r){return e=+e,t=t|0,r||Ge(this,e,t,2,32767,-32768),R.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=e&255):Bn(this,e,t,!1),t+2};R.prototype.writeInt32LE=function(e,t,r){return e=+e,t=t|0,r||Ge(this,e,t,4,2147483647,-2147483648),R.TYPED_ARRAY_SUPPORT?(this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Tn(this,e,t,!0),t+4};R.prototype.writeInt32BE=function(e,t,r){return e=+e,t=t|0,r||Ge(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),R.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255):Tn(this,e,t,!1),t+4};function oc(n,e,t,r,s,i){if(t+r>n.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function ac(n,e,t,r,s){return s||oc(n,e,t,4),Xa(n,e,t,r,23,4),t+4}R.prototype.writeFloatLE=function(e,t,r){return ac(this,e,t,!0,r)};R.prototype.writeFloatBE=function(e,t,r){return ac(this,e,t,!1,r)};function cc(n,e,t,r,s){return s||oc(n,e,t,8),Xa(n,e,t,r,52,8),t+8}R.prototype.writeDoubleLE=function(e,t,r){return cc(this,e,t,!0,r)};R.prototype.writeDoubleBE=function(e,t,r){return cc(this,e,t,!1,r)};R.prototype.copy=function(e,t,r,s){if(r||(r=0),!s&&s!==0&&(s=this.length),t>=e.length&&(t=e.length),t||(t=0),s>0&&s<r&&(s=r),s===r||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(s<0)throw new RangeError("sourceEnd out of bounds");s>this.length&&(s=this.length),e.length-t<s-r&&(s=e.length-t+r);var i=s-r,o;if(this===e&&r<t&&t<s)for(o=i-1;o>=0;--o)e[o+t]=this[o+r];else if(i<1e3||!R.TYPED_ARRAY_SUPPORT)for(o=0;o<i;++o)e[o+t]=this[o+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+i),t);return i};R.prototype.fill=function(e,t,r,s){if(typeof e=="string"){if(typeof t=="string"?(s=t,t=0,r=this.length):typeof r=="string"&&(s=r,r=this.length),e.length===1){var i=e.charCodeAt(0);i<256&&(e=i)}if(s!==void 0&&typeof s!="string")throw new TypeError("encoding must be a string");if(typeof s=="string"&&!R.isEncoding(s))throw new TypeError("Unknown encoding: "+s)}else typeof e=="number"&&(e=e&255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;t=t>>>0,r=r===void 0?this.length:r>>>0,e||(e=0);var o;if(typeof e=="number")for(o=t;o<r;++o)this[o]=e;else{var a=mt(e)?e:hn(new R(e,s).toString()),c=a.length;for(o=0;o<r-t;++o)this[o+t]=a[o%c]}return this};var $f=/[^+\/0-9A-Za-z-_]/g;function Vf(n){if(n=Hf(n).replace($f,""),n.length<2)return"";for(;n.length%4!==0;)n=n+"=";return n}function Hf(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")}function Gf(n){return n<16?"0"+n.toString(16):n.toString(16)}function hn(n,e){e=e||1/0;for(var t,r=n.length,s=null,i=[],o=0;o<r;++o){if(t=n.charCodeAt(o),t>55295&&t<57344){if(!s){if(t>56319){(e-=3)>-1&&i.push(239,191,189);continue}else if(o+1===r){(e-=3)>-1&&i.push(239,191,189);continue}s=t;continue}if(t<56320){(e-=3)>-1&&i.push(239,191,189),s=t;continue}t=(s-55296<<10|t-56320)+65536}else s&&(e-=3)>-1&&i.push(239,191,189);if(s=null,t<128){if((e-=1)<0)break;i.push(t)}else if(t<2048){if((e-=2)<0)break;i.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;i.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;i.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return i}function Yf(n){for(var e=[],t=0;t<n.length;++t)e.push(n.charCodeAt(t)&255);return e}function Jf(n,e){for(var t,r,s,i=[],o=0;o<n.length&&!((e-=2)<0);++o)t=n.charCodeAt(o),r=t>>8,s=t%256,i.push(s),i.push(r);return i}function uc(n){return Ef(Vf(n))}function Cn(n,e,t,r){for(var s=0;s<r&&!(s+t>=e.length||s>=n.length);++s)e[s+t]=n[s];return s}function Zf(n){return n!==n}function Xf(n){return n!=null&&(!!n._isBuffer||lc(n)||Qf(n))}function lc(n){return!!n.constructor&&typeof n.constructor.isBuffer=="function"&&n.constructor.isBuffer(n)}function Qf(n){return typeof n.readFloatLE=="function"&&typeof n.slice=="function"&&lc(n.slice(0,0))}const us=n=>typeof n=="string"&&/^0x[0-9A-Fa-f]*$/.test(n),vo=n=>R.from(n,"utf8").toString("hex");var _e,It,dc,Nt;function Re(n){return n?typeof n=="number"?n:n.startsWith("0x")?parseInt(n,16):parseInt(n,10):1}class ep extends oi{constructor({chainId:e,rpc:t,walletServer:r,appId:s}){super(),_e.add(this),this.networkVersion="1",kr(e,"'chainId' is required"),this.networkVersion=`${Re(e)}`,this.chainId=`0x${Re(e).toString(16)}`,this.rpc=t||Vh[this.networkVersion],kr(this.rpc,"'rpc' is required"),this.injectedWalletServer=r,this._blocto={sessionKey:Ve.prod,walletServer:this.injectedWalletServer||"",blockchainName:"",networkType:"",supportNetworkList:{},switchableNetwork:{}},this.appId=s||xn}send(e,t){return Y(this,void 0,void 0,function*(){switch(!0){case t instanceof Function:return this.sendAsync(e,t);case(typeof e=="string"&&Array.isArray(t)):return this.sendAsync({jsonrpc:"2.0",method:e,params:t});default:return this.sendAsync(e)}})}sendAsync(e,t){return Y(this,void 0,void 0,function*(){const r=new Promise(s=>{if(Array.isArray(e)){const i=e.filter(u=>u.method==="eth_sendTransaction").map(u=>{var h;return(h=u.params)===null||h===void 0?void 0:h[0]}),o=Math.floor(Math.random()*1e4),a={method:"blocto_sendBatchTransaction",params:i},c=this.request(a),l=e.map(({method:u,params:h},g)=>u==="eth_sendTransaction"?c:this.request({id:o+g+1,jsonrpc:"2.0",method:u,params:h}));Promise.allSettled(l).then(u=>s(u.map((h,g)=>({id:String(o+g+1),jsonrpc:"2.0",method:e[g].method,result:h.status==="fulfilled"?h.value:void 0,error:h.status!=="fulfilled"?h.reason:void 0})))).catch(u=>{throw ne.ethErrors.rpc.internal(u==null?void 0:u.message)})}else this.request(Object.assign(Object.assign({},e),{id:Number(e.id)})).then(s)});if(t)r.then(s=>t(null,s)).catch(s=>t(s));else return r})}sendUserOperation(e){return Y(this,void 0,void 0,function*(){return this.request({method:"eth_sendUserOperation",params:[e]})})}request(e){var t,r,s,i,o,a,c,l,u,h;return Y(this,void 0,void 0,function*(){if(!(e!=null&&e.method))throw ne.ethErrors.rpc.invalidRequest();const g=window.ethereum;if(g&&g.isBlocto){if(e.method==="wallet_switchEthereumChain"){if(!(!((r=(t=e==null?void 0:e.params)===null||t===void 0?void 0:t[0])===null||r===void 0)&&r.chainId))throw ne.ethErrors.rpc.invalidParams();return g.request(e).then(()=>{var f,k,I;return this.networkVersion=`${Re((f=e==null?void 0:e.params)===null||f===void 0?void 0:f[0].chainId)}`,this.chainId=`0x${Re((k=e==null?void 0:e.params)===null||k===void 0?void 0:k[0].chainId).toString(16)}`,this.rpc=(I=p==null?void 0:p[this.networkVersion])===null||I===void 0?void 0:I.rpc_url,null})}return g.request(e)}const{blockchainName:d,switchableNetwork:p,sessionKey:y}=yield Ke(this,_e,"m",It).call(this);switch(e.method){case"eth_chainId":return this.chainId;case"net_version":return this.networkVersion;case"wallet_addEthereumChain":return this.loadSwitchableNetwork((e==null?void 0:e.params)||[]);case"eth_call":{const f=yield this.handleReadRequests(e);if(!f||f&&!f.result&&f.error){const k=!((s=f==null?void 0:f.error)===null||s===void 0)&&s.message?f.error.message:"Request failed";throw ne.ethErrors.rpc.internal(k)}return f.result}case"wallet_switchEthereumChain":{if(!(!((o=(i=e==null?void 0:e.params)===null||i===void 0?void 0:i[0])===null||o===void 0)&&o.chainId))throw ne.ethErrors.rpc.invalidParams();const f=e.params[0].chainId;if(!ke(y,d)){const k=Re(f);if(!p[k])throw ne.ethErrors.provider.custom({code:4902,message:`Unrecognized chain ID "${f}". Try adding the chain using wallet_addEthereumChain first.`});return this.networkVersion=`${k}`,this.chainId=`0x${k.toString(16)}`,this.rpc=p[k].rpc_url,this.eventListeners.chainChanged.forEach(I=>I(this.chainId)),null}break}}if(!ke(y,d)){const f=(a=e==null?void 0:e.params)===null||a===void 0?void 0:a[0];e.method==="eth_requestAccounts"&&fo(f)?yield this.enable(f):yield this.enable()}try{let f=null,k=null;switch(e.method){case"eth_requestAccounts":yield this.fetchAccounts();case"eth_accounts":k=ke(y,d);break;case"eth_coinbase":{k=(c=ke(y,d))===null||c===void 0?void 0:c[0];break}case"eth_signTypedData_v3":case"eth_signTypedData":case"eth_signTypedData_v4":case"personal_sign":case"eth_sign":{k=yield this.handleSign(e);break}case"wallet_disconnect":{this.handleDisconnect(),k=null;break}case"eth_sendTransaction":k=yield this.handleSendTransaction(e);break;case"blocto_sendBatchTransaction":k=yield this.handleSendBatchTransaction(e);break;case"eth_signTransaction":case"eth_sendRawTransaction":throw ne.ethErrors.rpc.methodNotSupported("Method Not Supported: "+e.method);case"eth_sendUserOperation":k=yield this.handleSendUserOperation(e);break;case"wallet_switchEthereumChain":{if(!(!((u=(l=e==null?void 0:e.params)===null||l===void 0?void 0:l[0])===null||u===void 0)&&u.chainId))throw ne.ethErrors.rpc.invalidParams();const I=(h=ke(y,d))===null||h===void 0?void 0:h[0],b=this.chainId,_=e.params[0].chainId;if(!p[Re(_)])throw ne.ethErrors.provider.custom({code:4902,message:`Unrecognized chain ID "${Re(e.params[0].chainId)}". Try adding the chain using wallet_addEthereumChain first.`});this.networkVersion=`${Re(_)}`,this.chainId=`0x${Re(_).toString(16)}`,this.rpc=p[this.networkVersion].rpc_url,yield this.enable().then(([x])=>{var E;x!==I&&((E=this.eventListeners)===null||E===void 0||E.accountsChanged.forEach(B=>B([x]))),this.eventListeners.chainChanged.forEach(B=>B(this.chainId)),k=null}).catch(x=>{throw this.networkVersion=`${Re(b)}`,this.chainId=`0x${Re(b).toString(16)}`,this.rpc=p[this.networkVersion].rpc_url,x});break}case"eth_estimateUserOperationGas":case"eth_getUserOperationByHash":case"eth_getUserOperationReceipt":case"eth_supportedEntryPoints":k=yield this.handleBundler(e);break;default:f=yield this.handleReadRequests(e)}if(f&&!f.result&&f.error){const I=f.error.message?f.error.message:"Request failed";throw ne.ethErrors.rpc.internal(I)}return f?f.result:k}catch(f){throw ne.ethErrors.rpc.internal(f==null?void 0:f.message)}})}bloctoApi(e,t){var r;return Y(this,void 0,void 0,function*(){const{walletServer:s,blockchainName:i,sessionKey:o}=yield Ke(this,_e,"m",It).call(this),a=((r=pt(o))===null||r===void 0?void 0:r.code)||"";if(!a)throw ne.ethErrors.provider.unauthorized();return fetch(`${s}/api/${i}${e}`,Object.assign({headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":a}},t)).then(c=>er(c,o,()=>{var l;(l=this.eventListeners)===null||l===void 0||l.disconnect.forEach(u=>u(ne.ethErrors.provider.disconnected()))})).catch(c=>{throw(c==null?void 0:c.error_code)==="unsupported_method"?ne.ethErrors.rpc.methodNotSupported("Method Not Supported: "+c.message):ne.ethErrors.rpc.server({code:-32005,message:`Blocto server error: ${c.message}`})})})}responseListener(e,t){return Y(this,void 0,void 0,function*(){const{walletServer:r}=yield Ke(this,_e,"m",It).call(this);return new Promise((s,i)=>Qt("message",(o,a)=>{const c=o;c.origin===r&&c.data.type==="ETH:FRAME:RESPONSE"&&(c.data.status==="APPROVED"&&(a(),Me(e),s(c.data[t])),c.data.status==="DECLINED"&&(a(),Me(e),c.data.errorCode==="incorrect_session_id"&&this.handleDisconnect(),i(ne.ethErrors.provider.userRejectedRequest(c.data.errorMessage)))),c.data.type==="ETH:FRAME:CLOSE"&&(a(),Me(e),i(ne.ethErrors.provider.userRejectedRequest("User declined the request")))}))})}setIframe(e){return Y(this,void 0,void 0,function*(){if(typeof window>"u")throw ne.ethErrors.provider.custom({code:1001,message:"Blocto SDK only works in browser environment"});const{walletServer:t,blockchainName:r}=yield Ke(this,_e,"m",It).call(this),s=pr(`${t}/${this.appId}/${r}${e}`);return gr(s),s})}enable(e){return Y(this,void 0,void 0,function*(){const{walletServer:t,blockchainName:r,sessionKey:s}=yield Ke(this,_e,"m",It).call(this),i=window.ethereum;if(i&&i.isBlocto)return i.chainId!==this.chainId&&(yield i.request({method:"wallet_addEthereumChain",params:[{chainId:this.chainId}]}),yield i.request({method:"wallet_switchEthereumChain",params:[{chainId:this.chainId}]}),Lr(s,r,[i.address])),new Promise((u,h)=>setTimeout(()=>i.enable().then(u).catch(h),10));const o=ke(s,r);if(o)return new Promise(u=>{u(o)});const a=new URLSearchParams;a.set("l6n",window.location.origin),a.set("v",$r);const c=e&&fo(e)?`/${e}`:"",l=yield this.setIframe(`/authn${c}?${a.toString()}`);return new Promise((u,h)=>{Qt("message",(g,d)=>{var p;const y=g;y.origin===t&&(y.data.type==="ETH:FRAME:RESPONSE"&&(d(),Me(l),(p=this.eventListeners)===null||p===void 0||p.connect.forEach(f=>f({chainId:this.chainId})),jr(s,{code:y.data.code,connected:!0,accounts:{[r]:[y.data.addr]}},y.data.exp),u([y.data.addr])),y.data.type==="ETH:FRAME:CLOSE"&&(d(),Me(l),h(ne.ethErrors.provider.userRejectedRequest())))})})})}fetchAccounts(){return Y(this,void 0,void 0,function*(){Ke(this,_e,"m",Nt).call(this);const{blockchainName:e,sessionKey:t}=yield Ke(this,_e,"m",It).call(this),{accounts:r}=yield this.bloctoApi("/accounts");return Lr(t,e,r),r})}handleReadRequests(e){return Y(this,void 0,void 0,function*(){return Ke(this,_e,"m",Nt).call(this),fetch(this.rpc,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign({id:1,jsonrpc:"2.0"},e))}).then(t=>t.json()).catch(t=>{throw ne.ethErrors.rpc.internal(t)})})}handleSign({method:e,params:t}){return Y(this,void 0,void 0,function*(){let r="";if(Array.isArray(t)){if(e==="eth_sign")r=us(t[1])?t[1].slice(2):vo(t[1]);else if(e==="personal_sign")r=us(t[0])?t[0].slice(2):vo(t[0]);else if(["eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4"].includes(e)){r=t[1];const{domain:o}=JSON.parse(r);if(us(o.chainId))throw ne.ethErrors.rpc.invalidParams(`Provided chainId "${o.chainId}" must be a number`);if(Re(o.chainId)!==Re(this.chainId))throw ne.ethErrors.rpc.invalidParams(`Provided chainId "${o.chainId}" must match the active chainId "${Re(this.chainId)}"`)}}Ke(this,_e,"m",Nt).call(this);const{signatureId:s}=yield this.bloctoApi("/user-signature",{method:"POST",body:JSON.stringify({method:e,message:r})}),i=yield this.setIframe(`/user-signature/${s}`);return this.responseListener(i,"signature")})}handleSendTransaction(e){var t;return Y(this,void 0,void 0,function*(){if(Ke(this,_e,"m",Nt).call(this),!Ka((t=e.params)===null||t===void 0?void 0:t[0]))throw ne.ethErrors.rpc.invalidParams();const{authorizationId:r}=yield this.bloctoApi("/authz",{method:"POST",body:JSON.stringify(e.params)}),s=yield this.setIframe(`/authz/${r}`);return this.responseListener(s,"txHash")})}handleSendBatchTransaction(e){return Y(this,void 0,void 0,function*(){Ke(this,_e,"m",Nt).call(this);const r=(i=>i.map(o=>"params"in o?o.params[0]:o))(e.params),s=Object.assign(Object.assign({},e),{params:r});if(!rf(s.params))throw ne.ethErrors.rpc.invalidParams();return this.handleSendTransaction(s)})}handleSendUserOperation(e){return Y(this,void 0,void 0,function*(){Ke(this,_e,"m",Nt).call(this);const{authorizationId:t}=yield this.bloctoApi("/user-operation",{method:"POST",body:JSON.stringify(e.params)}),r=yield this.setIframe(`/user-operation/${t}`);return this.responseListener(r,"userOpHash")})}handleBundler(e){return Y(this,void 0,void 0,function*(){return Ke(this,_e,"m",Nt).call(this),this.bloctoApi("/rpc/bundler",{method:"POST",body:JSON.stringify(Object.assign({id:1,jsonrpc:"2.0"},e))})})}handleDisconnect(){var e;return Y(this,void 0,void 0,function*(){const t=window.ethereum;if(t&&t.isBlocto)return t.disconnect();const{sessionKey:r,blockchainName:s}=yield Ke(this,_e,"m",It).call(this);ii(r,s),(e=this.eventListeners)===null||e===void 0||e.disconnect.forEach(i=>i(ne.ethErrors.provider.disconnected()))})}loadSwitchableNetwork(e){return Y(this,void 0,void 0,function*(){if(e!=null&&e.length){const t=e.map(({chainId:r,rpcUrls:s})=>{if(!r)throw ne.ethErrors.rpc.invalidParams("Empty chainId");if(!(s!=null&&s.length))throw ne.ethErrors.rpc.invalidParams("Empty rpcUrls");return Ke(this,_e,"m",dc).call(this,{chainId:`${Re(r)}`,rpcUrls:s})});return Promise.all(t).then(()=>null)}else throw ne.ethErrors.rpc.invalidParams("Empty networkList")})}}_e=new WeakSet,It=function(){return Y(this,void 0,void 0,function*(){Object.keys(this._blocto.supportNetworkList).length||(yield nf().then(o=>this._blocto.supportNetworkList=o).catch(o=>{throw ne.ethErrors.provider.custom({code:1001,message:`Get blocto server failed: ${o.message}`})}));const{chain_id:e,name:t,network_type:r,blocto_service_environment:s,display_name:i}=this._blocto.supportNetworkList[this.networkVersion];if(!e)throw ne.ethErrors.provider.unsupportedMethod(`Get support chain failed: ${this.networkVersion} might not be supported yet.`);return this._blocto=Object.assign(Object.assign({},this._blocto),{sessionKey:Hh[s],walletServer:this.injectedWalletServer||lo[s],blockchainName:t,networkType:r,switchableNetwork:Object.assign(Object.assign({},this._blocto.switchableNetwork),{[e]:{name:t,display_name:i,network_type:r,wallet_web_url:this._blocto.walletServer,rpc_url:this.rpc}})}),this._blocto})},dc=function({chainId:e,rpcUrls:t}){return Y(this,void 0,void 0,function*(){const{supportNetworkList:r}=yield Ke(this,_e,"m",It).call(this),{chain_id:s,name:i,display_name:o,network_type:a,blocto_service_environment:c}=r[e],l=lo[c];this._blocto.switchableNetwork[s]={name:i,display_name:o,network_type:a,wallet_web_url:l,rpc_url:t[0]}})},Nt=function(){const e=window.ethereum;if(e&&e.isBlocto&&Re(e.chainId)!==Re(this.chainId))throw ne.ethErrors.provider.chainDisconnected()};function tp(n){if(n.length>=255)throw new TypeError("Alphabet too long");for(var e=new Uint8Array(256),t=0;t<e.length;t++)e[t]=255;for(var r=0;r<n.length;r++){var s=n.charAt(r),i=s.charCodeAt(0);if(e[i]!==255)throw new TypeError(s+" is ambiguous");e[i]=r}var o=n.length,a=n.charAt(0),c=Math.log(o)/Math.log(256),l=Math.log(256)/Math.log(o);function u(d){if(d instanceof Uint8Array||(ArrayBuffer.isView(d)?d=new Uint8Array(d.buffer,d.byteOffset,d.byteLength):Array.isArray(d)&&(d=Uint8Array.from(d))),!(d instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(d.length===0)return"";for(var p=0,y=0,f=0,k=d.length;f!==k&&d[f]===0;)f++,p++;for(var I=(k-f)*l+1>>>0,b=new Uint8Array(I);f!==k;){for(var _=d[f],x=0,E=I-1;(_!==0||x<y)&&E!==-1;E--,x++)_+=256*b[E]>>>0,b[E]=_%o>>>0,_=_/o>>>0;if(_!==0)throw new Error("Non-zero carry");y=x,f++}for(var B=I-y;B!==I&&b[B]===0;)B++;for(var T=a.repeat(p);B<I;++B)T+=n.charAt(b[B]);return T}function h(d){if(typeof d!="string")throw new TypeError("Expected String");if(d.length===0)return new Uint8Array;for(var p=0,y=0,f=0;d[p]===a;)y++,p++;for(var k=(d.length-p)*c+1>>>0,I=new Uint8Array(k);d[p];){var b=e[d.charCodeAt(p)];if(b===255)return;for(var _=0,x=k-1;(b!==0||_<f)&&x!==-1;x--,_++)b+=o*I[x]>>>0,I[x]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");f=_,p++}for(var E=k-f;E!==k&&I[E]===0;)E++;for(var B=new Uint8Array(y+(k-E)),T=y;E!==k;)B[T++]=I[E++];return B}function g(d){var p=h(d);if(p)return p;throw new Error("Non-base"+o+" character")}return{encode:u,decodeUnsafe:h,decode:g}}var rp=tp;const np=rp,sp="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";var ip=np(sp),ko=sf(ip);let jt;try{jt=Wh}catch{}class op extends oi{constructor({net:e="mainnet-beta",server:t,appId:r,rpc:s}){if(super(),kr(e,"'net' is required"),kr(Object.values(Xt).includes(e),"unsupported net"),this.net=e,this.rpc=s||(e==="mainnet-beta"?"https://free.rpcpool.com":`https://api.${e}.solana.com`),this.server=t||Gh[this.net]||"",this.appId=r||xn,this.sessionKey=Yh[this.net],!jt)throw new Error("No @solana/web3.js installed. Please install it to interact with Solana.")}request(e){var t;return Y(this,void 0,void 0,function*(){const r=window.solana;if(r&&r.isBlocto)return r.request(e);ke(this.sessionKey,me.SOLANA)||(yield this.connect());try{let s=null,i=null;switch(e.method){case"connect":i=yield this.fetchAccounts();break;case"disconnect":this.disconnect();break;case"getAccounts":i=!((t=ke(this.sessionKey,me.SOLANA))===null||t===void 0)&&t.length?ke(this.sessionKey,me.SOLANA):yield this.fetchAccounts();break;case"getAccountInfo":{const o=yield this.handleReadRequests(e),[a,c]=o.result.value.data;i=Object.assign(Object.assign({},o.result.value),{data:R.from(a,c),owner:new jt.PublicKey(o.result.value.owner)});break}case"convertToProgramWalletTransaction":i=yield this.handleConvertTransaction(e);break;case"signAndSendTransaction":i=yield this.handleSignAndSendTransaction(e);break;case"signTransaction":case"signAllTransactions":throw new Error(`Blocto is program wallet, which doesn't support ${e.method}. Use signAndSendTransaction instead.`);default:s=yield this.handleReadRequests(e)}if(s&&!s.result&&s.error){const o=s.error.message?s.error.message:"Request failed";throw new Error(o)}return s?s.result:i}catch(s){throw console.error(s),s}})}connect(){return Y(this,void 0,void 0,function*(){const e=window.solana;return e&&e.isBlocto?new Promise(t=>{e.on("connect",()=>{Lr(this.sessionKey,me.SOLANA,[e.publicKey.toBase58()]),t()}),e.connect()}):new Promise((t,r)=>{if(typeof window>"u")return r("Currently only supported in browser");if(ke(this.sessionKey,me.SOLANA))return t();const s=encodeURIComponent(window.location.origin),i=pr(`${this.server}/${this.appId}/solana/authn?l6n=${s}&v=${$r}`);gr(i),Qt("message",(o,a)=>{const c=o;c.origin===this.server&&(c.data.type==="SOL:FRAME:RESPONSE"&&(a(),Me(i),this.eventListeners.connect.forEach(l=>l(this.net)),jr(this.sessionKey,{code:c.data.code,connected:!0,accounts:{[me.SOLANA]:[c.data.addr]}},c.data.exp),t()),c.data.type==="SOL:FRAME:CLOSE"&&(a(),Me(i),r(new Error("User declined the login request"))))})})})}disconnect(){return Y(this,void 0,void 0,function*(){const e=window.solana;if(e&&e.isBlocto){yield e.disconnect();return}this.eventListeners.disconnect.forEach(t=>t(null)),ii(this.sessionKey,me.SOLANA)})}fetchAccounts(){var e;return Y(this,void 0,void 0,function*(){const t=((e=pt(this.sessionKey))===null||e===void 0?void 0:e.code)||"",{accounts:r}=yield fetch(`${this.server}/api/solana/accounts`,{headers:{"Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":t}}).then(s=>er(s,this.sessionKey));return Lr(this.sessionKey,me.SOLANA,r),r})}handleReadRequests(e){return Y(this,void 0,void 0,function*(){return fetch(this.rpc,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.assign({id:1,jsonrpc:"2.0"},e))}).then(t=>t.json())})}convertToProgramWalletTransaction(e){return Y(this,void 0,void 0,function*(){const t=window.solana;if(t&&t.isBlocto)return t.convertToProgramWalletTransaction(e);const r=yield this.request({method:"convertToProgramWalletTransaction",params:{message:e.serializeMessage().toString("hex")}});return this.toTransaction(r,[])})}signAndSendTransaction(e,t){return Y(this,void 0,void 0,function*(){const r=window.solana;if(r&&r.isBlocto)return r.signAndSendTransaction(e);const s={};if(t){t.commitment&&(s.commitment=t.commitment);const i=t?t._rpcEndpoint:null;i&&i!==this.rpc&&(this.rpc=i,this.disconnect(),yield this.connect())}return this.request({method:"signAndSendTransaction",params:Object.assign({signatures:yield this.collectSignatures(e),message:e.serializeMessage().toString("hex")},s)})})}toTransaction(e,t){return Y(this,void 0,void 0,function*(){const r=jt.Message.from(R.from(e,"hex")),s=new jt.Transaction;return s.recentBlockhash=r.recentBlockhash,r.header.numRequiredSignatures>0&&(s.feePayer=r.accountKeys[0]),t.forEach((i,o)=>{const a={signature:i===jt.PublicKey.default.toBase58()?null:ko.decode(i),publicKey:r.accountKeys[o]};s.signatures.push(a)}),r.instructions.forEach(i=>{const o=i.accounts.map(a=>({pubkey:r.accountKeys[a],isSigner:a<r.header.numRequiredSignatures,isWritable:r.isAccountWritable(a)}));s.instructions.push(new jt.TransactionInstruction({keys:o,programId:r.accountKeys[i.programIdIndex],data:ko.decode(i.data)}))}),s})}collectSignatures(e){return Y(this,void 0,void 0,function*(){return e.signatures.reduce((t,r)=>(r.signature&&(t[r.publicKey.toBase58()]=r.signature.toString("hex")),t),{})})}handleConvertTransaction(e){var t;return Y(this,void 0,void 0,function*(){const r=((t=pt(this.sessionKey))===null||t===void 0?void 0:t.code)||"";return fetch(`${this.server}/api/solana/convertToWalletTx`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":r},body:JSON.stringify(e.params)}).then(s=>er(s,this.sessionKey))})}handleSignAndSendTransaction(e){var t;return Y(this,void 0,void 0,function*(){const r=((t=pt(this.sessionKey))===null||t===void 0?void 0:t.code)||"",{authorizationId:s}=yield fetch(`${this.server}/api/solana/authz`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":r},body:JSON.stringify(e.params)}).then(o=>er(o,this.sessionKey));if(typeof window>"u")throw new Error("Currently only supported in browser");const i=pr(`${this.server}/${this.appId}/solana/authz/${s}`);return gr(i),new Promise((o,a)=>Qt("message",(c,l)=>{const u=c;u.origin===this.server&&u.data.type==="SOL:FRAME:RESPONSE"&&(u.data.status==="APPROVED"&&(l(),Me(i),o(u.data.txHash)),u.data.status==="DECLINED"&&(l(),Me(i),u.data.errorCode==="incorrect_session_id"&&this.disconnect(),a(new Error(u.data.errorMessage))))}))})}}const ap=n=>{var e,t;const r=Object.assign({},n),{message:s,nonce:i,address:o,application:a,chainId:c}=n;return typeof s!="string"&&(r.message=(e=String(s))!==null&&e!==void 0?e:""),typeof i!="string"&&(r.nonce=(t=String(i))!==null&&t!==void 0?t:""),o&&typeof o!="boolean"&&(r.address=!!o),a&&typeof a!="boolean"&&(r.application=!!a),c&&typeof c!="boolean"&&(r.chainId=!!c),r};class cp extends oi{constructor({chainId:e,server:t,appId:r}){super(),this.publicKey=[],this.authKey="",kr(e,"'chainId' is required"),kr(r,"It is necessary to interact with Blocto wallet via your app id. Please visit https://developers.blocto.app for more details."),this.chainId=e,this.networkName=Xh[e],this.api=Qh[e],this.sessionKey=Jh[e];const s=Zh[e];this.appId=r||xn,this.server=t||s||""}get publicAccount(){var e;return{address:((e=ke(this.sessionKey,me.APTOS))===null||e===void 0?void 0:e[0])||null,publicKey:this.publicKey.length?this.publicKey:null,authKey:null,minKeysRequired:2}}network(){return Y(this,void 0,void 0,function*(){return{name:this.networkName,api:this.api,chainId:this.chainId.toString()}})}isConnected(){var e;return Y(this,void 0,void 0,function*(){return!!(!((e=pt(this.sessionKey))===null||e===void 0)&&e.code)})}signTransaction(e){var t;return Y(this,void 0,void 0,function*(){const r=window.bloctoAptos;if(r)return r.signTransaction(e);throw(yield this.isConnected())||(yield this.connect()),!((t=ke(this.sessionKey,me.APTOS))===null||t===void 0)&&t.length?new Error("signTransaction method not supported."):new Error("Fail to get account")})}disconnect(){return Y(this,void 0,void 0,function*(){const e=window.bloctoAptos;if(e){yield e.disconnect();return}ii(this.sessionKey,me.APTOS)})}signAndSubmitTransaction(e,t={}){var r,s;return Y(this,void 0,void 0,function*(){const i=window.bloctoAptos;if(i)return i.signAndSubmitTransaction(e,t);if((yield this.isConnected())||(yield this.connect()),!(!((r=ke(this.sessionKey,me.APTOS))===null||r===void 0)&&r.length))throw new Error("Fail to get account");const a=((s=pt(this.sessionKey))===null||s===void 0?void 0:s.code)||"",{authorizationId:c}=yield fetch(`${this.server}/api/aptos/authz`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":a},body:JSON.stringify(Object.assign(Object.assign({},e),t))}).then(u=>er(u,this.sessionKey));if(typeof window>"u")throw new Error("Currently only supported in browser");const l=pr(`${this.server}/${this.appId}/aptos/authz/${c}`);return gr(l),new Promise((u,h)=>Qt("message",(g,d)=>{const p=g;p.origin===this.server&&p.data.type==="APTOS:FRAME:RESPONSE"&&(p.data.status==="APPROVED"&&(d(),Me(l),u({hash:p.data.txHash})),p.data.status==="DECLINED"&&(d(),Me(l),p.data.errorCode==="incorrect_session_id"&&this.disconnect(),h(new Error(p.data.errorMessage))))}))})}signMessage(e){var t,r;return Y(this,void 0,void 0,function*(){const s=window.bloctoAptos,i=ap(e);if(s)return s.signMessage(i);if((yield this.isConnected())||(yield this.connect()),!(!((t=ke(this.sessionKey,me.APTOS))===null||t===void 0)&&t.length))throw new Error("Fail to get account");if(typeof window>"u")throw new Error("Currently only supported in browser");const a=((r=pt(this.sessionKey))===null||r===void 0?void 0:r.code)||"",{signatureId:c}=yield fetch(`${this.server}/api/aptos/user-signature`,{method:"POST",headers:{"Content-Type":"application/json","Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":a},body:JSON.stringify(i)}).then(h=>er(h,this.sessionKey)),l=`${this.server}/${this.appId}/aptos/user-signature/${c}`,u=pr(l);return gr(u),new Promise((h,g)=>Qt("message",(d,p)=>{const y=d;y.origin===this.server&&y.data.type==="APTOS:FRAME:RESPONSE"&&(y.data.status==="APPROVED"&&(p(),Me(u),h(y.data)),y.data.status==="DECLINED"&&(p(),Me(u),y.data.errorCode==="incorrect_session_id"&&this.disconnect(),g(new Error(y.data.errorMessage))))}))})}connect(){return Y(this,void 0,void 0,function*(){const e=window.bloctoAptos;return e?new Promise((t,r)=>setTimeout(()=>e.connect().then(t).catch(r),10)):new Promise((t,r)=>{var s,i;if(typeof window>"u")return r("Currently only supported in browser");if(!((s=ke(this.sessionKey,me.APTOS))===null||s===void 0)&&s.length)return t({address:((i=ke(this.sessionKey,me.APTOS))===null||i===void 0?void 0:i[0])||null,publicKey:this.publicKey,authKey:null,minKeysRequired:2});const o=encodeURIComponent(window.location.origin),a=pr(`${this.server}/${this.appId}/aptos/authn?l6n=${o}&v=${$r}}`);gr(a),Qt("message",(c,l)=>Y(this,void 0,void 0,function*(){var u,h,g;const d=c;if(d.origin===this.server){if(d.data.type==="APTOS:FRAME:RESPONSE")if(l(),Me(a),jr(this.sessionKey,{code:d.data.code,connected:!0,accounts:{[me.APTOS]:[d.data.addr]}},d.data.exp),!((u=ke(this.sessionKey,me.APTOS))===null||u===void 0)&&u.length)try{const{public_keys:p}=yield fetch(`${this.server}/blocto/aptos/accounts/${(h=ke(this.sessionKey,me.APTOS))===null||h===void 0?void 0:h[0]}`).then(y=>y.json());this.publicKey=p||[],t({address:((g=ke(this.sessionKey,me.APTOS))===null||g===void 0?void 0:g[0])||"",publicKey:this.publicKey,authKey:null,minKeysRequired:2})}catch{return r(d)}else return r();d.data.type==="APTOS:FRAME:CLOSE"&&(l(),Me(a),r(new Error("User declined the login request")))}}))})})}fetchAddress(){var e;return Y(this,void 0,void 0,function*(){const t=((e=pt(this.sessionKey))===null||e===void 0?void 0:e.code)||"",{accounts:r}=yield fetch(`${this.server}/api/aptos/accounts`,{headers:{"Blocto-Application-Identifier":this.appId,"Blocto-Session-Identifier":t}}).then(s=>er(s,this.sessionKey));return Lr(this.sessionKey,me.APTOS,r),(r==null?void 0:r[0])||""})}}class up{constructor({appId:e,ethereum:t,solana:r,aptos:s}){t&&(this.ethereum=new ep(Object.assign(Object.assign({},t),{appId:e}))),r&&(this.solana=new op(Object.assign(Object.assign({},r),{appId:e}))),s&&(this.aptos=new cp(Object.assign(Object.assign({},s),{appId:e})))}}class gp extends Ac{constructor(e){let{chains:t,options:r={}}=e;super({chains:t,options:r}),Ln(this,"id",xc.blocto),Ln(this,"name","Blocto"),Ln(this,"ready",!0),this._onAccountsChangedBind=this.onAccountsChanged.bind(this),this._onChainChangedBind=this.onChainChanged.bind(this),this._onDisconnectBind=this.onDisconnect.bind(this)}async connect(e){try{const t=await this.getProvider(e);this.setupListeners(),this.emit("message",{type:"connecting"});const r=await t.request({method:"eth_requestAccounts"}),s=Rc(r[0]),i=await this.getChainId(),o=this.isChainUnsupported(i);return{account:s,chain:{id:i,unsupported:o},provider:t}}catch(t){throw this._handleConnectReset(),this._isUserRejectedRequestError(t)?new _i(t):t}}async disconnect(){await(await this.getProvider()).request({method:"wallet_disconnect"}),this.removeListeners(),this._handleConnectReset()}async getAccount(){const t=await(await this.getProvider()).request({method:"eth_accounts"}),[r]=t||[];if(!r)throw new Error("No accounts found");return r}async getChainId(){const t=await(await this.getProvider()).request({method:"eth_chainId"});return Ei(t)}getProvider(){var t,r,s;let{chainId:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!this._provider){const i=e??this.options.chainId??((t=this.chains[0])==null?void 0:t.chainId)??1,o=(r=this.chains.find(a=>a.chainId===i))==null?void 0:r.rpc[0];this._provider=(s=new up({ethereum:{chainId:i,rpc:o},appId:this.options.appId}))==null?void 0:s.ethereum}if(!this._provider)throw new Pc;return Promise.resolve(this._provider)}async getSigner(){let{chainId:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const[t,r]=await Promise.all([this.getProvider(),this.getAccount()]);return new Bc(t,e).getSigner(r)}async isAuthorized(){var e,t;return!!((t=(e=this._provider)==null?void 0:e._blocto)!=null&&t.sessionKey)}async switchChain(e){const t=await this.getProvider(),r=Tc(e),s=this.chains.find(o=>o.chainId===e);if(!s)throw new Nn(new Error("chain not found on connector."));if(!t._blocto.supportNetworkList[`${e}`])throw new Nn(new Error(`Blocto unsupported chain: ${r}`));try{return await t.request({method:"wallet_addEthereumChain",params:[{chainId:r,rpcUrls:Cc(s)}]}),await t.request({method:"wallet_switchEthereumChain",params:[{chainId:r}]}),s}catch(o){throw this._isUserRejectedRequestError(o)?new _i(o):new Nn(o)}}onAccountsChanged(){}async onChainChanged(e){const t=Ei(e),r=this.isChainUnsupported(t),s=await this.getAccount();this.emit("change",{chain:{id:t,unsupported:r},account:s})}onDisconnect(){this.emit("disconnect")}async setupListeners(){const e=await this.getProvider();e.on("accountsChanged",this._onAccountsChangedBind),e.on("chainChanged",this._onChainChangedBind),e.on("disconnect",this._onDisconnectBind)}async removeListeners(){const e=await this.getProvider();e.off("accountsChanged",this._onAccountsChangedBind),e.off("chainChanged",this._onChainChangedBind),e.off("disconnect",this._onDisconnectBind)}_isUserRejectedRequestError(e){return/(user rejected)/i.test(e.message)}_handleConnectReset(){this._provider=void 0}}export{gp as BloctoConnector};
